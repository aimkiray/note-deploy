{"_path":"/blog/pxe-ubuntu","_dir":"blog","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"æ‰¹é‡é‡è£… Ubuntu 18.04","description":"Ubuntu Server 18.04.5 ç³»ç»Ÿå®‰è£…ä½¿ç”¨ debian-installerï¼Œå…¼å®¹ Kickstart ä½†ä¸å¤Ÿçµæ´»ï¼Œæ¯”å¦‚ä» 5 å— NVMe ç¡¬ç›˜ä¸­æ‰¾åˆ°å®¹é‡æœ€å°çš„ç›˜å®‰è£…ç³»ç»Ÿè¿™ç§æ“ä½œå°±å¾ˆéš¾åšåˆ°ã€‚è‡ªå®¶çš„è„šæœ¬æ˜¯ Preseedï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œèƒ½å®Œæˆä¸€äº›å›¾å½¢å®‰è£…ç•Œé¢å±Šä¸åˆ°çš„æ“ä½œï¼ˆç¼ºç‚¹æ˜¯æœ‰ä¸€ç‚¹ç‚¹å¤æ‚ï¼‰ã€‚","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"æ¦‚è¿°"},"children":[{"type":"text","value":"æ¦‚è¿°"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ubuntu Server 18.04.5 ç³»ç»Ÿå®‰è£…ä½¿ç”¨ debian-installerï¼Œå…¼å®¹ Kickstart ä½†ä¸å¤Ÿçµæ´»ï¼Œæ¯”å¦‚ä» 5 å— NVMe ç¡¬ç›˜ä¸­æ‰¾åˆ°å®¹é‡æœ€å°çš„ç›˜å®‰è£…ç³»ç»Ÿè¿™ç§æ“ä½œå°±å¾ˆéš¾åšåˆ°ã€‚è‡ªå®¶çš„è„šæœ¬æ˜¯ Preseedï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œèƒ½å®Œæˆä¸€äº›å›¾å½¢å®‰è£…ç•Œé¢å±Šä¸åˆ°çš„æ“ä½œï¼ˆç¼ºç‚¹æ˜¯æœ‰ä¸€ç‚¹ç‚¹å¤æ‚ï¼‰ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨ "},{"type":"element","tag":"a","props":{"href":"/note/linux/pxe-centos.html"},"children":[{"type":"text","value":"CentOS ç¯‡"}]},{"type":"text","value":"ä¸­ï¼ŒPXE Server éœ€è¦å®‰è£… DHCP/TFTP/Nginx ç­‰ä¼—å¤šè½¯ä»¶ã€‚è¿™æ¬¡æ”¹ç”¨ Dnsmasq åŒæ—¶æä¾› DHCP å’Œ TFTP æœåŠ¡ã€‚ä¹Ÿçœå» Nginxï¼Œç›´æ¥ä»è½¯ä»¶æºå®‰è£…ç³»ç»Ÿã€‚"}]},{"type":"element","tag":"h2","props":{"id":"å®‰è£…è½¯ä»¶"},"children":[{"type":"text","value":"å®‰è£…è½¯ä»¶"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸‹è½½ Ubuntu é•œåƒï¼Œæ–‡ä¸­ä½¿ç”¨çš„æ˜¯ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ubuntu-18.04.5-server-amdyes.iso"}]},{"type":"text","value":"ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å®‰è£… dnsmasq æœåŠ¡ã€‚"}]},{"type":"element","tag":"code","props":{"code":"sudo apt update\nsudo apt install dnsmasq\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo apt update\nsudo apt install dnsmasq\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é…ç½® dnsmasqï¼Œå¼€å¯ DHCP å’Œ TFTP åŠŸèƒ½ã€‚"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/\n\nvim /etc/dnsmasq.conf\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir -p /srv/tftp/\n\nvim /etc/dnsmasq.conf\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å†…å®¹å¦‚ä¸‹ã€‚"}]},{"type":"element","tag":"code","props":{"code":"interface=eth0\nbind-interfaces\ndhcp-range=172.16.199.1,172.16.199.254\ndhcp-boot=grubnetx64.efi.signed\ndhcp-host=172.16.199.1\n\nenable-tftp\ntftp-root=/srv/tftp/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"interface=eth0\nbind-interfaces\ndhcp-range=172.16.199.1,172.16.199.254\ndhcp-boot=grubnetx64.efi.signed\ndhcp-host=172.16.199.1\n\nenable-tftp\ntftp-root=/srv/tftp/\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å…¶ä¸­ï¼Œinterface æ˜¯å½“å‰ä½¿ç”¨çš„ç½‘ç»œæ¥å£ï¼Œdhcp-boot æ˜¯ grub å¼•å¯¼ç¨‹åºçš„ä½ç½®ï¼Œdhcp-host æ˜¯ DHCP Server ç½‘å…³ IPï¼ˆå¯ç”¨æ¥å¯è®¿é—®æœ¬æœºå™¨ï¼‰ï¼Œtftp-root åˆ™æ˜¯ TFTP Server çš„æ ¹ç›®å½•ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å¯åŠ¨ dnsmasq æœåŠ¡ã€‚"}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl start dnsmasq\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo systemctl start dnsmasq\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"é…ç½®-pxe-server"},"children":[{"type":"text","value":"é…ç½® PXE Server"}]},{"type":"element","tag":"h3","props":{"id":"boot-loader"},"children":[{"type":"text","value":"Boot loader"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"UEFI å¯åŠ¨éœ€è¦ä¸€ä¸ª boot loaderï¼ˆæ–‡ä¸­æ˜¯ GRUBï¼‰ã€‚ä»è½¯ä»¶æºä¸‹è½½ï¼Œç„¶åä¸¢è¿› TFTP æ ¹ç›®å½•ã€‚"}]},{"type":"element","tag":"code","props":{"code":"sudo apt-get install grub-efi-amd64-signed\n\nsudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed /srv/tftp/grubnetx64.efi.signed\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo apt-get install grub-efi-amd64-signed\n\nsudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed /srv/tftp/grubnetx64.efi.signed\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"grubnetx64.efi.signed è¿™ä¸ªåå­—å°±æ˜¯åœ¨ /etc/dnsmasq.conf çš„ dhcp-boot å­—æ®µä¸­å®šä¹‰çš„é‚£ä¸ªã€‚"}]},{"type":"element","tag":"h3","props":{"id":"grub"},"children":[{"type":"text","value":"GRUB"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é…ç½® GRUBï¼Œå…¶å®å°±æ˜¯ Ubuntu é‚£ä¸ªé€‰æ‹©ç³»ç»Ÿçš„å¯åŠ¨èœå•ï¼Œæ·»åŠ ä¸€ä¸ªå¯åŠ¨é¡¹ï¼ŒæŠŠç³»ç»Ÿä½ç½®ä»ç¡¬ç›˜æ”¹ä¸ºç½‘ç»œã€‚"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/grub\nvim /srv/tftp/grub/grub.cfg\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir -p /srv/tftp/grub\nvim /srv/tftp/grub/grub.cfg\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å†…å®¹å¦‚ä¸‹ã€‚"}]},{"type":"element","tag":"code","props":{"code":"set default=\"0\"\nset timeout=6\nmenuentry \"Install Ubuntu\" {\n  set gfxpayload=keep\n  linux /ubuntu/linux gfxpayload=800x600x16,800x600 --- auto=true priority=critical interface=auto hostname=fox GRUB_DISABLE_OS_PROBER=true url=tftp://172.16.1.1/preseed.cfg quiet\n  initrd /ubuntu/initrd.gz\n}\n...\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"set default=\"0\"\nset timeout=6\nmenuentry \"Install Ubuntu\" {\n  set gfxpayload=keep\n  linux /ubuntu/linux gfxpayload=800x600x16,800x600 --- auto=true priority=critical interface=auto hostname=fox GRUB_DISABLE_OS_PROBER=true url=tftp://172.16.1.1/preseed.cfg quiet\n  initrd /ubuntu/initrd.gz\n}\n...\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç”±äº Ubuntu 18.04 çš„ os-prober æ“ä½œ LVM åˆ†åŒºæ—¶ä¼šè§¦å‘ "},{"type":"element","tag":"a","props":{"href":"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=853927","rel":["nofollow"]},"children":[{"type":"text","value":"BUG"}]},{"type":"text","value":"ï¼Œæ‰€ä»¥åŠ äº†ä¸ªç¯å¢ƒå˜é‡ GRUB_DISABLE_OS_PROBER=true ç¦ç”¨ os-proberã€‚å…¶ä»–é…ç½®é¡¹è¯´æ˜å‚è€ƒ CentOS ç¯‡ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"ç½‘ç»œå¼•å¯¼"},"children":[{"type":"text","value":"ç½‘ç»œå¼•å¯¼"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä»"},{"type":"element","tag":"a","props":{"href":"http://cdimage.ubuntu.com/netboot/","rel":["nofollow"]},"children":[{"type":"text","value":"è¿™é‡Œ"}]},{"type":"text","value":"ä¸‹è½½ Ubuntu çš„ç½‘ç»œå¼•å¯¼é•œåƒï¼Œè§£å‹åˆ° TFTP ç›®å½•ä¸‹ã€‚"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/ubuntu\n\nwget http://archive.ubuntu.com/ubuntu/dists/bionic-updates/main/installer-amd64/current/images/netboot/netboot.tar.gz\ntar -xvzf netboot.tar.gz -C /srv/tftp/ubuntu\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir -p /srv/tftp/ubuntu\n\nwget http://archive.ubuntu.com/ubuntu/dists/bionic-updates/main/installer-amd64/current/images/netboot/netboot.tar.gz\ntar -xvzf netboot.tar.gz -C /srv/tftp/ubuntu\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"è½¯ä»¶åŒ…ç¼“å­˜"},"children":[{"type":"text","value":"è½¯ä»¶åŒ…ç¼“å­˜"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ubuntu å®‰è£…ç¨‹åºæ”¯æŒ APT å®‰è£…è½¯ä»¶åŒ…ï¼Œé»˜è®¤æ˜¯ä»å®˜æ–¹è½¯ä»¶æºä¸‹è½½ã€‚ä½†å¦‚æœæ‰¹é‡å®‰è£…ï¼Œå¤–ç½‘æ€•æ˜¯ä¼šç‚¸ï¼Œæ‰€ä»¥è¦åœ¨å†…ç½‘ï¼ˆPXE Serverï¼‰æ­å»ºè½¯ä»¶åŒ…ç¼“å­˜æœåŠ¡ã€‚"}]},{"type":"element","tag":"code","props":{"code":"sudo apt-get install apt-cacher-ng\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo apt-get install apt-cacher-ng\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å®‰è£…å®Œæˆåï¼Œåœ¨ Preseed è„šæœ¬ä¸­é…ç½®æºä»£ç† "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"d-i mirror/http/proxy string http://<YOUR_IP>:3142/"}]},{"type":"text","value":" æŒ‡å‘è¯¥æœºå™¨ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"preseed"},"children":[{"type":"text","value":"Preseed"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Preseed è„šæœ¬å¯é…ç½®é¡¹éå¸¸å¤šï¼Œè¯¦ç»†å¯å‚è§"},{"type":"element","tag":"a","props":{"href":"https://www.debian.org/releases/stretch/amd64/apbs04.html.en","rel":["nofollow"]},"children":[{"type":"text","value":"å®˜æ–¹æ–‡æ¡£"}]},{"type":"text","value":"ã€‚ä¸‹é¢ç®€å•ä¸¾å‡ ä¸ªğŸŒ°ï¼Œå¯æ ¹æ®è‡ªèº«éœ€æ±‚ä¿®æ”¹ã€‚"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ç›¸åŒçš„éƒ¨åˆ†"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç³»ç»Ÿç›˜ä½¿ç”¨ LVM æ–¹å¼åˆ†åŒºï¼Œé™¤äº† "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot,/boot/efi"}]},{"type":"text","value":" åˆ†åŒºå¤–ï¼Œå…¶ä½™ç©ºé—´å…¨ç»™æ ¹ç›®å½•ï¼Œç¦ç”¨ SWAP åˆ†åŒºã€‚å¯ç”¨ ROOT ç”¨æˆ·ï¼Œå…è®¸ ROOT ç”¨æˆ·è¿œç¨‹ç™»å½•ï¼Œå®‰è£… "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"openssh-server openssh-client vim curl"}]},{"type":"text","value":" è½¯ä»¶ã€‚"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ç³»ç»Ÿç›˜åå­—å›ºå®šï¼Œæ¯”å¦‚å•å— SATA ç³»ç»Ÿç›˜é»˜è®¤è®¾å¤‡åæ˜¯ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/dev/sda"}]},{"type":"text","value":"ï¼Œå•å— NVMe SSD æ˜¯ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/dev/nvme0n1"}]},{"type":"text","value":"ï¼Œè¿™æ ·ç³»ç»Ÿç›˜å¯ä»¥å†™æ­»åœ¨é…ç½®ä¸­ã€‚"}]}]},{"type":"element","tag":"code","props":{"code":"### Unattended Installation\nd-i auto-install/enable boolean true\nd-i debconf/priority select critical\n\n### Localization\nd-i debian-installer/locale string en_US.UTF-8\nd-i localechooser/languagelist select en\nd-i localechooser/shortlist/en select US\nd-i localechooser/continentlist select Asia\nd-i localechooser/countrylist/Asia select China\nd-i console-setup/ask_detect boolean false\nd-i keyboard-configuration/xkb-keymap select us\n\n### Account setup\nd-i passwd/root-login boolean true\nd-i passwd/make-user boolean false\nd-i passwd/root-password password ABC123def\nd-i passwd/root-password-again password ABC123def\nd-i user-setup/allow-password-weak boolean true\n\n### Network configuration\nd-i netcfg/choose_interface select auto\nd-i netcfg/get_hostname string cat\nd-i hw-detect/load_firmware boolean true\n\n# If you want the preconfiguration file to work on systems both with and\n# without a dhcp server, uncomment these lines and the static network\n# configuration below.\nd-i netcfg/dhcp_failed note\nd-i netcfg/dhcp_options select Configure network manually\n\n# Static network configuration.\nd-i netcfg/get_ipaddress string 172.16.1.207\nd-i netcfg/get_netmask string 255.255.0.0\nd-i netcfg/get_gateway string 172.16.255.254\nd-i netcfg/get_nameservers string 223.5.5.5\nd-i netcfg/confirm_static boolean true\n\n### Partition\n# Specify a disk to partition. The device name\n# can be given in either devfs or traditional non-devfs format.\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n# In addition, you'll need to specify the method to use.\n# The presently available methods are: \"regular\", \"lvm\" and \"crypto\"\nd-i partman-auto/method string lvm\n\n# If one of the disks that are going to be automatically partitioned\n# contains an old LVM configuration, the user will normally receive a\n# warning. This can be preseeded away...\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# http://cptyesterday.wordpress.com/2012/06/17/notes-on-using-expert_recipe-in-debianubuntu-preseed-files/\nd-i partman-auto/choose_recipe select boot-root\nd-i partman-auto-lvm/new_vg_name string main\nd-i partman-auto-lvm/guided_size string max\n\nd-i partman-auto/expert_recipe string                \\\n    boot-root ::                                     \\\n        1 1 1 free                                   \\\n            $bios_boot{ }                            \\\n            method{ biosgrub }                       \\\n        .                                            \\\n        256 256 256 fat32                            \\\n            $primary{ }                              \\\n            $iflabel{ gpt }                          \\\n            $reusemethod{ }                          \\\n            method{ efi } format{ }                  \\\n            mountpoint{ /boot/efi }                  \\\n        .                                            \\\n        512 512 512 ext4                             \\\n            $primary{ }                              \\\n            $bootable{ }                             \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ /boot }                      \\\n        .                                            \\\n        4096 4096 -1 ext4                            \\\n            $lvmok{ }                                \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ / }                          \\\n            lv_name{ root }                          \\\n        .\n\n# Write the changes to disks and configure LVM\nd-i partman/confirm boolean true\nd-i partman-lvm/confirm boolean true\nd-i partman-lvm/confirm_nooverwrite boolean true\n\n# http://ubuntuforums.org/showthread.php?p=9626883\nd-i partman-lvm/device_remove_lvm boolean true\n\n# This makes partman automatically partition without confirmation.\nd-i partman/choose_partition \\\n      select Finish partitioning and write changes to disk\nd-i partman/confirm_nooverwrite boolean true\n\nd-i pkgsel/include string openssh-server openssh-client vim curl\n\n### Mirror settings\nd-i mirror/country string manual\nd-i mirror/http/hostname string mirrors.ustc.edu.cn\nd-i mirror/http/directory string /ubuntu\nd-i mirror/http/proxy string http://172.16.1.1:3142/\n\n# Custom commands\nd-i preseed/late_command string \\\n    in-target sh -c 'sed -i \"/#PermitRootLogin/a PermitRootLogin yes\" /etc/ssh/sshd_config';\n\nfinish-install finish-install/keep-consoles boolean false\nd-i finish-install/reboot_in_progress note\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"### Unattended Installation\nd-i auto-install/enable boolean true\nd-i debconf/priority select critical\n\n### Localization\nd-i debian-installer/locale string en_US.UTF-8\nd-i localechooser/languagelist select en\nd-i localechooser/shortlist/en select US\nd-i localechooser/continentlist select Asia\nd-i localechooser/countrylist/Asia select China\nd-i console-setup/ask_detect boolean false\nd-i keyboard-configuration/xkb-keymap select us\n\n### Account setup\nd-i passwd/root-login boolean true\nd-i passwd/make-user boolean false\nd-i passwd/root-password password ABC123def\nd-i passwd/root-password-again password ABC123def\nd-i user-setup/allow-password-weak boolean true\n\n### Network configuration\nd-i netcfg/choose_interface select auto\nd-i netcfg/get_hostname string cat\nd-i hw-detect/load_firmware boolean true\n\n# If you want the preconfiguration file to work on systems both with and\n# without a dhcp server, uncomment these lines and the static network\n# configuration below.\nd-i netcfg/dhcp_failed note\nd-i netcfg/dhcp_options select Configure network manually\n\n# Static network configuration.\nd-i netcfg/get_ipaddress string 172.16.1.207\nd-i netcfg/get_netmask string 255.255.0.0\nd-i netcfg/get_gateway string 172.16.255.254\nd-i netcfg/get_nameservers string 223.5.5.5\nd-i netcfg/confirm_static boolean true\n\n### Partition\n# Specify a disk to partition. The device name\n# can be given in either devfs or traditional non-devfs format.\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n# In addition, you'll need to specify the method to use.\n# The presently available methods are: \"regular\", \"lvm\" and \"crypto\"\nd-i partman-auto/method string lvm\n\n# If one of the disks that are going to be automatically partitioned\n# contains an old LVM configuration, the user will normally receive a\n# warning. This can be preseeded away...\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# http://cptyesterday.wordpress.com/2012/06/17/notes-on-using-expert_recipe-in-debianubuntu-preseed-files/\nd-i partman-auto/choose_recipe select boot-root\nd-i partman-auto-lvm/new_vg_name string main\nd-i partman-auto-lvm/guided_size string max\n\nd-i partman-auto/expert_recipe string                \\\n    boot-root ::                                     \\\n        1 1 1 free                                   \\\n            $bios_boot{ }                            \\\n            method{ biosgrub }                       \\\n        .                                            \\\n        256 256 256 fat32                            \\\n            $primary{ }                              \\\n            $iflabel{ gpt }                          \\\n            $reusemethod{ }                          \\\n            method{ efi } format{ }                  \\\n            mountpoint{ /boot/efi }                  \\\n        .                                            \\\n        512 512 512 ext4                             \\\n            $primary{ }                              \\\n            $bootable{ }                             \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ /boot }                      \\\n        .                                            \\\n        4096 4096 -1 ext4                            \\\n            $lvmok{ }                                \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ / }                          \\\n            lv_name{ root }                          \\\n        .\n\n# Write the changes to disks and configure LVM\nd-i partman/confirm boolean true\nd-i partman-lvm/confirm boolean true\nd-i partman-lvm/confirm_nooverwrite boolean true\n\n# http://ubuntuforums.org/showthread.php?p=9626883\nd-i partman-lvm/device_remove_lvm boolean true\n\n# This makes partman automatically partition without confirmation.\nd-i partman/choose_partition \\\n      select Finish partitioning and write changes to disk\nd-i partman/confirm_nooverwrite boolean true\n\nd-i pkgsel/include string openssh-server openssh-client vim curl\n\n### Mirror settings\nd-i mirror/country string manual\nd-i mirror/http/hostname string mirrors.ustc.edu.cn\nd-i mirror/http/directory string /ubuntu\nd-i mirror/http/proxy string http://172.16.1.1:3142/\n\n# Custom commands\nd-i preseed/late_command string \\\n    in-target sh -c 'sed -i \"/#PermitRootLogin/a PermitRootLogin yes\" /etc/ssh/sshd_config';\n\nfinish-install finish-install/keep-consoles boolean false\nd-i finish-install/reboot_in_progress note\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"æœºå™¨å®‰è£…å¤šå—ç¡¬ç›˜ï¼Œæ¯”å¦‚æœ‰ 5 å— NVMe SSDï¼Œ256GBx1 & 2TBx4ï¼Œç³»ç»Ÿè£…åœ¨ 256GB çš„ç¡¬ç›˜ä¸Šã€‚"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åŸºäºä¸Šé¢çš„è„šæœ¬ï¼Œåœ¨ early_command ä¸­ä½¿ç”¨ Bash è„šæœ¬ï¼Œé€šè¿‡ debconf-set æ¥åŠ¨æ€æŒ‡å®šç¡¬ç›˜ä½ç½®ã€‚"}]},{"type":"element","tag":"code","props":{"code":"# åˆ é™¤ä¸‹é¢ä¸¤ä¸ªé…ç½®\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n\n# ç”¨è¿™ä¸ªè„šæœ¬æ‰¾å‡ºå°äº 300GB çš„ç¡¬ç›˜ï¼ŒæŒ‡å®šä¸ºç³»ç»Ÿç›˜\nd-i partman/early_command string \\\n  for BOOTDEV in nvme0n1 nvme1n1 nvme2n1 nvme3n1 nvme4n1; do \\\n    if [ -d /sys/block/$BOOTDEV ]; then \\\n      SIZE=`cat /sys/block/$BOOTDEV/size`; \\\n      GB=$(($SIZE/2**21)); \\\n      if [ $GB -lt 300 ]; then \\\n        debconf-set partman-auto/disk \"/dev/$BOOTDEV\"; \\\n        debconf-set grub-installer/bootdev \"/dev/$BOOTDEV\"; \\\n      fi; \\\n    fi; \\\n  done\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# åˆ é™¤ä¸‹é¢ä¸¤ä¸ªé…ç½®\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n\n# ç”¨è¿™ä¸ªè„šæœ¬æ‰¾å‡ºå°äº 300GB çš„ç¡¬ç›˜ï¼ŒæŒ‡å®šä¸ºç³»ç»Ÿç›˜\nd-i partman/early_command string \\\n  for BOOTDEV in nvme0n1 nvme1n1 nvme2n1 nvme3n1 nvme4n1; do \\\n    if [ -d /sys/block/$BOOTDEV ]; then \\\n      SIZE=`cat /sys/block/$BOOTDEV/size`; \\\n      GB=$(($SIZE/2**21)); \\\n      if [ $GB -lt 300 ]; then \\\n        debconf-set partman-auto/disk \"/dev/$BOOTDEV\"; \\\n        debconf-set grub-installer/bootdev \"/dev/$BOOTDEV\"; \\\n      fi; \\\n    fi; \\\n  done\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"æœºå™¨æœ¬æ¥æœ‰ç³»ç»Ÿï¼Œéœ€è¦æ‰¹é‡é‡è£…ï¼ŒåŸç³»ç»Ÿä¹Ÿæ˜¯ LVM æ–¹å¼åˆ†åŒºã€‚"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å…ˆç§»é™¤å·²å­˜åœ¨çš„ LVM åˆ†åŒºï¼Œå†å°è¯•å®‰è£…ï¼ˆè™½ç„¶æœ‰ç›¸å…³é…ç½®é¡¹ï¼Œä½†è¯¥ç‰ˆæœ¬å¯èƒ½å­˜åœ¨ "},{"type":"element","tag":"a","props":{"href":"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=740271","rel":["nofollow"]},"children":[{"type":"text","value":"BUG"}]},{"type":"text","value":"ï¼‰ã€‚"}]},{"type":"element","tag":"code","props":{"code":"# ç§»é™¤ LVM åˆ†åŒº\nd-i partman-lvm/device_remove_lvm boolean true\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# ä¸Šè¿°é…ç½®é¡¹å¯èƒ½å­˜åœ¨ BUGï¼Œé‚£å°±äº²è‡ªåˆ ä¸€é\nd-i partman/early_command string \\\n    set -- $(vgs --rows --noheadings | head -n 1); \\\n    for vg in \"$@\"; do \\\n        swapoff \"/dev/$vg/swap\"; \\\n        vgremove -f \"$vg\"; \\\n    done; \\\n    set -- $(pvs --rows --noheadings | head -n 1); \\\n    for pv in \"$@\"; do \\\n        pvremove -f \"$pv\"; \\\n    done\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# ç§»é™¤ LVM åˆ†åŒº\nd-i partman-lvm/device_remove_lvm boolean true\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# ä¸Šè¿°é…ç½®é¡¹å¯èƒ½å­˜åœ¨ BUGï¼Œé‚£å°±äº²è‡ªåˆ ä¸€é\nd-i partman/early_command string \\\n    set -- $(vgs --rows --noheadings | head -n 1); \\\n    for vg in \"$@\"; do \\\n        swapoff \"/dev/$vg/swap\"; \\\n        vgremove -f \"$vg\"; \\\n    done; \\\n    set -- $(pvs --rows --noheadings | head -n 1); \\\n    for pv in \"$@\"; do \\\n        pvremove -f \"$pv\"; \\\n    done\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Preseed æ–‡ä»¶æ”¾åˆ° TFTP æ ¹ç›®å½• "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/srv/tftp/"}]},{"type":"text","value":" ä¸‹ï¼Œä¹Ÿå°±æ˜¯ GRUB èœå•é…ç½®é‡Œ url æŒ‡å®šçš„é‚£ä¸ªã€‚"}]},{"type":"element","tag":"h2","props":{"id":"pxe-å¼•å¯¼"},"children":[{"type":"text","value":"PXE å¼•å¯¼"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç¡®ä¿å†…ç½‘ä¸­æ²¡æœ‰å…¶ä»– DHCP æœåŠ¡ï¼Œå°†æœºå™¨æ¥åœ¨ PXE Server åŒä¸€ä¸ªäº¤æ¢æœºä¸‹ã€‚é‡å¯æœºå™¨ï¼Œå¯åŠ¨æ—¶é€‰æ‹©ä» PXE å¼•å¯¼ï¼Œè§‚å¯Ÿæ˜¯å¦è·å¾— IPï¼Œèƒ½å¦ä¸‹è½½å¯åŠ¨æ–‡ä»¶ã€‚æ­£å¸¸çš„è¯ç¨åå°±èƒ½çœ‹åˆ° Ubuntu å®‰è£…ç•Œé¢ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"å‚è€ƒ"},"children":[{"type":"text","value":"å‚è€ƒ"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.ubuntu.com/UEFI/PXE-netboot-install","rel":["nofollow"]},"children":[{"type":"text","value":"https://wiki.ubuntu.com/UEFI/PXE-netboot-install"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.debian.org/releases/etch/ia64/apbs04.html.en","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.debian.org/releases/etch/ia64/apbs04.html.en"}]}]}]}]},"date":"2020-10-20T21:05:00.000Z","tags":["linux","pxe"],"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"æ¦‚è¿°"},"children":[{"type":"text","value":"æ¦‚è¿°"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ubuntu Server 18.04.5 ç³»ç»Ÿå®‰è£…ä½¿ç”¨ debian-installerï¼Œå…¼å®¹ Kickstart ä½†ä¸å¤Ÿçµæ´»ï¼Œæ¯”å¦‚ä» 5 å— NVMe ç¡¬ç›˜ä¸­æ‰¾åˆ°å®¹é‡æœ€å°çš„ç›˜å®‰è£…ç³»ç»Ÿè¿™ç§æ“ä½œå°±å¾ˆéš¾åšåˆ°ã€‚è‡ªå®¶çš„è„šæœ¬æ˜¯ Preseedï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œèƒ½å®Œæˆä¸€äº›å›¾å½¢å®‰è£…ç•Œé¢å±Šä¸åˆ°çš„æ“ä½œï¼ˆç¼ºç‚¹æ˜¯æœ‰ä¸€ç‚¹ç‚¹å¤æ‚ï¼‰ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨ "},{"type":"element","tag":"a","props":{"href":"/note/linux/pxe-centos.html"},"children":[{"type":"text","value":"CentOS ç¯‡"}]},{"type":"text","value":"ä¸­ï¼ŒPXE Server éœ€è¦å®‰è£… DHCP/TFTP/Nginx ç­‰ä¼—å¤šè½¯ä»¶ã€‚è¿™æ¬¡æ”¹ç”¨ Dnsmasq åŒæ—¶æä¾› DHCP å’Œ TFTP æœåŠ¡ã€‚ä¹Ÿçœå» Nginxï¼Œç›´æ¥ä»è½¯ä»¶æºå®‰è£…ç³»ç»Ÿã€‚"}]},{"type":"element","tag":"h2","props":{"id":"å®‰è£…è½¯ä»¶"},"children":[{"type":"text","value":"å®‰è£…è½¯ä»¶"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸‹è½½ Ubuntu é•œåƒï¼Œæ–‡ä¸­ä½¿ç”¨çš„æ˜¯ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ubuntu-18.04.5-server-amdyes.iso"}]},{"type":"text","value":"ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å®‰è£… dnsmasq æœåŠ¡ã€‚"}]},{"type":"element","tag":"code","props":{"code":"sudo apt update\nsudo apt install dnsmasq\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo apt update"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo apt install dnsmasq"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é…ç½® dnsmasqï¼Œå¼€å¯ DHCP å’Œ TFTP åŠŸèƒ½ã€‚"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/\n\nvim /etc/dnsmasq.conf\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"mkdir -p /srv/tftp/"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"vim /etc/dnsmasq.conf"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å†…å®¹å¦‚ä¸‹ã€‚"}]},{"type":"element","tag":"code","props":{"code":"interface=eth0\nbind-interfaces\ndhcp-range=172.16.199.1,172.16.199.254\ndhcp-boot=grubnetx64.efi.signed\ndhcp-host=172.16.199.1\n\nenable-tftp\ntftp-root=/srv/tftp/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"interface=eth0"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"bind-interfaces"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"dhcp-range=172.16.199.1,172.16.199.254"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"dhcp-boot=grubnetx64.efi.signed"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"dhcp-host=172.16.199.1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"enable-tftp"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"tftp-root=/srv/tftp/"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å…¶ä¸­ï¼Œinterface æ˜¯å½“å‰ä½¿ç”¨çš„ç½‘ç»œæ¥å£ï¼Œdhcp-boot æ˜¯ grub å¼•å¯¼ç¨‹åºçš„ä½ç½®ï¼Œdhcp-host æ˜¯ DHCP Server ç½‘å…³ IPï¼ˆå¯ç”¨æ¥å¯è®¿é—®æœ¬æœºå™¨ï¼‰ï¼Œtftp-root åˆ™æ˜¯ TFTP Server çš„æ ¹ç›®å½•ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å¯åŠ¨ dnsmasq æœåŠ¡ã€‚"}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl start dnsmasq\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo systemctl start dnsmasq"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"é…ç½®-pxe-server"},"children":[{"type":"text","value":"é…ç½® PXE Server"}]},{"type":"element","tag":"h3","props":{"id":"boot-loader"},"children":[{"type":"text","value":"Boot loader"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"UEFI å¯åŠ¨éœ€è¦ä¸€ä¸ª boot loaderï¼ˆæ–‡ä¸­æ˜¯ GRUBï¼‰ã€‚ä»è½¯ä»¶æºä¸‹è½½ï¼Œç„¶åä¸¢è¿› TFTP æ ¹ç›®å½•ã€‚"}]},{"type":"element","tag":"code","props":{"code":"sudo apt-get install grub-efi-amd64-signed\n\nsudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed /srv/tftp/grubnetx64.efi.signed\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo apt-get install grub-efi-amd64-signed"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed /srv/tftp/grubnetx64.efi.signed"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"grubnetx64.efi.signed è¿™ä¸ªåå­—å°±æ˜¯åœ¨ /etc/dnsmasq.conf çš„ dhcp-boot å­—æ®µä¸­å®šä¹‰çš„é‚£ä¸ªã€‚"}]},{"type":"element","tag":"h3","props":{"id":"grub"},"children":[{"type":"text","value":"GRUB"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é…ç½® GRUBï¼Œå…¶å®å°±æ˜¯ Ubuntu é‚£ä¸ªé€‰æ‹©ç³»ç»Ÿçš„å¯åŠ¨èœå•ï¼Œæ·»åŠ ä¸€ä¸ªå¯åŠ¨é¡¹ï¼ŒæŠŠç³»ç»Ÿä½ç½®ä»ç¡¬ç›˜æ”¹ä¸ºç½‘ç»œã€‚"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/grub\nvim /srv/tftp/grub/grub.cfg\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"mkdir -p /srv/tftp/grub"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"vim /srv/tftp/grub/grub.cfg"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å†…å®¹å¦‚ä¸‹ã€‚"}]},{"type":"element","tag":"code","props":{"code":"set default=\"0\"\nset timeout=6\nmenuentry \"Install Ubuntu\" {\n  set gfxpayload=keep\n  linux /ubuntu/linux gfxpayload=800x600x16,800x600 --- auto=true priority=critical interface=auto hostname=fox GRUB_DISABLE_OS_PROBER=true url=tftp://172.16.1.1/preseed.cfg quiet\n  initrd /ubuntu/initrd.gz\n}\n...\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"set default=\"0\"\nset timeout=6\nmenuentry \"Install Ubuntu\" {\n  set gfxpayload=keep\n  linux /ubuntu/linux gfxpayload=800x600x16,800x600 --- auto=true priority=critical interface=auto hostname=fox GRUB_DISABLE_OS_PROBER=true url=tftp://172.16.1.1/preseed.cfg quiet\n  initrd /ubuntu/initrd.gz\n}\n..."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç”±äº Ubuntu 18.04 çš„ os-prober æ“ä½œ LVM åˆ†åŒºæ—¶ä¼šè§¦å‘ "},{"type":"element","tag":"a","props":{"href":"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=853927","rel":["nofollow"]},"children":[{"type":"text","value":"BUG"}]},{"type":"text","value":"ï¼Œæ‰€ä»¥åŠ äº†ä¸ªç¯å¢ƒå˜é‡ GRUB_DISABLE_OS_PROBER=true ç¦ç”¨ os-proberã€‚å…¶ä»–é…ç½®é¡¹è¯´æ˜å‚è€ƒ CentOS ç¯‡ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"ç½‘ç»œå¼•å¯¼"},"children":[{"type":"text","value":"ç½‘ç»œå¼•å¯¼"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä»"},{"type":"element","tag":"a","props":{"href":"http://cdimage.ubuntu.com/netboot/","rel":["nofollow"]},"children":[{"type":"text","value":"è¿™é‡Œ"}]},{"type":"text","value":"ä¸‹è½½ Ubuntu çš„ç½‘ç»œå¼•å¯¼é•œåƒï¼Œè§£å‹åˆ° TFTP ç›®å½•ä¸‹ã€‚"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/ubuntu\n\nwget http://archive.ubuntu.com/ubuntu/dists/bionic-updates/main/installer-amd64/current/images/netboot/netboot.tar.gz\ntar -xvzf netboot.tar.gz -C /srv/tftp/ubuntu\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"mkdir -p /srv/tftp/ubuntu"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"wget http://archive.ubuntu.com/ubuntu/dists/bionic-updates/main/installer-amd64/current/images/netboot/netboot.tar.gz"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"tar -xvzf netboot.tar.gz -C /srv/tftp/ubuntu"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"è½¯ä»¶åŒ…ç¼“å­˜"},"children":[{"type":"text","value":"è½¯ä»¶åŒ…ç¼“å­˜"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ubuntu å®‰è£…ç¨‹åºæ”¯æŒ APT å®‰è£…è½¯ä»¶åŒ…ï¼Œé»˜è®¤æ˜¯ä»å®˜æ–¹è½¯ä»¶æºä¸‹è½½ã€‚ä½†å¦‚æœæ‰¹é‡å®‰è£…ï¼Œå¤–ç½‘æ€•æ˜¯ä¼šç‚¸ï¼Œæ‰€ä»¥è¦åœ¨å†…ç½‘ï¼ˆPXE Serverï¼‰æ­å»ºè½¯ä»¶åŒ…ç¼“å­˜æœåŠ¡ã€‚"}]},{"type":"element","tag":"code","props":{"code":"sudo apt-get install apt-cacher-ng\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo apt-get install apt-cacher-ng"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å®‰è£…å®Œæˆåï¼Œåœ¨ Preseed è„šæœ¬ä¸­é…ç½®æºä»£ç† "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"d-i mirror/http/proxy string http://<YOUR_IP>:3142/"}]},{"type":"text","value":" æŒ‡å‘è¯¥æœºå™¨ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"preseed"},"children":[{"type":"text","value":"Preseed"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Preseed è„šæœ¬å¯é…ç½®é¡¹éå¸¸å¤šï¼Œè¯¦ç»†å¯å‚è§"},{"type":"element","tag":"a","props":{"href":"https://www.debian.org/releases/stretch/amd64/apbs04.html.en","rel":["nofollow"]},"children":[{"type":"text","value":"å®˜æ–¹æ–‡æ¡£"}]},{"type":"text","value":"ã€‚ä¸‹é¢ç®€å•ä¸¾å‡ ä¸ªğŸŒ°ï¼Œå¯æ ¹æ®è‡ªèº«éœ€æ±‚ä¿®æ”¹ã€‚"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ç›¸åŒçš„éƒ¨åˆ†"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç³»ç»Ÿç›˜ä½¿ç”¨ LVM æ–¹å¼åˆ†åŒºï¼Œé™¤äº† "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot,/boot/efi"}]},{"type":"text","value":" åˆ†åŒºå¤–ï¼Œå…¶ä½™ç©ºé—´å…¨ç»™æ ¹ç›®å½•ï¼Œç¦ç”¨ SWAP åˆ†åŒºã€‚å¯ç”¨ ROOT ç”¨æˆ·ï¼Œå…è®¸ ROOT ç”¨æˆ·è¿œç¨‹ç™»å½•ï¼Œå®‰è£… "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"openssh-server openssh-client vim curl"}]},{"type":"text","value":" è½¯ä»¶ã€‚"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ç³»ç»Ÿç›˜åå­—å›ºå®šï¼Œæ¯”å¦‚å•å— SATA ç³»ç»Ÿç›˜é»˜è®¤è®¾å¤‡åæ˜¯ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/dev/sda"}]},{"type":"text","value":"ï¼Œå•å— NVMe SSD æ˜¯ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/dev/nvme0n1"}]},{"type":"text","value":"ï¼Œè¿™æ ·ç³»ç»Ÿç›˜å¯ä»¥å†™æ­»åœ¨é…ç½®ä¸­ã€‚"}]}]},{"type":"element","tag":"code","props":{"code":"### Unattended Installation\nd-i auto-install/enable boolean true\nd-i debconf/priority select critical\n\n### Localization\nd-i debian-installer/locale string en_US.UTF-8\nd-i localechooser/languagelist select en\nd-i localechooser/shortlist/en select US\nd-i localechooser/continentlist select Asia\nd-i localechooser/countrylist/Asia select China\nd-i console-setup/ask_detect boolean false\nd-i keyboard-configuration/xkb-keymap select us\n\n### Account setup\nd-i passwd/root-login boolean true\nd-i passwd/make-user boolean false\nd-i passwd/root-password password ABC123def\nd-i passwd/root-password-again password ABC123def\nd-i user-setup/allow-password-weak boolean true\n\n### Network configuration\nd-i netcfg/choose_interface select auto\nd-i netcfg/get_hostname string cat\nd-i hw-detect/load_firmware boolean true\n\n# If you want the preconfiguration file to work on systems both with and\n# without a dhcp server, uncomment these lines and the static network\n# configuration below.\nd-i netcfg/dhcp_failed note\nd-i netcfg/dhcp_options select Configure network manually\n\n# Static network configuration.\nd-i netcfg/get_ipaddress string 172.16.1.207\nd-i netcfg/get_netmask string 255.255.0.0\nd-i netcfg/get_gateway string 172.16.255.254\nd-i netcfg/get_nameservers string 223.5.5.5\nd-i netcfg/confirm_static boolean true\n\n### Partition\n# Specify a disk to partition. The device name\n# can be given in either devfs or traditional non-devfs format.\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n# In addition, you'll need to specify the method to use.\n# The presently available methods are: \"regular\", \"lvm\" and \"crypto\"\nd-i partman-auto/method string lvm\n\n# If one of the disks that are going to be automatically partitioned\n# contains an old LVM configuration, the user will normally receive a\n# warning. This can be preseeded away...\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# http://cptyesterday.wordpress.com/2012/06/17/notes-on-using-expert_recipe-in-debianubuntu-preseed-files/\nd-i partman-auto/choose_recipe select boot-root\nd-i partman-auto-lvm/new_vg_name string main\nd-i partman-auto-lvm/guided_size string max\n\nd-i partman-auto/expert_recipe string                \\\n    boot-root ::                                     \\\n        1 1 1 free                                   \\\n            $bios_boot{ }                            \\\n            method{ biosgrub }                       \\\n        .                                            \\\n        256 256 256 fat32                            \\\n            $primary{ }                              \\\n            $iflabel{ gpt }                          \\\n            $reusemethod{ }                          \\\n            method{ efi } format{ }                  \\\n            mountpoint{ /boot/efi }                  \\\n        .                                            \\\n        512 512 512 ext4                             \\\n            $primary{ }                              \\\n            $bootable{ }                             \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ /boot }                      \\\n        .                                            \\\n        4096 4096 -1 ext4                            \\\n            $lvmok{ }                                \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ / }                          \\\n            lv_name{ root }                          \\\n        .\n\n# Write the changes to disks and configure LVM\nd-i partman/confirm boolean true\nd-i partman-lvm/confirm boolean true\nd-i partman-lvm/confirm_nooverwrite boolean true\n\n# http://ubuntuforums.org/showthread.php?p=9626883\nd-i partman-lvm/device_remove_lvm boolean true\n\n# This makes partman automatically partition without confirmation.\nd-i partman/choose_partition \\\n      select Finish partitioning and write changes to disk\nd-i partman/confirm_nooverwrite boolean true\n\nd-i pkgsel/include string openssh-server openssh-client vim curl\n\n### Mirror settings\nd-i mirror/country string manual\nd-i mirror/http/hostname string mirrors.ustc.edu.cn\nd-i mirror/http/directory string /ubuntu\nd-i mirror/http/proxy string http://172.16.1.1:3142/\n\n# Custom commands\nd-i preseed/late_command string \\\n    in-target sh -c 'sed -i \"/#PermitRootLogin/a PermitRootLogin yes\" /etc/ssh/sshd_config';\n\nfinish-install finish-install/keep-consoles boolean false\nd-i finish-install/reboot_in_progress note\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Unattended Installation"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i auto-install/enable boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i debconf/priority "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" critical"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Localization"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i debian-installer/locale string en_US.UTF-8"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i localechooser/languagelist "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" en"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i localechooser/shortlist/en "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" US"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i localechooser/continentlist "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" Asia"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i localechooser/countrylist/Asia "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" China"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i console-setup/ask_detect boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i keyboard-configuration/xkb-keymap "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" us"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Account setup"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i passwd/root-login boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i passwd/make-user boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i passwd/root-password password ABC123def"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i passwd/root-password-again password ABC123def"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i user-setup/allow-password-weak boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Network configuration"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/choose_interface "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" auto"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_hostname string cat"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i hw-detect/load_firmware boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# If you want the preconfiguration file to work on systems both with and"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# without a dhcp server, uncomment these lines and the static network"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# configuration below."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/dhcp_failed note"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/dhcp_options "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" Configure network manually"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# Static network configuration."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_ipaddress string 172.16.1.207"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_netmask string 255.255.0.0"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_gateway string 172.16.255.254"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_nameservers string 223.5.5.5"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/confirm_static boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Partition"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# Specify a disk to partition. The device name"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# can be given in either devfs or traditional non-devfs format."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/disk string /dev/nvme0n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i grub-installer/bootdev string /dev/nvme0n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# In addition, you'll need to specify the method to use."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# The presently available methods are: \"regular\", \"lvm\" and \"crypto\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/method string lvm"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# If one of the disks that are going to be automatically partitioned"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# contains an old LVM configuration, the user will normally receive a"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# warning. This can be preseeded away..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/purge_lvm_from_device boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# http://cptyesterday.wordpress.com/2012/06/17/notes-on-using-expert_recipe-in-debianubuntu-preseed-files/"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/choose_recipe "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" boot-root"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto-lvm/new_vg_name string main"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto-lvm/guided_size string max"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/expert_recipe string                \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    boot-root ::                                     \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        1 1 1 free                                   \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $bios_boot{ }                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            method{ biosgrub }                       \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"                                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        256 256 256 fat32                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $primary{ }                              \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $iflabel{ gpt }                          \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $reusemethod{ }                          \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            method{ efi } format{ }                  \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            mountpoint{ /boot/efi }                  \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"                                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        512 512 512 ext4                             \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $primary{ }                              \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $bootable{ }                             \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            method{ format } format{ }               \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            use_filesystem{ } filesystem{ ext4 }     \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            mountpoint{ /boot }                      \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"                                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        4096 4096 -1 ext4                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $lvmok{ }                                \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            method{ format } format{ }               \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            use_filesystem{ } filesystem{ ext4 }     \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            mountpoint{ / }                          \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            lv_name{ root }                          \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# Write the changes to disks and configure LVM"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/confirm boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-lvm/confirm boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-lvm/confirm_nooverwrite boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# http://ubuntuforums.org/showthread.php?p=9626883"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-lvm/device_remove_lvm boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# This makes partman automatically partition without confirmation."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/choose_partition \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" Finish partitioning and write changes to disk"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/confirm_nooverwrite boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i pkgsel/include string openssh-server openssh-client vim curl"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Mirror settings"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i mirror/country string manual"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i mirror/http/hostname string mirrors.ustc.edu.cn"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i mirror/http/directory string /ubuntu"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i mirror/http/proxy string http://172.16.1.1:3142/"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# Custom commands"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i preseed/late_command string \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    in-target sh -c "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"'sed -i \"/#PermitRootLogin/a PermitRootLogin yes\" /etc/ssh/sshd_config'"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"finish-install finish-install/keep-consoles boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i finish-install/reboot_in_progress note"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"æœºå™¨å®‰è£…å¤šå—ç¡¬ç›˜ï¼Œæ¯”å¦‚æœ‰ 5 å— NVMe SSDï¼Œ256GBx1 & 2TBx4ï¼Œç³»ç»Ÿè£…åœ¨ 256GB çš„ç¡¬ç›˜ä¸Šã€‚"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åŸºäºä¸Šé¢çš„è„šæœ¬ï¼Œåœ¨ early_command ä¸­ä½¿ç”¨ Bash è„šæœ¬ï¼Œé€šè¿‡ debconf-set æ¥åŠ¨æ€æŒ‡å®šç¡¬ç›˜ä½ç½®ã€‚"}]},{"type":"element","tag":"code","props":{"code":"# åˆ é™¤ä¸‹é¢ä¸¤ä¸ªé…ç½®\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n\n# ç”¨è¿™ä¸ªè„šæœ¬æ‰¾å‡ºå°äº 300GB çš„ç¡¬ç›˜ï¼ŒæŒ‡å®šä¸ºç³»ç»Ÿç›˜\nd-i partman/early_command string \\\n  for BOOTDEV in nvme0n1 nvme1n1 nvme2n1 nvme3n1 nvme4n1; do \\\n    if [ -d /sys/block/$BOOTDEV ]; then \\\n      SIZE=`cat /sys/block/$BOOTDEV/size`; \\\n      GB=$(($SIZE/2**21)); \\\n      if [ $GB -lt 300 ]; then \\\n        debconf-set partman-auto/disk \"/dev/$BOOTDEV\"; \\\n        debconf-set grub-installer/bootdev \"/dev/$BOOTDEV\"; \\\n      fi; \\\n    fi; \\\n  done\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# åˆ é™¤ä¸‹é¢ä¸¤ä¸ªé…ç½®"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/disk string /dev/nvme0n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i grub-installer/bootdev string /dev/nvme0n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# ç”¨è¿™ä¸ªè„šæœ¬æ‰¾å‡ºå°äº 300GB çš„ç¡¬ç›˜ï¼ŒæŒ‡å®šä¸ºç³»ç»Ÿç›˜"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/early_command string \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" BOOTDEV "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" nvme0n1 nvme1n1 nvme2n1 nvme3n1 nvme4n1"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"do"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" /sys/block/$BOOTDEV ]"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      SIZE="}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"`cat /sys/block/"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$BOOTDEV"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"/size`"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      GB="}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"$(("}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$SIZE"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"**"}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"21"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"))"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" [ $GB "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"-lt"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" 300 ]"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        debconf-set partman-auto/disk "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\"/dev/"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$BOOTDEV"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        debconf-set grub-installer/bootdev "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\"/dev/"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$BOOTDEV"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"fi;"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"fi;"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"done"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"æœºå™¨æœ¬æ¥æœ‰ç³»ç»Ÿï¼Œéœ€è¦æ‰¹é‡é‡è£…ï¼ŒåŸç³»ç»Ÿä¹Ÿæ˜¯ LVM æ–¹å¼åˆ†åŒºã€‚"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å…ˆç§»é™¤å·²å­˜åœ¨çš„ LVM åˆ†åŒºï¼Œå†å°è¯•å®‰è£…ï¼ˆè™½ç„¶æœ‰ç›¸å…³é…ç½®é¡¹ï¼Œä½†è¯¥ç‰ˆæœ¬å¯èƒ½å­˜åœ¨ "},{"type":"element","tag":"a","props":{"href":"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=740271","rel":["nofollow"]},"children":[{"type":"text","value":"BUG"}]},{"type":"text","value":"ï¼‰ã€‚"}]},{"type":"element","tag":"code","props":{"code":"# ç§»é™¤ LVM åˆ†åŒº\nd-i partman-lvm/device_remove_lvm boolean true\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# ä¸Šè¿°é…ç½®é¡¹å¯èƒ½å­˜åœ¨ BUGï¼Œé‚£å°±äº²è‡ªåˆ ä¸€é\nd-i partman/early_command string \\\n    set -- $(vgs --rows --noheadings | head -n 1); \\\n    for vg in \"$@\"; do \\\n        swapoff \"/dev/$vg/swap\"; \\\n        vgremove -f \"$vg\"; \\\n    done; \\\n    set -- $(pvs --rows --noheadings | head -n 1); \\\n    for pv in \"$@\"; do \\\n        pvremove -f \"$pv\"; \\\n    done\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# ç§»é™¤ LVM åˆ†åŒº"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-lvm/device_remove_lvm boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/purge_lvm_from_device boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# ä¸Šè¿°é…ç½®é¡¹å¯èƒ½å­˜åœ¨ BUGï¼Œé‚£å°±äº²è‡ªåˆ ä¸€é"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/early_command string \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" -- "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"$(vgs --rows --noheadings "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":" head -n 1)"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" vg "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$@"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"do"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        swapoff "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\"/dev/"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$vg"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"/swap\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        vgremove -f "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$vg"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"done;"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" -- "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"$(pvs --rows --noheadings "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":" head -n 1)"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" pv "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$@"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"do"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        pvremove -f "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$pv"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"done"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Preseed æ–‡ä»¶æ”¾åˆ° TFTP æ ¹ç›®å½• "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/srv/tftp/"}]},{"type":"text","value":" ä¸‹ï¼Œä¹Ÿå°±æ˜¯ GRUB èœå•é…ç½®é‡Œ url æŒ‡å®šçš„é‚£ä¸ªã€‚"}]},{"type":"element","tag":"h2","props":{"id":"pxe-å¼•å¯¼"},"children":[{"type":"text","value":"PXE å¼•å¯¼"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ç¡®ä¿å†…ç½‘ä¸­æ²¡æœ‰å…¶ä»– DHCP æœåŠ¡ï¼Œå°†æœºå™¨æ¥åœ¨ PXE Server åŒä¸€ä¸ªäº¤æ¢æœºä¸‹ã€‚é‡å¯æœºå™¨ï¼Œå¯åŠ¨æ—¶é€‰æ‹©ä» PXE å¼•å¯¼ï¼Œè§‚å¯Ÿæ˜¯å¦è·å¾— IPï¼Œèƒ½å¦ä¸‹è½½å¯åŠ¨æ–‡ä»¶ã€‚æ­£å¸¸çš„è¯ç¨åå°±èƒ½çœ‹åˆ° Ubuntu å®‰è£…ç•Œé¢ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"å‚è€ƒ"},"children":[{"type":"text","value":"å‚è€ƒ"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.ubuntu.com/UEFI/PXE-netboot-install","rel":["nofollow"]},"children":[{"type":"text","value":"https://wiki.ubuntu.com/UEFI/PXE-netboot-install"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.debian.org/releases/etch/ia64/apbs04.html.en","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.debian.org/releases/etch/ia64/apbs04.html.en"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-8a0db2{color:#0A3069}.ct-724c3a{color:#CF222E}.ct-93a0e2{color:#0550AE}.ct-a80ec9{color:#6E7781}.ct-7d49ad{color:#24292F}.dark .ct-7d49ad{color:#C9D1D9}.dark .ct-a80ec9{color:#8B949E}.dark .ct-93a0e2{color:#79C0FF}.dark .ct-724c3a{color:#FF7B72}.dark .ct-8a0db2{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"æ¦‚è¿°","depth":2,"text":"æ¦‚è¿°"},{"id":"å®‰è£…è½¯ä»¶","depth":2,"text":"å®‰è£…è½¯ä»¶"},{"id":"é…ç½®-pxe-server","depth":2,"text":"é…ç½® PXE Server","children":[{"id":"boot-loader","depth":3,"text":"Boot loader"},{"id":"grub","depth":3,"text":"GRUB"},{"id":"ç½‘ç»œå¼•å¯¼","depth":3,"text":"ç½‘ç»œå¼•å¯¼"},{"id":"è½¯ä»¶åŒ…ç¼“å­˜","depth":3,"text":"è½¯ä»¶åŒ…ç¼“å­˜"}]},{"id":"preseed","depth":2,"text":"Preseed"},{"id":"pxe-å¼•å¯¼","depth":2,"text":"PXE å¼•å¯¼"},{"id":"å‚è€ƒ","depth":2,"text":"å‚è€ƒ"}]}},"_type":"markdown","_id":"content:blog:pxe-ubuntu.md","_source":"content","_file":"blog/pxe-ubuntu.md","_extension":"md"}