{"_path":"/blog/pxe-ubuntu","_dir":"blog","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"批量重装 Ubuntu 18.04","description":"Ubuntu Server 18.04.5 系统安装使用 debian-installer，兼容 Kickstart 但不够灵活，比如从 5 块 NVMe 硬盘中找到容量最小的盘安装系统这种操作就很难做到。自家的脚本是 Preseed，功能非常强大，能完成一些图形安装界面届不到的操作（缺点是有一点点复杂）。","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"概述"},"children":[{"type":"text","value":"概述"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ubuntu Server 18.04.5 系统安装使用 debian-installer，兼容 Kickstart 但不够灵活，比如从 5 块 NVMe 硬盘中找到容量最小的盘安装系统这种操作就很难做到。自家的脚本是 Preseed，功能非常强大，能完成一些图形安装界面届不到的操作（缺点是有一点点复杂）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 "},{"type":"element","tag":"a","props":{"href":"/note/linux/pxe-centos.html"},"children":[{"type":"text","value":"CentOS 篇"}]},{"type":"text","value":"中，PXE Server 需要安装 DHCP/TFTP/Nginx 等众多软件。这次改用 Dnsmasq 同时提供 DHCP 和 TFTP 服务。也省去 Nginx，直接从软件源安装系统。"}]},{"type":"element","tag":"h2","props":{"id":"安装软件"},"children":[{"type":"text","value":"安装软件"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下载 Ubuntu 镜像，文中使用的是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ubuntu-18.04.5-server-amdyes.iso"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装 dnsmasq 服务。"}]},{"type":"element","tag":"code","props":{"code":"sudo apt update\nsudo apt install dnsmasq\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo apt update\nsudo apt install dnsmasq\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"配置 dnsmasq，开启 DHCP 和 TFTP 功能。"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/\n\nvim /etc/dnsmasq.conf\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir -p /srv/tftp/\n\nvim /etc/dnsmasq.conf\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"内容如下。"}]},{"type":"element","tag":"code","props":{"code":"interface=eth0\nbind-interfaces\ndhcp-range=172.16.199.1,172.16.199.254\ndhcp-boot=grubnetx64.efi.signed\ndhcp-host=172.16.199.1\n\nenable-tftp\ntftp-root=/srv/tftp/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"interface=eth0\nbind-interfaces\ndhcp-range=172.16.199.1,172.16.199.254\ndhcp-boot=grubnetx64.efi.signed\ndhcp-host=172.16.199.1\n\nenable-tftp\ntftp-root=/srv/tftp/\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"其中，interface 是当前使用的网络接口，dhcp-boot 是 grub 引导程序的位置，dhcp-host 是 DHCP Server 网关 IP（可用来可访问本机器），tftp-root 则是 TFTP Server 的根目录。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"启动 dnsmasq 服务。"}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl start dnsmasq\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo systemctl start dnsmasq\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"配置-pxe-server"},"children":[{"type":"text","value":"配置 PXE Server"}]},{"type":"element","tag":"h3","props":{"id":"boot-loader"},"children":[{"type":"text","value":"Boot loader"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"UEFI 启动需要一个 boot loader（文中是 GRUB）。从软件源下载，然后丢进 TFTP 根目录。"}]},{"type":"element","tag":"code","props":{"code":"sudo apt-get install grub-efi-amd64-signed\n\nsudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed /srv/tftp/grubnetx64.efi.signed\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo apt-get install grub-efi-amd64-signed\n\nsudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed /srv/tftp/grubnetx64.efi.signed\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"grubnetx64.efi.signed 这个名字就是在 /etc/dnsmasq.conf 的 dhcp-boot 字段中定义的那个。"}]},{"type":"element","tag":"h3","props":{"id":"grub"},"children":[{"type":"text","value":"GRUB"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"配置 GRUB，其实就是 Ubuntu 那个选择系统的启动菜单，添加一个启动项，把系统位置从硬盘改为网络。"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/grub\nvim /srv/tftp/grub/grub.cfg\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir -p /srv/tftp/grub\nvim /srv/tftp/grub/grub.cfg\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"内容如下。"}]},{"type":"element","tag":"code","props":{"code":"set default=\"0\"\nset timeout=6\nmenuentry \"Install Ubuntu\" {\n  set gfxpayload=keep\n  linux /ubuntu/linux gfxpayload=800x600x16,800x600 --- auto=true priority=critical interface=auto hostname=fox GRUB_DISABLE_OS_PROBER=true url=tftp://172.16.1.1/preseed.cfg quiet\n  initrd /ubuntu/initrd.gz\n}\n...\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"set default=\"0\"\nset timeout=6\nmenuentry \"Install Ubuntu\" {\n  set gfxpayload=keep\n  linux /ubuntu/linux gfxpayload=800x600x16,800x600 --- auto=true priority=critical interface=auto hostname=fox GRUB_DISABLE_OS_PROBER=true url=tftp://172.16.1.1/preseed.cfg quiet\n  initrd /ubuntu/initrd.gz\n}\n...\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"由于 Ubuntu 18.04 的 os-prober 操作 LVM 分区时会触发 "},{"type":"element","tag":"a","props":{"href":"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=853927","rel":["nofollow"]},"children":[{"type":"text","value":"BUG"}]},{"type":"text","value":"，所以加了个环境变量 GRUB_DISABLE_OS_PROBER=true 禁用 os-prober。其他配置项说明参考 CentOS 篇。"}]},{"type":"element","tag":"h3","props":{"id":"网络引导"},"children":[{"type":"text","value":"网络引导"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"从"},{"type":"element","tag":"a","props":{"href":"http://cdimage.ubuntu.com/netboot/","rel":["nofollow"]},"children":[{"type":"text","value":"这里"}]},{"type":"text","value":"下载 Ubuntu 的网络引导镜像，解压到 TFTP 目录下。"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/ubuntu\n\nwget http://archive.ubuntu.com/ubuntu/dists/bionic-updates/main/installer-amd64/current/images/netboot/netboot.tar.gz\ntar -xvzf netboot.tar.gz -C /srv/tftp/ubuntu\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir -p /srv/tftp/ubuntu\n\nwget http://archive.ubuntu.com/ubuntu/dists/bionic-updates/main/installer-amd64/current/images/netboot/netboot.tar.gz\ntar -xvzf netboot.tar.gz -C /srv/tftp/ubuntu\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"软件包缓存"},"children":[{"type":"text","value":"软件包缓存"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ubuntu 安装程序支持 APT 安装软件包，默认是从官方软件源下载。但如果批量安装，外网怕是会炸，所以要在内网（PXE Server）搭建软件包缓存服务。"}]},{"type":"element","tag":"code","props":{"code":"sudo apt-get install apt-cacher-ng\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo apt-get install apt-cacher-ng\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装完成后，在 Preseed 脚本中配置源代理 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"d-i mirror/http/proxy string http://<YOUR_IP>:3142/"}]},{"type":"text","value":" 指向该机器。"}]},{"type":"element","tag":"h2","props":{"id":"preseed"},"children":[{"type":"text","value":"Preseed"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Preseed 脚本可配置项非常多，详细可参见"},{"type":"element","tag":"a","props":{"href":"https://www.debian.org/releases/stretch/amd64/apbs04.html.en","rel":["nofollow"]},"children":[{"type":"text","value":"官方文档"}]},{"type":"text","value":"。下面简单举几个🌰，可根据自身需求修改。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"相同的部分"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"系统盘使用 LVM 方式分区，除了 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot,/boot/efi"}]},{"type":"text","value":" 分区外，其余空间全给根目录，禁用 SWAP 分区。启用 ROOT 用户，允许 ROOT 用户远程登录，安装 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"openssh-server openssh-client vim curl"}]},{"type":"text","value":" 软件。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"系统盘名字固定，比如单块 SATA 系统盘默认设备名是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/dev/sda"}]},{"type":"text","value":"，单块 NVMe SSD 是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/dev/nvme0n1"}]},{"type":"text","value":"，这样系统盘可以写死在配置中。"}]}]},{"type":"element","tag":"code","props":{"code":"### Unattended Installation\nd-i auto-install/enable boolean true\nd-i debconf/priority select critical\n\n### Localization\nd-i debian-installer/locale string en_US.UTF-8\nd-i localechooser/languagelist select en\nd-i localechooser/shortlist/en select US\nd-i localechooser/continentlist select Asia\nd-i localechooser/countrylist/Asia select China\nd-i console-setup/ask_detect boolean false\nd-i keyboard-configuration/xkb-keymap select us\n\n### Account setup\nd-i passwd/root-login boolean true\nd-i passwd/make-user boolean false\nd-i passwd/root-password password ABC123def\nd-i passwd/root-password-again password ABC123def\nd-i user-setup/allow-password-weak boolean true\n\n### Network configuration\nd-i netcfg/choose_interface select auto\nd-i netcfg/get_hostname string cat\nd-i hw-detect/load_firmware boolean true\n\n# If you want the preconfiguration file to work on systems both with and\n# without a dhcp server, uncomment these lines and the static network\n# configuration below.\nd-i netcfg/dhcp_failed note\nd-i netcfg/dhcp_options select Configure network manually\n\n# Static network configuration.\nd-i netcfg/get_ipaddress string 172.16.1.207\nd-i netcfg/get_netmask string 255.255.0.0\nd-i netcfg/get_gateway string 172.16.255.254\nd-i netcfg/get_nameservers string 223.5.5.5\nd-i netcfg/confirm_static boolean true\n\n### Partition\n# Specify a disk to partition. The device name\n# can be given in either devfs or traditional non-devfs format.\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n# In addition, you'll need to specify the method to use.\n# The presently available methods are: \"regular\", \"lvm\" and \"crypto\"\nd-i partman-auto/method string lvm\n\n# If one of the disks that are going to be automatically partitioned\n# contains an old LVM configuration, the user will normally receive a\n# warning. This can be preseeded away...\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# http://cptyesterday.wordpress.com/2012/06/17/notes-on-using-expert_recipe-in-debianubuntu-preseed-files/\nd-i partman-auto/choose_recipe select boot-root\nd-i partman-auto-lvm/new_vg_name string main\nd-i partman-auto-lvm/guided_size string max\n\nd-i partman-auto/expert_recipe string                \\\n    boot-root ::                                     \\\n        1 1 1 free                                   \\\n            $bios_boot{ }                            \\\n            method{ biosgrub }                       \\\n        .                                            \\\n        256 256 256 fat32                            \\\n            $primary{ }                              \\\n            $iflabel{ gpt }                          \\\n            $reusemethod{ }                          \\\n            method{ efi } format{ }                  \\\n            mountpoint{ /boot/efi }                  \\\n        .                                            \\\n        512 512 512 ext4                             \\\n            $primary{ }                              \\\n            $bootable{ }                             \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ /boot }                      \\\n        .                                            \\\n        4096 4096 -1 ext4                            \\\n            $lvmok{ }                                \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ / }                          \\\n            lv_name{ root }                          \\\n        .\n\n# Write the changes to disks and configure LVM\nd-i partman/confirm boolean true\nd-i partman-lvm/confirm boolean true\nd-i partman-lvm/confirm_nooverwrite boolean true\n\n# http://ubuntuforums.org/showthread.php?p=9626883\nd-i partman-lvm/device_remove_lvm boolean true\n\n# This makes partman automatically partition without confirmation.\nd-i partman/choose_partition \\\n      select Finish partitioning and write changes to disk\nd-i partman/confirm_nooverwrite boolean true\n\nd-i pkgsel/include string openssh-server openssh-client vim curl\n\n### Mirror settings\nd-i mirror/country string manual\nd-i mirror/http/hostname string mirrors.ustc.edu.cn\nd-i mirror/http/directory string /ubuntu\nd-i mirror/http/proxy string http://172.16.1.1:3142/\n\n# Custom commands\nd-i preseed/late_command string \\\n    in-target sh -c 'sed -i \"/#PermitRootLogin/a PermitRootLogin yes\" /etc/ssh/sshd_config';\n\nfinish-install finish-install/keep-consoles boolean false\nd-i finish-install/reboot_in_progress note\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"### Unattended Installation\nd-i auto-install/enable boolean true\nd-i debconf/priority select critical\n\n### Localization\nd-i debian-installer/locale string en_US.UTF-8\nd-i localechooser/languagelist select en\nd-i localechooser/shortlist/en select US\nd-i localechooser/continentlist select Asia\nd-i localechooser/countrylist/Asia select China\nd-i console-setup/ask_detect boolean false\nd-i keyboard-configuration/xkb-keymap select us\n\n### Account setup\nd-i passwd/root-login boolean true\nd-i passwd/make-user boolean false\nd-i passwd/root-password password ABC123def\nd-i passwd/root-password-again password ABC123def\nd-i user-setup/allow-password-weak boolean true\n\n### Network configuration\nd-i netcfg/choose_interface select auto\nd-i netcfg/get_hostname string cat\nd-i hw-detect/load_firmware boolean true\n\n# If you want the preconfiguration file to work on systems both with and\n# without a dhcp server, uncomment these lines and the static network\n# configuration below.\nd-i netcfg/dhcp_failed note\nd-i netcfg/dhcp_options select Configure network manually\n\n# Static network configuration.\nd-i netcfg/get_ipaddress string 172.16.1.207\nd-i netcfg/get_netmask string 255.255.0.0\nd-i netcfg/get_gateway string 172.16.255.254\nd-i netcfg/get_nameservers string 223.5.5.5\nd-i netcfg/confirm_static boolean true\n\n### Partition\n# Specify a disk to partition. The device name\n# can be given in either devfs or traditional non-devfs format.\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n# In addition, you'll need to specify the method to use.\n# The presently available methods are: \"regular\", \"lvm\" and \"crypto\"\nd-i partman-auto/method string lvm\n\n# If one of the disks that are going to be automatically partitioned\n# contains an old LVM configuration, the user will normally receive a\n# warning. This can be preseeded away...\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# http://cptyesterday.wordpress.com/2012/06/17/notes-on-using-expert_recipe-in-debianubuntu-preseed-files/\nd-i partman-auto/choose_recipe select boot-root\nd-i partman-auto-lvm/new_vg_name string main\nd-i partman-auto-lvm/guided_size string max\n\nd-i partman-auto/expert_recipe string                \\\n    boot-root ::                                     \\\n        1 1 1 free                                   \\\n            $bios_boot{ }                            \\\n            method{ biosgrub }                       \\\n        .                                            \\\n        256 256 256 fat32                            \\\n            $primary{ }                              \\\n            $iflabel{ gpt }                          \\\n            $reusemethod{ }                          \\\n            method{ efi } format{ }                  \\\n            mountpoint{ /boot/efi }                  \\\n        .                                            \\\n        512 512 512 ext4                             \\\n            $primary{ }                              \\\n            $bootable{ }                             \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ /boot }                      \\\n        .                                            \\\n        4096 4096 -1 ext4                            \\\n            $lvmok{ }                                \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ / }                          \\\n            lv_name{ root }                          \\\n        .\n\n# Write the changes to disks and configure LVM\nd-i partman/confirm boolean true\nd-i partman-lvm/confirm boolean true\nd-i partman-lvm/confirm_nooverwrite boolean true\n\n# http://ubuntuforums.org/showthread.php?p=9626883\nd-i partman-lvm/device_remove_lvm boolean true\n\n# This makes partman automatically partition without confirmation.\nd-i partman/choose_partition \\\n      select Finish partitioning and write changes to disk\nd-i partman/confirm_nooverwrite boolean true\n\nd-i pkgsel/include string openssh-server openssh-client vim curl\n\n### Mirror settings\nd-i mirror/country string manual\nd-i mirror/http/hostname string mirrors.ustc.edu.cn\nd-i mirror/http/directory string /ubuntu\nd-i mirror/http/proxy string http://172.16.1.1:3142/\n\n# Custom commands\nd-i preseed/late_command string \\\n    in-target sh -c 'sed -i \"/#PermitRootLogin/a PermitRootLogin yes\" /etc/ssh/sshd_config';\n\nfinish-install finish-install/keep-consoles boolean false\nd-i finish-install/reboot_in_progress note\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"机器安装多块硬盘，比如有 5 块 NVMe SSD，256GBx1 & 2TBx4，系统装在 256GB 的硬盘上。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"基于上面的脚本，在 early_command 中使用 Bash 脚本，通过 debconf-set 来动态指定硬盘位置。"}]},{"type":"element","tag":"code","props":{"code":"# 删除下面两个配置\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n\n# 用这个脚本找出小于 300GB 的硬盘，指定为系统盘\nd-i partman/early_command string \\\n  for BOOTDEV in nvme0n1 nvme1n1 nvme2n1 nvme3n1 nvme4n1; do \\\n    if [ -d /sys/block/$BOOTDEV ]; then \\\n      SIZE=`cat /sys/block/$BOOTDEV/size`; \\\n      GB=$(($SIZE/2**21)); \\\n      if [ $GB -lt 300 ]; then \\\n        debconf-set partman-auto/disk \"/dev/$BOOTDEV\"; \\\n        debconf-set grub-installer/bootdev \"/dev/$BOOTDEV\"; \\\n      fi; \\\n    fi; \\\n  done\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# 删除下面两个配置\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n\n# 用这个脚本找出小于 300GB 的硬盘，指定为系统盘\nd-i partman/early_command string \\\n  for BOOTDEV in nvme0n1 nvme1n1 nvme2n1 nvme3n1 nvme4n1; do \\\n    if [ -d /sys/block/$BOOTDEV ]; then \\\n      SIZE=`cat /sys/block/$BOOTDEV/size`; \\\n      GB=$(($SIZE/2**21)); \\\n      if [ $GB -lt 300 ]; then \\\n        debconf-set partman-auto/disk \"/dev/$BOOTDEV\"; \\\n        debconf-set grub-installer/bootdev \"/dev/$BOOTDEV\"; \\\n      fi; \\\n    fi; \\\n  done\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"机器本来有系统，需要批量重装，原系统也是 LVM 方式分区。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"先移除已存在的 LVM 分区，再尝试安装（虽然有相关配置项，但该版本可能存在 "},{"type":"element","tag":"a","props":{"href":"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=740271","rel":["nofollow"]},"children":[{"type":"text","value":"BUG"}]},{"type":"text","value":"）。"}]},{"type":"element","tag":"code","props":{"code":"# 移除 LVM 分区\nd-i partman-lvm/device_remove_lvm boolean true\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# 上述配置项可能存在 BUG，那就亲自删一遍\nd-i partman/early_command string \\\n    set -- $(vgs --rows --noheadings | head -n 1); \\\n    for vg in \"$@\"; do \\\n        swapoff \"/dev/$vg/swap\"; \\\n        vgremove -f \"$vg\"; \\\n    done; \\\n    set -- $(pvs --rows --noheadings | head -n 1); \\\n    for pv in \"$@\"; do \\\n        pvremove -f \"$pv\"; \\\n    done\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# 移除 LVM 分区\nd-i partman-lvm/device_remove_lvm boolean true\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# 上述配置项可能存在 BUG，那就亲自删一遍\nd-i partman/early_command string \\\n    set -- $(vgs --rows --noheadings | head -n 1); \\\n    for vg in \"$@\"; do \\\n        swapoff \"/dev/$vg/swap\"; \\\n        vgremove -f \"$vg\"; \\\n    done; \\\n    set -- $(pvs --rows --noheadings | head -n 1); \\\n    for pv in \"$@\"; do \\\n        pvremove -f \"$pv\"; \\\n    done\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Preseed 文件放到 TFTP 根目录 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/srv/tftp/"}]},{"type":"text","value":" 下，也就是 GRUB 菜单配置里 url 指定的那个。"}]},{"type":"element","tag":"h2","props":{"id":"pxe-引导"},"children":[{"type":"text","value":"PXE 引导"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"确保内网中没有其他 DHCP 服务，将机器接在 PXE Server 同一个交换机下。重启机器，启动时选择从 PXE 引导，观察是否获得 IP，能否下载启动文件。正常的话稍后就能看到 Ubuntu 安装界面。"}]},{"type":"element","tag":"h2","props":{"id":"参考"},"children":[{"type":"text","value":"参考"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.ubuntu.com/UEFI/PXE-netboot-install","rel":["nofollow"]},"children":[{"type":"text","value":"https://wiki.ubuntu.com/UEFI/PXE-netboot-install"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.debian.org/releases/etch/ia64/apbs04.html.en","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.debian.org/releases/etch/ia64/apbs04.html.en"}]}]}]}]},"date":"2020-10-20T21:05:00.000Z","tags":["linux","pxe"],"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"概述"},"children":[{"type":"text","value":"概述"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ubuntu Server 18.04.5 系统安装使用 debian-installer，兼容 Kickstart 但不够灵活，比如从 5 块 NVMe 硬盘中找到容量最小的盘安装系统这种操作就很难做到。自家的脚本是 Preseed，功能非常强大，能完成一些图形安装界面届不到的操作（缺点是有一点点复杂）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 "},{"type":"element","tag":"a","props":{"href":"/note/linux/pxe-centos.html"},"children":[{"type":"text","value":"CentOS 篇"}]},{"type":"text","value":"中，PXE Server 需要安装 DHCP/TFTP/Nginx 等众多软件。这次改用 Dnsmasq 同时提供 DHCP 和 TFTP 服务。也省去 Nginx，直接从软件源安装系统。"}]},{"type":"element","tag":"h2","props":{"id":"安装软件"},"children":[{"type":"text","value":"安装软件"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下载 Ubuntu 镜像，文中使用的是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ubuntu-18.04.5-server-amdyes.iso"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装 dnsmasq 服务。"}]},{"type":"element","tag":"code","props":{"code":"sudo apt update\nsudo apt install dnsmasq\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo apt update"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo apt install dnsmasq"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"配置 dnsmasq，开启 DHCP 和 TFTP 功能。"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/\n\nvim /etc/dnsmasq.conf\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"mkdir -p /srv/tftp/"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"vim /etc/dnsmasq.conf"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"内容如下。"}]},{"type":"element","tag":"code","props":{"code":"interface=eth0\nbind-interfaces\ndhcp-range=172.16.199.1,172.16.199.254\ndhcp-boot=grubnetx64.efi.signed\ndhcp-host=172.16.199.1\n\nenable-tftp\ntftp-root=/srv/tftp/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"interface=eth0"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"bind-interfaces"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"dhcp-range=172.16.199.1,172.16.199.254"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"dhcp-boot=grubnetx64.efi.signed"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"dhcp-host=172.16.199.1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"enable-tftp"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"tftp-root=/srv/tftp/"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"其中，interface 是当前使用的网络接口，dhcp-boot 是 grub 引导程序的位置，dhcp-host 是 DHCP Server 网关 IP（可用来可访问本机器），tftp-root 则是 TFTP Server 的根目录。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"启动 dnsmasq 服务。"}]},{"type":"element","tag":"code","props":{"code":"sudo systemctl start dnsmasq\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo systemctl start dnsmasq"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"配置-pxe-server"},"children":[{"type":"text","value":"配置 PXE Server"}]},{"type":"element","tag":"h3","props":{"id":"boot-loader"},"children":[{"type":"text","value":"Boot loader"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"UEFI 启动需要一个 boot loader（文中是 GRUB）。从软件源下载，然后丢进 TFTP 根目录。"}]},{"type":"element","tag":"code","props":{"code":"sudo apt-get install grub-efi-amd64-signed\n\nsudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed /srv/tftp/grubnetx64.efi.signed\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo apt-get install grub-efi-amd64-signed"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed /srv/tftp/grubnetx64.efi.signed"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"grubnetx64.efi.signed 这个名字就是在 /etc/dnsmasq.conf 的 dhcp-boot 字段中定义的那个。"}]},{"type":"element","tag":"h3","props":{"id":"grub"},"children":[{"type":"text","value":"GRUB"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"配置 GRUB，其实就是 Ubuntu 那个选择系统的启动菜单，添加一个启动项，把系统位置从硬盘改为网络。"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/grub\nvim /srv/tftp/grub/grub.cfg\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"mkdir -p /srv/tftp/grub"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"vim /srv/tftp/grub/grub.cfg"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"内容如下。"}]},{"type":"element","tag":"code","props":{"code":"set default=\"0\"\nset timeout=6\nmenuentry \"Install Ubuntu\" {\n  set gfxpayload=keep\n  linux /ubuntu/linux gfxpayload=800x600x16,800x600 --- auto=true priority=critical interface=auto hostname=fox GRUB_DISABLE_OS_PROBER=true url=tftp://172.16.1.1/preseed.cfg quiet\n  initrd /ubuntu/initrd.gz\n}\n...\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"set default=\"0\"\nset timeout=6\nmenuentry \"Install Ubuntu\" {\n  set gfxpayload=keep\n  linux /ubuntu/linux gfxpayload=800x600x16,800x600 --- auto=true priority=critical interface=auto hostname=fox GRUB_DISABLE_OS_PROBER=true url=tftp://172.16.1.1/preseed.cfg quiet\n  initrd /ubuntu/initrd.gz\n}\n..."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"由于 Ubuntu 18.04 的 os-prober 操作 LVM 分区时会触发 "},{"type":"element","tag":"a","props":{"href":"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=853927","rel":["nofollow"]},"children":[{"type":"text","value":"BUG"}]},{"type":"text","value":"，所以加了个环境变量 GRUB_DISABLE_OS_PROBER=true 禁用 os-prober。其他配置项说明参考 CentOS 篇。"}]},{"type":"element","tag":"h3","props":{"id":"网络引导"},"children":[{"type":"text","value":"网络引导"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"从"},{"type":"element","tag":"a","props":{"href":"http://cdimage.ubuntu.com/netboot/","rel":["nofollow"]},"children":[{"type":"text","value":"这里"}]},{"type":"text","value":"下载 Ubuntu 的网络引导镜像，解压到 TFTP 目录下。"}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /srv/tftp/ubuntu\n\nwget http://archive.ubuntu.com/ubuntu/dists/bionic-updates/main/installer-amd64/current/images/netboot/netboot.tar.gz\ntar -xvzf netboot.tar.gz -C /srv/tftp/ubuntu\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"mkdir -p /srv/tftp/ubuntu"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"wget http://archive.ubuntu.com/ubuntu/dists/bionic-updates/main/installer-amd64/current/images/netboot/netboot.tar.gz"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"tar -xvzf netboot.tar.gz -C /srv/tftp/ubuntu"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"软件包缓存"},"children":[{"type":"text","value":"软件包缓存"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ubuntu 安装程序支持 APT 安装软件包，默认是从官方软件源下载。但如果批量安装，外网怕是会炸，所以要在内网（PXE Server）搭建软件包缓存服务。"}]},{"type":"element","tag":"code","props":{"code":"sudo apt-get install apt-cacher-ng\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"sudo apt-get install apt-cacher-ng"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装完成后，在 Preseed 脚本中配置源代理 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"d-i mirror/http/proxy string http://<YOUR_IP>:3142/"}]},{"type":"text","value":" 指向该机器。"}]},{"type":"element","tag":"h2","props":{"id":"preseed"},"children":[{"type":"text","value":"Preseed"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Preseed 脚本可配置项非常多，详细可参见"},{"type":"element","tag":"a","props":{"href":"https://www.debian.org/releases/stretch/amd64/apbs04.html.en","rel":["nofollow"]},"children":[{"type":"text","value":"官方文档"}]},{"type":"text","value":"。下面简单举几个🌰，可根据自身需求修改。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"相同的部分"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"系统盘使用 LVM 方式分区，除了 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot,/boot/efi"}]},{"type":"text","value":" 分区外，其余空间全给根目录，禁用 SWAP 分区。启用 ROOT 用户，允许 ROOT 用户远程登录，安装 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"openssh-server openssh-client vim curl"}]},{"type":"text","value":" 软件。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"系统盘名字固定，比如单块 SATA 系统盘默认设备名是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/dev/sda"}]},{"type":"text","value":"，单块 NVMe SSD 是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/dev/nvme0n1"}]},{"type":"text","value":"，这样系统盘可以写死在配置中。"}]}]},{"type":"element","tag":"code","props":{"code":"### Unattended Installation\nd-i auto-install/enable boolean true\nd-i debconf/priority select critical\n\n### Localization\nd-i debian-installer/locale string en_US.UTF-8\nd-i localechooser/languagelist select en\nd-i localechooser/shortlist/en select US\nd-i localechooser/continentlist select Asia\nd-i localechooser/countrylist/Asia select China\nd-i console-setup/ask_detect boolean false\nd-i keyboard-configuration/xkb-keymap select us\n\n### Account setup\nd-i passwd/root-login boolean true\nd-i passwd/make-user boolean false\nd-i passwd/root-password password ABC123def\nd-i passwd/root-password-again password ABC123def\nd-i user-setup/allow-password-weak boolean true\n\n### Network configuration\nd-i netcfg/choose_interface select auto\nd-i netcfg/get_hostname string cat\nd-i hw-detect/load_firmware boolean true\n\n# If you want the preconfiguration file to work on systems both with and\n# without a dhcp server, uncomment these lines and the static network\n# configuration below.\nd-i netcfg/dhcp_failed note\nd-i netcfg/dhcp_options select Configure network manually\n\n# Static network configuration.\nd-i netcfg/get_ipaddress string 172.16.1.207\nd-i netcfg/get_netmask string 255.255.0.0\nd-i netcfg/get_gateway string 172.16.255.254\nd-i netcfg/get_nameservers string 223.5.5.5\nd-i netcfg/confirm_static boolean true\n\n### Partition\n# Specify a disk to partition. The device name\n# can be given in either devfs or traditional non-devfs format.\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n# In addition, you'll need to specify the method to use.\n# The presently available methods are: \"regular\", \"lvm\" and \"crypto\"\nd-i partman-auto/method string lvm\n\n# If one of the disks that are going to be automatically partitioned\n# contains an old LVM configuration, the user will normally receive a\n# warning. This can be preseeded away...\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# http://cptyesterday.wordpress.com/2012/06/17/notes-on-using-expert_recipe-in-debianubuntu-preseed-files/\nd-i partman-auto/choose_recipe select boot-root\nd-i partman-auto-lvm/new_vg_name string main\nd-i partman-auto-lvm/guided_size string max\n\nd-i partman-auto/expert_recipe string                \\\n    boot-root ::                                     \\\n        1 1 1 free                                   \\\n            $bios_boot{ }                            \\\n            method{ biosgrub }                       \\\n        .                                            \\\n        256 256 256 fat32                            \\\n            $primary{ }                              \\\n            $iflabel{ gpt }                          \\\n            $reusemethod{ }                          \\\n            method{ efi } format{ }                  \\\n            mountpoint{ /boot/efi }                  \\\n        .                                            \\\n        512 512 512 ext4                             \\\n            $primary{ }                              \\\n            $bootable{ }                             \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ /boot }                      \\\n        .                                            \\\n        4096 4096 -1 ext4                            \\\n            $lvmok{ }                                \\\n            method{ format } format{ }               \\\n            use_filesystem{ } filesystem{ ext4 }     \\\n            mountpoint{ / }                          \\\n            lv_name{ root }                          \\\n        .\n\n# Write the changes to disks and configure LVM\nd-i partman/confirm boolean true\nd-i partman-lvm/confirm boolean true\nd-i partman-lvm/confirm_nooverwrite boolean true\n\n# http://ubuntuforums.org/showthread.php?p=9626883\nd-i partman-lvm/device_remove_lvm boolean true\n\n# This makes partman automatically partition without confirmation.\nd-i partman/choose_partition \\\n      select Finish partitioning and write changes to disk\nd-i partman/confirm_nooverwrite boolean true\n\nd-i pkgsel/include string openssh-server openssh-client vim curl\n\n### Mirror settings\nd-i mirror/country string manual\nd-i mirror/http/hostname string mirrors.ustc.edu.cn\nd-i mirror/http/directory string /ubuntu\nd-i mirror/http/proxy string http://172.16.1.1:3142/\n\n# Custom commands\nd-i preseed/late_command string \\\n    in-target sh -c 'sed -i \"/#PermitRootLogin/a PermitRootLogin yes\" /etc/ssh/sshd_config';\n\nfinish-install finish-install/keep-consoles boolean false\nd-i finish-install/reboot_in_progress note\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Unattended Installation"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i auto-install/enable boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i debconf/priority "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" critical"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Localization"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i debian-installer/locale string en_US.UTF-8"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i localechooser/languagelist "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" en"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i localechooser/shortlist/en "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" US"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i localechooser/continentlist "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" Asia"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i localechooser/countrylist/Asia "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" China"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i console-setup/ask_detect boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i keyboard-configuration/xkb-keymap "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" us"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Account setup"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i passwd/root-login boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i passwd/make-user boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i passwd/root-password password ABC123def"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i passwd/root-password-again password ABC123def"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i user-setup/allow-password-weak boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Network configuration"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/choose_interface "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" auto"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_hostname string cat"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i hw-detect/load_firmware boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# If you want the preconfiguration file to work on systems both with and"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# without a dhcp server, uncomment these lines and the static network"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# configuration below."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/dhcp_failed note"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/dhcp_options "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" Configure network manually"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# Static network configuration."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_ipaddress string 172.16.1.207"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_netmask string 255.255.0.0"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_gateway string 172.16.255.254"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/get_nameservers string 223.5.5.5"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i netcfg/confirm_static boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Partition"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# Specify a disk to partition. The device name"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# can be given in either devfs or traditional non-devfs format."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/disk string /dev/nvme0n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i grub-installer/bootdev string /dev/nvme0n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# In addition, you'll need to specify the method to use."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# The presently available methods are: \"regular\", \"lvm\" and \"crypto\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/method string lvm"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# If one of the disks that are going to be automatically partitioned"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# contains an old LVM configuration, the user will normally receive a"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# warning. This can be preseeded away..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/purge_lvm_from_device boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# http://cptyesterday.wordpress.com/2012/06/17/notes-on-using-expert_recipe-in-debianubuntu-preseed-files/"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/choose_recipe "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" boot-root"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto-lvm/new_vg_name string main"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto-lvm/guided_size string max"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/expert_recipe string                \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    boot-root ::                                     \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        1 1 1 free                                   \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $bios_boot{ }                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            method{ biosgrub }                       \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"                                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        256 256 256 fat32                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $primary{ }                              \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $iflabel{ gpt }                          \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $reusemethod{ }                          \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            method{ efi } format{ }                  \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            mountpoint{ /boot/efi }                  \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"                                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        512 512 512 ext4                             \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $primary{ }                              \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $bootable{ }                             \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            method{ format } format{ }               \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            use_filesystem{ } filesystem{ ext4 }     \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            mountpoint{ /boot }                      \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"                                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        4096 4096 -1 ext4                            \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            $lvmok{ }                                \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            method{ format } format{ }               \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            use_filesystem{ } filesystem{ ext4 }     \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            mountpoint{ / }                          \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"            lv_name{ root }                          \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# Write the changes to disks and configure LVM"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/confirm boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-lvm/confirm boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-lvm/confirm_nooverwrite boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# http://ubuntuforums.org/showthread.php?p=9626883"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-lvm/device_remove_lvm boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# This makes partman automatically partition without confirmation."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/choose_partition \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" Finish partitioning and write changes to disk"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/confirm_nooverwrite boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i pkgsel/include string openssh-server openssh-client vim curl"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"### Mirror settings"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i mirror/country string manual"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i mirror/http/hostname string mirrors.ustc.edu.cn"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i mirror/http/directory string /ubuntu"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i mirror/http/proxy string http://172.16.1.1:3142/"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# Custom commands"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i preseed/late_command string \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    in-target sh -c "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"'sed -i \"/#PermitRootLogin/a PermitRootLogin yes\" /etc/ssh/sshd_config'"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"finish-install finish-install/keep-consoles boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i finish-install/reboot_in_progress note"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"机器安装多块硬盘，比如有 5 块 NVMe SSD，256GBx1 & 2TBx4，系统装在 256GB 的硬盘上。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"基于上面的脚本，在 early_command 中使用 Bash 脚本，通过 debconf-set 来动态指定硬盘位置。"}]},{"type":"element","tag":"code","props":{"code":"# 删除下面两个配置\nd-i partman-auto/disk string /dev/nvme0n1\nd-i grub-installer/bootdev string /dev/nvme0n1\n\n# 用这个脚本找出小于 300GB 的硬盘，指定为系统盘\nd-i partman/early_command string \\\n  for BOOTDEV in nvme0n1 nvme1n1 nvme2n1 nvme3n1 nvme4n1; do \\\n    if [ -d /sys/block/$BOOTDEV ]; then \\\n      SIZE=`cat /sys/block/$BOOTDEV/size`; \\\n      GB=$(($SIZE/2**21)); \\\n      if [ $GB -lt 300 ]; then \\\n        debconf-set partman-auto/disk \"/dev/$BOOTDEV\"; \\\n        debconf-set grub-installer/bootdev \"/dev/$BOOTDEV\"; \\\n      fi; \\\n    fi; \\\n  done\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# 删除下面两个配置"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/disk string /dev/nvme0n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i grub-installer/bootdev string /dev/nvme0n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# 用这个脚本找出小于 300GB 的硬盘，指定为系统盘"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/early_command string \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" BOOTDEV "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" nvme0n1 nvme1n1 nvme2n1 nvme3n1 nvme4n1"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"do"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" /sys/block/$BOOTDEV ]"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      SIZE="}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"`cat /sys/block/"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$BOOTDEV"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"/size`"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      GB="}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"$(("}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$SIZE"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"**"}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"21"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"))"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" [ $GB "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"-lt"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" 300 ]"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        debconf-set partman-auto/disk "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\"/dev/"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$BOOTDEV"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        debconf-set grub-installer/bootdev "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\"/dev/"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$BOOTDEV"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"fi;"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"fi;"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"done"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"机器本来有系统，需要批量重装，原系统也是 LVM 方式分区。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"先移除已存在的 LVM 分区，再尝试安装（虽然有相关配置项，但该版本可能存在 "},{"type":"element","tag":"a","props":{"href":"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=740271","rel":["nofollow"]},"children":[{"type":"text","value":"BUG"}]},{"type":"text","value":"）。"}]},{"type":"element","tag":"code","props":{"code":"# 移除 LVM 分区\nd-i partman-lvm/device_remove_lvm boolean true\nd-i partman-auto/purge_lvm_from_device boolean true\n\n# 上述配置项可能存在 BUG，那就亲自删一遍\nd-i partman/early_command string \\\n    set -- $(vgs --rows --noheadings | head -n 1); \\\n    for vg in \"$@\"; do \\\n        swapoff \"/dev/$vg/swap\"; \\\n        vgremove -f \"$vg\"; \\\n    done; \\\n    set -- $(pvs --rows --noheadings | head -n 1); \\\n    for pv in \"$@\"; do \\\n        pvremove -f \"$pv\"; \\\n    done\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# 移除 LVM 分区"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-lvm/device_remove_lvm boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman-auto/purge_lvm_from_device boolean "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a80ec9"},"children":[{"type":"text","value":"# 上述配置项可能存在 BUG，那就亲自删一遍"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"d-i partman/early_command string \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" -- "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"$(vgs --rows --noheadings "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":" head -n 1)"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" vg "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$@"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"do"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        swapoff "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\"/dev/"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$vg"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"/swap\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        vgremove -f "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$vg"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"done;"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-93a0e2"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" -- "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"$(pvs --rows --noheadings "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":" head -n 1)"}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" pv "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$@"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"do"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"        pvremove -f "}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"$pv"}]},{"type":"element","tag":"span","props":{"class":"ct-8a0db2"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d49ad"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-724c3a"},"children":[{"type":"text","value":"done"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Preseed 文件放到 TFTP 根目录 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/srv/tftp/"}]},{"type":"text","value":" 下，也就是 GRUB 菜单配置里 url 指定的那个。"}]},{"type":"element","tag":"h2","props":{"id":"pxe-引导"},"children":[{"type":"text","value":"PXE 引导"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"确保内网中没有其他 DHCP 服务，将机器接在 PXE Server 同一个交换机下。重启机器，启动时选择从 PXE 引导，观察是否获得 IP，能否下载启动文件。正常的话稍后就能看到 Ubuntu 安装界面。"}]},{"type":"element","tag":"h2","props":{"id":"参考"},"children":[{"type":"text","value":"参考"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://wiki.ubuntu.com/UEFI/PXE-netboot-install","rel":["nofollow"]},"children":[{"type":"text","value":"https://wiki.ubuntu.com/UEFI/PXE-netboot-install"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.debian.org/releases/etch/ia64/apbs04.html.en","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.debian.org/releases/etch/ia64/apbs04.html.en"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-8a0db2{color:#0A3069}.ct-724c3a{color:#CF222E}.ct-93a0e2{color:#0550AE}.ct-a80ec9{color:#6E7781}.ct-7d49ad{color:#24292F}.dark .ct-7d49ad{color:#C9D1D9}.dark .ct-a80ec9{color:#8B949E}.dark .ct-93a0e2{color:#79C0FF}.dark .ct-724c3a{color:#FF7B72}.dark .ct-8a0db2{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"概述","depth":2,"text":"概述"},{"id":"安装软件","depth":2,"text":"安装软件"},{"id":"配置-pxe-server","depth":2,"text":"配置 PXE Server","children":[{"id":"boot-loader","depth":3,"text":"Boot loader"},{"id":"grub","depth":3,"text":"GRUB"},{"id":"网络引导","depth":3,"text":"网络引导"},{"id":"软件包缓存","depth":3,"text":"软件包缓存"}]},{"id":"preseed","depth":2,"text":"Preseed"},{"id":"pxe-引导","depth":2,"text":"PXE 引导"},{"id":"参考","depth":2,"text":"参考"}]}},"_type":"markdown","_id":"content:blog:pxe-ubuntu.md","_source":"content","_file":"blog/pxe-ubuntu.md","_extension":"md"}