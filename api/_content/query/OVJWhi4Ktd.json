{"_path":"/blog/pxe-centos","_dir":"blog","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"批量安装 CentOS 7","description":"预启动执行环境（Preboot eXecution Environment，PXE）提供了一种使用网络接口（Network Interface）启动计算机的机制，可用于安装操作系统。","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"概述"},"children":[{"type":"text","value":"概述"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"预启动执行环境（Preboot eXecution Environment，PXE）提供了一种使用网络接口（Network Interface）启动计算机的机制，可用于安装操作系统。流程一般如下。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"客户端从 Network 启动，发送 DHCP 请求。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DHCP 服务器发送一个带有 next-server 信息的响应。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"客户端发送 DHCPREQUEST/DHCPINFORM 请求。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DHCP 服务器发送 TFTP 服务器地址和所需的文件名。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"客户端从 TFTP 服务器下载这个文件，一般是很小的引导文件。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pxelinux/grub 读取配置文件，下载相关文件。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"进入安装程序，下载 Anaconda 的 Kickstart 自动应答脚本，开始安装。"}]}]},{"type":"element","tag":"h2","props":{"id":"准备工作"},"children":[{"type":"text","value":"准备工作"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下载 CentOS 镜像，文中使用的是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CentOS-7-x86_64-Minimal-2003.iso"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Optional:"}]},{"type":"text","value":" 手动装一台机器（安装程序选择非图形界面，Troubleshooting -> Install CentOS Linux 7 in basic graphics mode）。进入系统，在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$HOME"}]},{"type":"text","value":"目录下有个 Kickstart 文件，里面是安装程序自动生成的脚本，保存起来作为模板。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"选一台机器用作 PXE Server（比如上面装好的），开放 tftp 和 http 端口（或者禁用防火墙），关闭 SELinux（会阻止从网络访问本地文件）。"}]},{"type":"element","tag":"code","props":{"code":"systemctl disable firewalld.service --now\n\nsed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config\nsetenforce 0\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"systemctl disable firewalld.service --now\n\nsed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config\nsetenforce 0\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果路由器是 DHCP 模式，最好先从交换机上拔掉，或者改为静态 IP 模式（如果机器都接在路由器上），因为内网中存在多个 DHCP Server 会相互干扰。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Optional:"}]},{"type":"text","value":" 也可以用 Dnsmasq 替代 dhcp 和 tftp-server，具体参见 "},{"type":"element","tag":"a","props":{"href":"/note/linux/pxe-ubuntu.html"},"children":[{"type":"text","value":"Ubuntu 篇"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h2","props":{"id":"dhcp-server"},"children":[{"type":"text","value":"DHCP Server"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"支持 PXE 启动的网卡会内置 DHCP Client，用于从内网 PXE Server 获取 IP，顺便查询 TFTP Server 的 IP。那我们第一步就是在 PXE Server 上安装 DHCP Server 为 PXE 设备分配 IP。"}]},{"type":"element","tag":"code","props":{"code":"yum install dhcp -y\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"yum install dhcp -y\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"考虑到服务器配置各不相同，安装方法肯定也有所不同，但装系统也只需在意系统盘的区别。比如 NVMe SSD 或 SATA SSD，前者仅支持 UEFI 引导，后者可用 UEFI 或 Legacy，但机器只支持 Legacy PXE 启动。想一次性装完所有机器，可以在 DHCP Server 的配置中加入判断，区分客户端是普通 DHCP 还是 UEFI PXE 或是 Legacy PXE。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dhcpd"}]},{"type":"text","value":"的配置位于"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/dhcp/dhcpd.conf"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"code","props":{"code":"option pxe-system-type code 93 = unsigned integer 16;\n\nsubnet 172.16.22.0 netmask 255.255.255.0 {\n  range 172.16.22.2 172.16.22.254;\n  option routers 172.16.22.1;\n  option subnet-mask 255.255.255.0;\n\n  next-server 172.16.22.1;\n\n  if option pxe-system-type = 00:07 {      \n    filename \"uefi/shim.efi\";\n  } else if option pxe-system-type = 00:09 {\n    filename \"uefi/shim.efi\";\n  } else {\n    filename \"pxelinux.0\";\n  }\n}\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"option pxe-system-type code 93 = unsigned integer 16;\n\nsubnet 172.16.22.0 netmask 255.255.255.0 {\n  range 172.16.22.2 172.16.22.254;\n  option routers 172.16.22.1;\n  option subnet-mask 255.255.255.0;\n\n  next-server 172.16.22.1;\n\n  if option pxe-system-type = 00:07 {      \n    filename \"uefi/shim.efi\";\n  } else if option pxe-system-type = 00:09 {\n    filename \"uefi/shim.efi\";\n  } else {\n    filename \"pxelinux.0\";\n  }\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next-server"}]},{"type":"text","value":" 用于提示 TFTP Server 的 IP 地址，可以是本机。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"shim"}]},{"type":"text","value":" 是 Linux 的引导程序，支持 EFI 引导，如果检测到 UEFI PXE 就用这个。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pxelinux.0"}]},{"type":"text","value":" 也是 Linux 的引导程序（SYSLINUX），用于 Legacy PXE。"}]},{"type":"element","tag":"h2","props":{"id":"tftp-server"},"children":[{"type":"text","value":"TFTP Server"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"PXE 支持 TFTP 协议，我们把引导程序（shim & pxelinux.0）放在 TFTP 服务器对应目录。"}]},{"type":"element","tag":"code","props":{"code":"yum install xinetd tftp-server –y\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"yum install xinetd tftp-server –y\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"xinetd 是 TFTP 的守护进程，启动 xinetd 就能拉起 TFTP。"}]},{"type":"element","tag":"code","props":{"code":"systemctl start xinetd\nsystemctl enable xinetd\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"systemctl start xinetd\nsystemctl enable xinetd\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TFTP 服务器默认根目录在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/var/lib/tftpboot"}]},{"type":"text","value":"，后面会把引导文件放这里。"}]},{"type":"element","tag":"h2","props":{"id":"http-server"},"children":[{"type":"text","value":"HTTP Server"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TFTP 基于小块（512KB）的 UDP 协议传输数据，速度很慢，只适合传输小文件。软件包等大文件可以换用 NGINX 之类的 HTTP Server 下载。"}]},{"type":"element","tag":"code","props":{"code":"yum install epel-release\nyum install nginx\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"yum install epel-release\nyum install nginx\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"默认配置文件在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/nginx/nginx.conf"}]},{"type":"text","value":"，在 location 中添加"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"autoindex on"}]},{"type":"text","value":"配置打开文件索引，大文件就放在网络根目录下。"}]},{"type":"element","tag":"code","props":{"code":"server {\n    listen       80 default_server;\n    listen       [::]:80 default_server;\n    server_name  _;\n    root         /usr/share/nginx/html;\n\n    # Load configuration files for the default server block.\n    include /etc/nginx/default.d/*.conf;\n\n    location / {\n        autoindex on;\n    }\n\n    error_page 404 /404.html;\n        location = /40x.html {\n    }\n\n    error_page 500 502 503 504 /50x.html;\n        location = /50x.html {\n    }\n}\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"server {\n    listen       80 default_server;\n    listen       [::]:80 default_server;\n    server_name  _;\n    root         /usr/share/nginx/html;\n\n    # Load configuration files for the default server block.\n    include /etc/nginx/default.d/*.conf;\n\n    location / {\n        autoindex on;\n    }\n\n    error_page 404 /404.html;\n        location = /40x.html {\n    }\n\n    error_page 500 502 503 504 /50x.html;\n        location = /50x.html {\n    }\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"uefi-引导"},"children":[{"type":"text","value":"UEFI 引导"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"用 yum 下载 CentOS 7 的 UEFI 引导软件包。"}]},{"type":"element","tag":"code","props":{"code":"yum install grub2-efi-x64 shim-x64\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"yum install grub2-efi-x64 shim-x64\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 TFTP 服务器根目录下新建目录，用于存放 uefi 启动文件。"}]},{"type":"element","tag":"code","props":{"code":"mkdir /var/lib/tftpboot/uefi\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir /var/lib/tftpboot/uefi\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"复制相关文件，修改文件权限。"}]},{"type":"element","tag":"code","props":{"code":"cp -p /boot/efi/EFI/centos/*.efi /var/lib/tftpboot/uefi/\nchmod 755 /var/lib/tftpboot/uefi/*.efi\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cp -p /boot/efi/EFI/centos/*.efi /var/lib/tftpboot/uefi/\nchmod 755 /var/lib/tftpboot/uefi/*.efi\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Optional:"}]},{"type":"text","value":" 或者直接从系统镜像复制过来也行，方法如下。"}]},{"type":"element","tag":"code","props":{"code":"mkdir /centos\nmkdir $HOME/uefi_tmp\nmount -t iso9660 CentOS-7-x86_64-Minimal-2003.iso /centos -o loop,ro\ncp -pr /centos/Packages/shim-version-architecture.rpm $HOME/uefi_tmp\ncp -pr /centos/Packages/grub2-efi-version-architecture.rpm $HOME/uefi_tmp\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir /centos\nmkdir $HOME/uefi_tmp\nmount -t iso9660 CentOS-7-x86_64-Minimal-2003.iso /centos -o loop,ro\ncp -pr /centos/Packages/shim-version-architecture.rpm $HOME/uefi_tmp\ncp -pr /centos/Packages/grub2-efi-version-architecture.rpm $HOME/uefi_tmp\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"解压 rpm 软件包。"}]},{"type":"element","tag":"code","props":{"code":"cd $HOME/uefi_tmp\nrpm2cpio shim-version-architecture.rpm | cpio -dimv\nrpm2cpio grub2-efi-version-architecture.rpm | cpio -dimv\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cd $HOME/uefi_tmp\nrpm2cpio shim-version-architecture.rpm | cpio -dimv\nrpm2cpio grub2-efi-version-architecture.rpm | cpio -dimv\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"复制 EFI 引导程序到 TFTP 目录。"}]},{"type":"element","tag":"code","props":{"code":"cp $HOME/uefi_tmp/boot/efi/EFI/centos/shim.efi /var/lib/tftpboot/uefi/\ncp $HOME/uefi_tmp/boot/efi/EFI/centos/grubx64.efi /var/lib/tftpboot/uefi/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cp $HOME/uefi_tmp/boot/efi/EFI/centos/shim.efi /var/lib/tftpboot/uefi/\ncp $HOME/uefi_tmp/boot/efi/EFI/centos/grubx64.efi /var/lib/tftpboot/uefi/\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在下面的栗子中，Vmlinuz 是 Linux 内核可执行文件，它将 OS 加载到内存中，这样就可以启动机器了。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"inst.ks"}]},{"type":"text","value":"是 Kickstart 自动应答脚本。Initrd 镜像用来初始化 RAM 磁盘，然后将其挂载为根文件系统，并从中运行 CentOS 安装程序。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"grubx64.efi"}]},{"type":"text","value":"同级目录新建 GRUB 配置文件"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/var/lib/tftpboot/uefi/grub.cfg"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"code","props":{"code":"set default=\"0\"\n\nfunction load_video {\n  insmod efi_gop\n  insmod efi_uga\n  insmod video_bochs\n  insmod video_cirrus\n  insmod all_video\n}\n\nload_video\nset gfxpayload=keep\ninsmod gzio\ninsmod part_gpt\ninsmod ext2\nset timeout=6\n\nmenuentry 'Install CentOS Linux 7.8' --class fedora --class gnu-linux --class gnu --class os {\n  linuxefi CentOS-7.8/vmlinuz ip=dhcp inst.ks=http://172.16.22.1:80/supermicro.cfg\n  initrdefi CentOS-7.8/initrd.img\n}\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"set default=\"0\"\n\nfunction load_video {\n  insmod efi_gop\n  insmod efi_uga\n  insmod video_bochs\n  insmod video_cirrus\n  insmod all_video\n}\n\nload_video\nset gfxpayload=keep\ninsmod gzio\ninsmod part_gpt\ninsmod ext2\nset timeout=6\n\nmenuentry 'Install CentOS Linux 7.8' --class fedora --class gnu-linux --class gnu --class os {\n  linuxefi CentOS-7.8/vmlinuz ip=dhcp inst.ks=http://172.16.22.1:80/supermicro.cfg\n  initrdefi CentOS-7.8/initrd.img\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"legacy-引导"},"children":[{"type":"text","value":"Legacy 引导"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装 syslinux，把引导程序复制到 TFTP 根目录。"}]},{"type":"element","tag":"code","props":{"code":"yum -y install syslinux\ncp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"yum -y install syslinux\ncp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"创建 pxelinux 的配置文件。"}]},{"type":"element","tag":"code","props":{"code":"mkdir /var/lib/tftpboot/pxelinux.cfg\nvim /var/lib/tftpboot/pxelinux.cfg/default\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir /var/lib/tftpboot/pxelinux.cfg\nvim /var/lib/tftpboot/pxelinux.cfg/default\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"内容如下。"}]},{"type":"element","tag":"code","props":{"code":"default vesamenu.c32\nprompt 1\ntimeout 6\n\ndisplay boot.msg\n\nlabel linux\n  menu label ^Install system\n  menu default\n  kernel CentOS-7.8/vmlinuz\n  append initrd=CentOS-7.8/initrd.img ip=dhcp ks=http://172.16.22.1/supermicro.cfg\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"default vesamenu.c32\nprompt 1\ntimeout 6\n\ndisplay boot.msg\n\nlabel linux\n  menu label ^Install system\n  menu default\n  kernel CentOS-7.8/vmlinuz\n  append initrd=CentOS-7.8/initrd.img ip=dhcp ks=http://172.16.22.1/supermicro.cfg\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这里依然能看到 vmlinuz & initrd & ks 熟悉的身影，如需修改可参考上一步说明。"}]},{"type":"element","tag":"h2","props":{"id":"kickstart"},"children":[{"type":"text","value":"Kickstart"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"建议先用准备好的镜像在非图形界面下手动安装一台，复制 $HOME 目录下自动生成的"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"anaconda-ks.cfg"}]},{"type":"text","value":"脚本作为参考。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下面的脚本中，系统将从网络安装，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"url"}]},{"type":"text","value":"是内网的安装源，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rootpw"}]},{"type":"text","value":"是 root 用户密码。系统盘是"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nvme1n1"}]},{"type":"text","value":"，使用 LVM，默认分区表。详细的语法说明参见"},{"type":"element","tag":"a","props":{"href":"https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax","rel":["nofollow"]},"children":[{"type":"text","value":"官方文档"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"code","props":{"code":"#version=DEVEL\ninstall\n# System authorization information\nauth --enableshadow --passalgo=sha512\n# Use text mode install\ntext\n# Run the Setup Agent on first boot\nfirstboot --enable\nignoredisk --only-use=nvme1n1\n# Keyboard layouts\nkeyboard --vckeymap=us --xlayouts=''\n# System language\nlang en_US.UTF-8\n# Use network installation\nurl --url=\"http://172.16.22.1/CentOS-7.8\"\n# Reboot after installation\nreboot\n\n# Network information\nnetwork --bootproto=dhcp --device=eno1 --onboot=off --ipv6=auto --no-activate\nnetwork --bootproto=dhcp --device=eno2 --onboot=off --ipv6=auto\nnetwork --bootproto=static --device=enp33s0 --onboot=yes --ip 172.16.1.10 --netmask 255.255.0.0 --gateway 172.16.255.254 --ipv6=auto --nameserver 114.114.114.114\n# Firewall configuration\nfirewall --disable\n\n#Root password\nrootpw --plaintext \"123@def\"\n# SELinux configuration\nselinux --disabled\n# System services\nservices --enabled=\"chronyd\"\n# Do not configure the X Window System\nskipx\n# System timezone\ntimezone Asia/Shanghai --isUtc\n# System bootloader configuration\nbootloader --append=\" crashkernel=auto\" --location=mbr --boot-drive=nvme1n1\nautopart\n# Partition clearing information\nclearpart --all --initlabel --drives=nvme1n1\n\n%packages\n@core\nchrony\nkexec-tools\n\n%end\n\n%addon com_redhat_kdump --enable --reserve-mb='auto'\n\n%end\n\n%anaconda\npwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty\npwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok\npwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty\n%end\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#version=DEVEL\ninstall\n# System authorization information\nauth --enableshadow --passalgo=sha512\n# Use text mode install\ntext\n# Run the Setup Agent on first boot\nfirstboot --enable\nignoredisk --only-use=nvme1n1\n# Keyboard layouts\nkeyboard --vckeymap=us --xlayouts=''\n# System language\nlang en_US.UTF-8\n# Use network installation\nurl --url=\"http://172.16.22.1/CentOS-7.8\"\n# Reboot after installation\nreboot\n\n# Network information\nnetwork --bootproto=dhcp --device=eno1 --onboot=off --ipv6=auto --no-activate\nnetwork --bootproto=dhcp --device=eno2 --onboot=off --ipv6=auto\nnetwork --bootproto=static --device=enp33s0 --onboot=yes --ip 172.16.1.10 --netmask 255.255.0.0 --gateway 172.16.255.254 --ipv6=auto --nameserver 114.114.114.114\n# Firewall configuration\nfirewall --disable\n\n#Root password\nrootpw --plaintext \"123@def\"\n# SELinux configuration\nselinux --disabled\n# System services\nservices --enabled=\"chronyd\"\n# Do not configure the X Window System\nskipx\n# System timezone\ntimezone Asia/Shanghai --isUtc\n# System bootloader configuration\nbootloader --append=\" crashkernel=auto\" --location=mbr --boot-drive=nvme1n1\nautopart\n# Partition clearing information\nclearpart --all --initlabel --drives=nvme1n1\n\n%packages\n@core\nchrony\nkexec-tools\n\n%end\n\n%addon com_redhat_kdump --enable --reserve-mb='auto'\n\n%end\n\n%anaconda\npwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty\npwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok\npwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty\n%end\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"开始安装"},"children":[{"type":"text","value":"开始安装"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"通过 BIOS 或 IPMI，将机器首选启动项改为 PXE，重启机器就能看到 CentOS 的安装程序，无需操作，等待安装"},{"type":"element","tag":"del","props":{},"children":[{"type":"text","value":"失败"}]},{"type":"text","value":"完成（ε = = (づ′▽`)づ"}]}]},"date":"2020-10-18T10:20:43.000Z","tags":["linux","pxe"],"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"概述"},"children":[{"type":"text","value":"概述"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"预启动执行环境（Preboot eXecution Environment，PXE）提供了一种使用网络接口（Network Interface）启动计算机的机制，可用于安装操作系统。流程一般如下。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"客户端从 Network 启动，发送 DHCP 请求。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DHCP 服务器发送一个带有 next-server 信息的响应。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"客户端发送 DHCPREQUEST/DHCPINFORM 请求。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DHCP 服务器发送 TFTP 服务器地址和所需的文件名。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"客户端从 TFTP 服务器下载这个文件，一般是很小的引导文件。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pxelinux/grub 读取配置文件，下载相关文件。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"进入安装程序，下载 Anaconda 的 Kickstart 自动应答脚本，开始安装。"}]}]},{"type":"element","tag":"h2","props":{"id":"准备工作"},"children":[{"type":"text","value":"准备工作"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下载 CentOS 镜像，文中使用的是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CentOS-7-x86_64-Minimal-2003.iso"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Optional:"}]},{"type":"text","value":" 手动装一台机器（安装程序选择非图形界面，Troubleshooting -> Install CentOS Linux 7 in basic graphics mode）。进入系统，在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$HOME"}]},{"type":"text","value":"目录下有个 Kickstart 文件，里面是安装程序自动生成的脚本，保存起来作为模板。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"选一台机器用作 PXE Server（比如上面装好的），开放 tftp 和 http 端口（或者禁用防火墙），关闭 SELinux（会阻止从网络访问本地文件）。"}]},{"type":"element","tag":"code","props":{"code":"systemctl disable firewalld.service --now\n\nsed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config\nsetenforce 0\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"systemctl disable firewalld.service --now"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"sed -i "}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"'s/^SELINUX=.*/SELINUX=disabled/'"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" /etc/selinux/config"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"setenforce 0"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果路由器是 DHCP 模式，最好先从交换机上拔掉，或者改为静态 IP 模式（如果机器都接在路由器上），因为内网中存在多个 DHCP Server 会相互干扰。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Optional:"}]},{"type":"text","value":" 也可以用 Dnsmasq 替代 dhcp 和 tftp-server，具体参见 "},{"type":"element","tag":"a","props":{"href":"/note/linux/pxe-ubuntu.html"},"children":[{"type":"text","value":"Ubuntu 篇"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h2","props":{"id":"dhcp-server"},"children":[{"type":"text","value":"DHCP Server"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"支持 PXE 启动的网卡会内置 DHCP Client，用于从内网 PXE Server 获取 IP，顺便查询 TFTP Server 的 IP。那我们第一步就是在 PXE Server 上安装 DHCP Server 为 PXE 设备分配 IP。"}]},{"type":"element","tag":"code","props":{"code":"yum install dhcp -y\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"yum install dhcp -y"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"考虑到服务器配置各不相同，安装方法肯定也有所不同，但装系统也只需在意系统盘的区别。比如 NVMe SSD 或 SATA SSD，前者仅支持 UEFI 引导，后者可用 UEFI 或 Legacy，但机器只支持 Legacy PXE 启动。想一次性装完所有机器，可以在 DHCP Server 的配置中加入判断，区分客户端是普通 DHCP 还是 UEFI PXE 或是 Legacy PXE。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dhcpd"}]},{"type":"text","value":"的配置位于"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/dhcp/dhcpd.conf"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"code","props":{"code":"option pxe-system-type code 93 = unsigned integer 16;\n\nsubnet 172.16.22.0 netmask 255.255.255.0 {\n  range 172.16.22.2 172.16.22.254;\n  option routers 172.16.22.1;\n  option subnet-mask 255.255.255.0;\n\n  next-server 172.16.22.1;\n\n  if option pxe-system-type = 00:07 {      \n    filename \"uefi/shim.efi\";\n  } else if option pxe-system-type = 00:09 {\n    filename \"uefi/shim.efi\";\n  } else {\n    filename \"pxelinux.0\";\n  }\n}\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"option pxe-system-type code 93 = unsigned integer 16"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"subnet 172.16.22.0 netmask 255.255.255.0 {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  range 172.16.22.2 172.16.22.254"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  option routers 172.16.22.1"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  option subnet-mask 255.255.255.0"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  next-server 172.16.22.1"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" option pxe-system-type = 00:07 {      "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    filename "}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"\"uefi/shim.efi\""}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" option pxe-system-type = 00:09 {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    filename "}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"\"uefi/shim.efi\""}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    filename "}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"\"pxelinux.0\""}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next-server"}]},{"type":"text","value":" 用于提示 TFTP Server 的 IP 地址，可以是本机。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"shim"}]},{"type":"text","value":" 是 Linux 的引导程序，支持 EFI 引导，如果检测到 UEFI PXE 就用这个。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pxelinux.0"}]},{"type":"text","value":" 也是 Linux 的引导程序（SYSLINUX），用于 Legacy PXE。"}]},{"type":"element","tag":"h2","props":{"id":"tftp-server"},"children":[{"type":"text","value":"TFTP Server"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"PXE 支持 TFTP 协议，我们把引导程序（shim & pxelinux.0）放在 TFTP 服务器对应目录。"}]},{"type":"element","tag":"code","props":{"code":"yum install xinetd tftp-server –y\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"yum install xinetd tftp-server –y"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"xinetd 是 TFTP 的守护进程，启动 xinetd 就能拉起 TFTP。"}]},{"type":"element","tag":"code","props":{"code":"systemctl start xinetd\nsystemctl enable xinetd\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"systemctl start xinetd"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"systemctl "}]},{"type":"element","tag":"span","props":{"class":"ct-48cb96"},"children":[{"type":"text","value":"enable"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" xinetd"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TFTP 服务器默认根目录在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/var/lib/tftpboot"}]},{"type":"text","value":"，后面会把引导文件放这里。"}]},{"type":"element","tag":"h2","props":{"id":"http-server"},"children":[{"type":"text","value":"HTTP Server"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TFTP 基于小块（512KB）的 UDP 协议传输数据，速度很慢，只适合传输小文件。软件包等大文件可以换用 NGINX 之类的 HTTP Server 下载。"}]},{"type":"element","tag":"code","props":{"code":"yum install epel-release\nyum install nginx\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"yum install epel-release"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"yum install nginx"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"默认配置文件在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/nginx/nginx.conf"}]},{"type":"text","value":"，在 location 中添加"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"autoindex on"}]},{"type":"text","value":"配置打开文件索引，大文件就放在网络根目录下。"}]},{"type":"element","tag":"code","props":{"code":"server {\n    listen       80 default_server;\n    listen       [::]:80 default_server;\n    server_name  _;\n    root         /usr/share/nginx/html;\n\n    # Load configuration files for the default server block.\n    include /etc/nginx/default.d/*.conf;\n\n    location / {\n        autoindex on;\n    }\n\n    error_page 404 /404.html;\n        location = /40x.html {\n    }\n\n    error_page 500 502 503 504 /50x.html;\n        location = /50x.html {\n    }\n}\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"server {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    listen       80 default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    listen       [::]:80 default_server"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    server_name  _"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    root         /usr/share/nginx/html"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Load configuration files for the default server block."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    include /etc/nginx/default.d/"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":".conf"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    location / {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"        autoindex on"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    error_page 404 /404.html"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"        location = /40x.html {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    error_page 500 502 503 504 /50x.html"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"        location = /50x.html {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"uefi-引导"},"children":[{"type":"text","value":"UEFI 引导"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"用 yum 下载 CentOS 7 的 UEFI 引导软件包。"}]},{"type":"element","tag":"code","props":{"code":"yum install grub2-efi-x64 shim-x64\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"yum install grub2-efi-x64 shim-x64"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 TFTP 服务器根目录下新建目录，用于存放 uefi 启动文件。"}]},{"type":"element","tag":"code","props":{"code":"mkdir /var/lib/tftpboot/uefi\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"mkdir /var/lib/tftpboot/uefi"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"复制相关文件，修改文件权限。"}]},{"type":"element","tag":"code","props":{"code":"cp -p /boot/efi/EFI/centos/*.efi /var/lib/tftpboot/uefi/\nchmod 755 /var/lib/tftpboot/uefi/*.efi\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"cp -p /boot/efi/EFI/centos/"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":".efi /var/lib/tftpboot/uefi/"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"chmod 755 /var/lib/tftpboot/uefi/"}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":".efi"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Optional:"}]},{"type":"text","value":" 或者直接从系统镜像复制过来也行，方法如下。"}]},{"type":"element","tag":"code","props":{"code":"mkdir /centos\nmkdir $HOME/uefi_tmp\nmount -t iso9660 CentOS-7-x86_64-Minimal-2003.iso /centos -o loop,ro\ncp -pr /centos/Packages/shim-version-architecture.rpm $HOME/uefi_tmp\ncp -pr /centos/Packages/grub2-efi-version-architecture.rpm $HOME/uefi_tmp\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"mkdir /centos"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"mkdir $HOME/uefi_tmp"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"mount -t iso9660 CentOS-7-x86_64-Minimal-2003.iso /centos -o loop,ro"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"cp -pr /centos/Packages/shim-version-architecture.rpm $HOME/uefi_tmp"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"cp -pr /centos/Packages/grub2-efi-version-architecture.rpm $HOME/uefi_tmp"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"解压 rpm 软件包。"}]},{"type":"element","tag":"code","props":{"code":"cd $HOME/uefi_tmp\nrpm2cpio shim-version-architecture.rpm | cpio -dimv\nrpm2cpio grub2-efi-version-architecture.rpm | cpio -dimv\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-48cb96"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" $HOME/uefi_tmp"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"rpm2cpio shim-version-architecture.rpm "}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" cpio -dimv"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"rpm2cpio grub2-efi-version-architecture.rpm "}]},{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" cpio -dimv"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"复制 EFI 引导程序到 TFTP 目录。"}]},{"type":"element","tag":"code","props":{"code":"cp $HOME/uefi_tmp/boot/efi/EFI/centos/shim.efi /var/lib/tftpboot/uefi/\ncp $HOME/uefi_tmp/boot/efi/EFI/centos/grubx64.efi /var/lib/tftpboot/uefi/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"cp $HOME/uefi_tmp/boot/efi/EFI/centos/shim.efi /var/lib/tftpboot/uefi/"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"cp $HOME/uefi_tmp/boot/efi/EFI/centos/grubx64.efi /var/lib/tftpboot/uefi/"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在下面的栗子中，Vmlinuz 是 Linux 内核可执行文件，它将 OS 加载到内存中，这样就可以启动机器了。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"inst.ks"}]},{"type":"text","value":"是 Kickstart 自动应答脚本。Initrd 镜像用来初始化 RAM 磁盘，然后将其挂载为根文件系统，并从中运行 CentOS 安装程序。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"grubx64.efi"}]},{"type":"text","value":"同级目录新建 GRUB 配置文件"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/var/lib/tftpboot/uefi/grub.cfg"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"code","props":{"code":"set default=\"0\"\n\nfunction load_video {\n  insmod efi_gop\n  insmod efi_uga\n  insmod video_bochs\n  insmod video_cirrus\n  insmod all_video\n}\n\nload_video\nset gfxpayload=keep\ninsmod gzio\ninsmod part_gpt\ninsmod ext2\nset timeout=6\n\nmenuentry 'Install CentOS Linux 7.8' --class fedora --class gnu-linux --class gnu --class os {\n  linuxefi CentOS-7.8/vmlinuz ip=dhcp inst.ks=http://172.16.22.1:80/supermicro.cfg\n  initrdefi CentOS-7.8/initrd.img\n}\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-48cb96"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" default="}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"\"0\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e15f86"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-22ba53"},"children":[{"type":"text","value":"load_video"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  insmod efi_gop"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  insmod efi_uga"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  insmod video_bochs"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  insmod video_cirrus"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  insmod all_video"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"load_video"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-48cb96"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" gfxpayload=keep"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"insmod gzio"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"insmod part_gpt"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"insmod ext2"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-48cb96"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" timeout=6"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"menuentry "}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"'Install CentOS Linux 7.8'"}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" --class fedora --class gnu-linux --class gnu --class os {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  linuxefi CentOS-7.8/vmlinuz ip=dhcp inst.ks=http://172.16.22.1:80/supermicro.cfg"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  initrdefi CentOS-7.8/initrd.img"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"legacy-引导"},"children":[{"type":"text","value":"Legacy 引导"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装 syslinux，把引导程序复制到 TFTP 根目录。"}]},{"type":"element","tag":"code","props":{"code":"yum -y install syslinux\ncp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"yum -y install syslinux"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"创建 pxelinux 的配置文件。"}]},{"type":"element","tag":"code","props":{"code":"mkdir /var/lib/tftpboot/pxelinux.cfg\nvim /var/lib/tftpboot/pxelinux.cfg/default\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"mkdir /var/lib/tftpboot/pxelinux.cfg"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"vim /var/lib/tftpboot/pxelinux.cfg/default"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"内容如下。"}]},{"type":"element","tag":"code","props":{"code":"default vesamenu.c32\nprompt 1\ntimeout 6\n\ndisplay boot.msg\n\nlabel linux\n  menu label ^Install system\n  menu default\n  kernel CentOS-7.8/vmlinuz\n  append initrd=CentOS-7.8/initrd.img ip=dhcp ks=http://172.16.22.1/supermicro.cfg\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"default vesamenu.c32"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"prompt 1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"timeout 6"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"display boot.msg"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"label linux"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  menu label ^Install system"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  menu default"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  kernel CentOS-7.8/vmlinuz"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"  append initrd=CentOS-7.8/initrd.img ip=dhcp ks=http://172.16.22.1/supermicro.cfg"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这里依然能看到 vmlinuz & initrd & ks 熟悉的身影，如需修改可参考上一步说明。"}]},{"type":"element","tag":"h2","props":{"id":"kickstart"},"children":[{"type":"text","value":"Kickstart"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"建议先用准备好的镜像在非图形界面下手动安装一台，复制 $HOME 目录下自动生成的"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"anaconda-ks.cfg"}]},{"type":"text","value":"脚本作为参考。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下面的脚本中，系统将从网络安装，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"url"}]},{"type":"text","value":"是内网的安装源，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rootpw"}]},{"type":"text","value":"是 root 用户密码。系统盘是"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nvme1n1"}]},{"type":"text","value":"，使用 LVM，默认分区表。详细的语法说明参见"},{"type":"element","tag":"a","props":{"href":"https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax","rel":["nofollow"]},"children":[{"type":"text","value":"官方文档"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"code","props":{"code":"#version=DEVEL\ninstall\n# System authorization information\nauth --enableshadow --passalgo=sha512\n# Use text mode install\ntext\n# Run the Setup Agent on first boot\nfirstboot --enable\nignoredisk --only-use=nvme1n1\n# Keyboard layouts\nkeyboard --vckeymap=us --xlayouts=''\n# System language\nlang en_US.UTF-8\n# Use network installation\nurl --url=\"http://172.16.22.1/CentOS-7.8\"\n# Reboot after installation\nreboot\n\n# Network information\nnetwork --bootproto=dhcp --device=eno1 --onboot=off --ipv6=auto --no-activate\nnetwork --bootproto=dhcp --device=eno2 --onboot=off --ipv6=auto\nnetwork --bootproto=static --device=enp33s0 --onboot=yes --ip 172.16.1.10 --netmask 255.255.0.0 --gateway 172.16.255.254 --ipv6=auto --nameserver 114.114.114.114\n# Firewall configuration\nfirewall --disable\n\n#Root password\nrootpw --plaintext \"123@def\"\n# SELinux configuration\nselinux --disabled\n# System services\nservices --enabled=\"chronyd\"\n# Do not configure the X Window System\nskipx\n# System timezone\ntimezone Asia/Shanghai --isUtc\n# System bootloader configuration\nbootloader --append=\" crashkernel=auto\" --location=mbr --boot-drive=nvme1n1\nautopart\n# Partition clearing information\nclearpart --all --initlabel --drives=nvme1n1\n\n%packages\n@core\nchrony\nkexec-tools\n\n%end\n\n%addon com_redhat_kdump --enable --reserve-mb='auto'\n\n%end\n\n%anaconda\npwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty\npwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok\npwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty\n%end\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"#version=DEVEL"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"install"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# System authorization information"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"auth --enableshadow --passalgo=sha512"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Use text mode install"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"text"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Run the Setup Agent on first boot"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"firstboot --enable"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"ignoredisk --only-use=nvme1n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Keyboard layouts"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"keyboard --vckeymap=us --xlayouts="}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"''"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# System language"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"lang en_US.UTF-8"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Use network installation"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"url --url="}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"\"http://172.16.22.1/CentOS-7.8\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Reboot after installation"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"reboot"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Network information"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"network --bootproto=dhcp --device=eno1 --onboot=off --ipv6=auto --no-activate"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"network --bootproto=dhcp --device=eno2 --onboot=off --ipv6=auto"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"network --bootproto=static --device=enp33s0 --onboot=yes --ip 172.16.1.10 --netmask 255.255.0.0 --gateway 172.16.255.254 --ipv6=auto --nameserver 114.114.114.114"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Firewall configuration"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"firewall --disable"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"#Root password"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"rootpw --plaintext "}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"\"123@def\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# SELinux configuration"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"selinux --disabled"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# System services"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"services --enabled="}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"\"chronyd\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Do not configure the X Window System"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"skipx"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# System timezone"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"timezone Asia/Shanghai --isUtc"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# System bootloader configuration"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"bootloader --append="}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"\" crashkernel=auto\""}]},{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":" --location=mbr --boot-drive=nvme1n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"autopart"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a07f4"},"children":[{"type":"text","value":"# Partition clearing information"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"clearpart --all --initlabel --drives=nvme1n1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"%packages"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"@core"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"chrony"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"kexec-tools"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"%end"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"%addon com_redhat_kdump --enable --reserve-mb="}]},{"type":"element","tag":"span","props":{"class":"ct-a9412a"},"children":[{"type":"text","value":"'auto'"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"%end"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"%anaconda"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5483b6"},"children":[{"type":"text","value":"%end"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"开始安装"},"children":[{"type":"text","value":"开始安装"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"通过 BIOS 或 IPMI，将机器首选启动项改为 PXE，重启机器就能看到 CentOS 的安装程序，无需操作，等待安装"},{"type":"element","tag":"del","props":{},"children":[{"type":"text","value":"失败"}]},{"type":"text","value":"完成（ε = = (づ′▽`)づ"}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-22ba53{color:#8250DF}.ct-8a07f4{color:#6E7781}.ct-48cb96{color:#0550AE}.ct-e15f86{color:#CF222E}.ct-a9412a{color:#0A3069}.ct-5483b6{color:#24292F}.dark .ct-5483b6{color:#C9D1D9}.dark .ct-a9412a{color:#A5D6FF}.dark .ct-e15f86{color:#FF7B72}.dark .ct-48cb96{color:#79C0FF}.dark .ct-8a07f4{color:#8B949E}.dark .ct-22ba53{color:#D2A8FF}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"概述","depth":2,"text":"概述"},{"id":"准备工作","depth":2,"text":"准备工作"},{"id":"dhcp-server","depth":2,"text":"DHCP Server"},{"id":"tftp-server","depth":2,"text":"TFTP Server"},{"id":"http-server","depth":2,"text":"HTTP Server"},{"id":"uefi-引导","depth":2,"text":"UEFI 引导"},{"id":"legacy-引导","depth":2,"text":"Legacy 引导"},{"id":"kickstart","depth":2,"text":"Kickstart"},{"id":"开始安装","depth":2,"text":"开始安装"}]}},"_type":"markdown","_id":"content:blog:pxe-centos.md","_source":"content","_file":"blog/pxe-centos.md","_extension":"md"}