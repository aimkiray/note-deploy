{"_path":"/blog/use-hpc-like-pc","_dir":"blog","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"è¶…ç®—ä¹Ÿèƒ½ç”¨æ¥å»ºç«™å—ï¼Ÿ","description":"è¶…ç®—ä¸Šè·‘çš„ç¨‹åºä¸€èˆ¬éƒ½ä¼šé’ˆå¯¹ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿå®šåˆ¶ä¼˜åŒ–ï¼Œæ¯”å¦‚å°†å¤§è§„æ¨¡ä¼˜åŒ–é—®é¢˜é€šè¿‡æ•°å­¦æ–¹æ³•åˆ†è§£æˆæ•°ä¸ªå­é—®é¢˜ï¼Œæˆ–è€… FFT ä¹‹ç±»çš„é€‚åˆåˆ†è§£çš„ç®—æ³•ï¼Œé…åˆè°ƒåº¦å·¥å…·å¹¶è¡Œè®¡ç®—å‡ºç»“æœå†è¿­ä»£è§£å‡ºåŸé—®é¢˜ã€‚","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"æ¦‚è¿°"},"children":[{"type":"text","value":"æ¦‚è¿°"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¼ ç»Ÿè¶…ç®—ç”±å¤šä¸ªè®¡ç®—èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰è‡ªå·±çš„æ“ä½œç³»ç»Ÿï¼Œå¯ç‹¬ç«‹æˆ–ä¸å…¶ä»–èŠ‚ç‚¹ååŒå·¥ä½œã€‚è®¾è®¡éš¾ç‚¹åœ¨äºä¼ è¾“å¸¦å®½å’Œå»¶è¿Ÿï¼Œå…±äº«å†…å­˜ï¼Œå¹¶è¡Œå­˜å‚¨ï¼Œæ•£çƒ­ï¼Œè½¯ä»¶ä¼˜åŒ–ç­‰æ–¹é¢ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ–‡ä¸­ä½¿ç”¨çš„è¶…ç®—ï¼Œå…¶è®¡ç®—èŠ‚ç‚¹çœ‹èµ·æ¥æ˜¯ä¸ª Linux æœåŠ¡å™¨ï¼Œå¯ä»¥ SSH ç™»å½•ï¼ŒèŠ‚ç‚¹é—´ä½¿ç”¨ InfiniBand åè®®é€šä¿¡ï¼Œå…±äº« home ç›®å½•ã€‚è¶…ç®—å¸¸ç”¨äºå¹¶è¡Œè®¡ç®—ï¼Œå®é™…ä½¿ç”¨ä¸­ä¸€èˆ¬ä¸ä¼šäº²è‡ª SSH ä¸Šå»éƒ¨ç½²æœåŠ¡ï¼Œè€Œæ˜¯é€šè¿‡ä»»åŠ¡è°ƒåº¦å·¥å…·ï¼Œæ¯”å¦‚ Slurm (Simple Linux Utility for Resource Management)ï¼Œå¼€æºçš„è¶…ç®—èµ„æºç®¡ç†è½¯ä»¶ï¼Œåœ¨ TOP500 è¶…ç®—ä¸­å æœ‰ç‡è¶…è¿‡ 50%ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è¶…ç®—ä¸Šè·‘çš„ç¨‹åºä¸€èˆ¬éƒ½ä¼šé’ˆå¯¹ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿå®šåˆ¶ä¼˜åŒ–ï¼Œæ¯”å¦‚å°†å¤§è§„æ¨¡ä¼˜åŒ–é—®é¢˜é€šè¿‡æ•°å­¦æ–¹æ³•åˆ†è§£æˆæ•°ä¸ªå­é—®é¢˜ï¼Œæˆ–è€… FFT ä¹‹ç±»çš„é€‚åˆåˆ†è§£çš„ç®—æ³•ï¼Œé…åˆè°ƒåº¦å·¥å…·å¹¶è¡Œè®¡ç®—å‡ºç»“æœå†è¿­ä»£è§£å‡ºåŸé—®é¢˜ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"é£Ÿæ"},"children":[{"type":"text","value":"é£Ÿæ"}]},{"type":"element","tag":"h3","props":{"id":"slurm"},"children":[{"type":"text","value":"Slurm"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Slurm è°ƒåº¦å·¥å…·å¸¸è§äº Linux è¶…ç®—ï¼Œç®€å•è¯´ä¸‹éƒ¨ç½²ä»»åŠ¡æ—¶å¸¸ç”¨çš„æ–¹æ³•ã€‚"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"salloc"}]},{"type":"text","value":": å…ˆæŠ¢å èµ„æºï¼Œåéƒ¨ç½²ä»»åŠ¡ã€‚æ‰§è¡Œ salloc å‘½ä»¤è·å–èŠ‚ç‚¹èµ„æºï¼ˆå¦‚æœæ˜¯è¶…ç®—ä¸­å¿ƒéœ€è¦æ’é˜Ÿç­‰å¾…ï¼Œæ’åˆ°åå°±å¼€å§‹è®¡è´¹ï¼‰ï¼Œæ­¤æ—¶å¯ä»¥æ‰‹åŠ¨ ssh ç™»å½•è®¡ç®—èŠ‚ç‚¹ã€‚å½“ç”¨æˆ·é€€å‡ºèŠ‚ç‚¹æ—¶ä»»åŠ¡è‡ªåŠ¨ç»ˆæ­¢ï¼Œé€‚åˆè½¯ä»¶æµ‹è¯•ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"srun"}]},{"type":"text","value":": äº¤äº’å¼æäº¤ä»»åŠ¡ã€‚å‘½ä»¤æäº¤åä¼šåœ¨ç»ˆç«¯å®æ—¶è¿”å›ç¨‹åºè¾“å‡ºå†…å®¹ï¼Œç¨‹åºé€€å‡ºè‡ªåŠ¨é‡Šæ”¾èµ„æºï¼Œé€‚åˆäº¤äº’å¼å•èŠ‚ç‚¹ä»»åŠ¡ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"sbatch"}]},{"type":"text","value":": æ‰¹é‡æäº¤ä»»åŠ¡ã€‚å°†èŠ‚ç‚¹ç±»å‹ï¼Œä»»åŠ¡æ•°é‡ï¼Œèµ„æºéœ€æ±‚ç­‰å‚æ•°å’Œæ‰§è¡Œç¨‹åºçš„å‘½ä»¤å†™åœ¨ Bash è„šæœ¬ä¸­æäº¤ï¼Œåœ¨æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆåé‡Šæ”¾èµ„æºï¼ˆæ‰§è¡Œå¤±è´¥ä¹Ÿä¼šé‡Šæ”¾ï¼‰ï¼Œé€‚åˆå¹¶è¡Œæˆ–å¤šæ­¥ä»»åŠ¡ã€‚"}]}]},{"type":"element","tag":"h3","props":{"id":"modules"},"children":[{"type":"text","value":"Modules"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä½¿ç”¨ pacman / apt å®‰è£…è½¯ä»¶æ—¶ä¼šä¹Ÿä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–ï¼Œè€Œè¶…ç®—å‡ºäºå®‰å…¨å’Œç¨³å®šçš„è€ƒè™‘ï¼Œç¦æ­¢ç”¨æˆ·è·å– root æƒé™ï¼Œç”¨æˆ·ä¸èƒ½ä½¿ç”¨ apt ä¹‹ç±»çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ environment modulesã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Modules æ˜¯ä¸€ä¸ª Shell åˆå§‹åŒ–å·¥å…·ï¼Œå¯åœ¨ Shell ä¸­åŠ¨æ€åŠ è½½ä¾èµ–çš„è½¯ä»¶/åº“ï¼ˆç”±ç®¡ç†å‘˜é¢„è£…ï¼‰ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æŸ¥çœ‹å¯ç”¨çš„ gcc è½¯ä»¶ç‰ˆæœ¬ã€‚"}]},{"type":"element","tag":"code","props":{"code":"module avail >> module.log 2>&1\ncat module.log | grep gcc\n\ngcc/4.4.7-kd\ngcc/4.9.2-fenggl\ngcc/7.3.0-wzm\ngcc/8.1.0-wjl\ngcc/8.3.0-wzm\ngcc/9.1.0-fenggl\n...\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"module avail >> module.log 2>&1\ncat module.log | grep gcc\n\ngcc/4.4.7-kd\ngcc/4.9.2-fenggl\ngcc/7.3.0-wzm\ngcc/8.1.0-wjl\ngcc/8.3.0-wzm\ngcc/9.1.0-fenggl\n...\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å¤åˆ¶è½¯ä»¶å…¨ç§°ï¼Œè½½å…¥åˆ°å½“å‰ç¯å¢ƒã€‚"}]},{"type":"element","tag":"code","props":{"code":"module load gcc/8.1.0-wjl\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"module load gcc/8.1.0-wjl\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¹‹åå°±èƒ½ç”¨ GCC 8.1 ç¼–è¯‘ç¨‹åºäº†ã€‚ä½†å¦‚æœæ˜¯ Python Web ç¨‹åºï¼Œä¾èµ–å¤ªå¤šï¼Œæ‰¾ç®¡ç†å‘˜ä¸€ä¸ªä¸ªæ·»åŠ ä¹Ÿä¸å¤ªåˆé€‚ã€‚ä¸å¦‚æ¢ä¸ªæ€è·¯ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æƒ³åˆ°å®¹å™¨å‘¢ï¼Ÿ"}]},{"type":"element","tag":"h3","props":{"id":"singularity"},"children":[{"type":"text","value":"Singularity"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Singularity æ˜¯ä¸“ä¸ºè¶…ç®—æ‰“é€ çš„å®¹å™¨ï¼Œæ”¯æŒ InfiniBand å’Œ GPU ç­‰ PCIe è®¾å¤‡ï¼Œå¯¹æ€§èƒ½çš„æŸè€—å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æ‰“åŒ… Singularity é•œåƒï¼Œå†åˆ°è¶…ç®—ä¸Šç”¨ environment modules åŠ è½½ Singularity æ¥è¿è¡Œé•œåƒã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å›åˆ°æ­£é¢˜ï¼Œé‚£ä¹ˆå…ˆå°è¯•éƒ¨ç½²ä¸ª screenfetch è·å–èŠ‚ç‚¹çš„ç¡¬ä»¶ä¿¡æ¯ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Singularity å…¼å®¹ Docker é•œåƒï¼Œä¹Ÿæœ‰è‡ªå·±çš„é•œåƒæ ¼å¼ã€‚åˆ›å»º singularity å®šä¹‰æ–‡ä»¶"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"screenfetch.def"}]},{"type":"text","value":"ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ã€‚"}]},{"type":"element","tag":"code","props":{"code":"Bootstrap: docker\nFrom: ubuntu:18.04\n\n%help\n    App: screenfetch\n    Usage: singulaity exec <image name> <command>\n\n%files\n    /etc/apt/sources.list\n    /etc/ssl/certs /etc/ssl/certs\n\n%post\n    apt-get update && apt-get install -y screenfetch\n    rm -rf /var/lib/apt/lists/*\n\n%environment\n    export LC_ALL=C\n\n%runscript\n    exec screenfetch\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Bootstrap: docker\nFrom: ubuntu:18.04\n\n%help\n    App: screenfetch\n    Usage: singulaity exec <image name> <command>\n\n%files\n    /etc/apt/sources.list\n    /etc/ssl/certs /etc/ssl/certs\n\n%post\n    apt-get update && apt-get install -y screenfetch\n    rm -rf /var/lib/apt/lists/*\n\n%environment\n    export LC_ALL=C\n\n%runscript\n    exec screenfetch\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bootstrap æ˜¯åŸºç¡€é•œåƒæºï¼ŒFrom æ˜¯åŸºç¡€é•œåƒï¼Œ%help æ˜¯å¸®åŠ©ä¿¡æ¯ï¼Œ%files æ˜¯éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è¿™ä¸ªæ —å­ä¸­ï¼Œæˆ‘ä»¬ä» Docker æºè·å– Ubuntu 18.04 åŸºç¡€é•œåƒï¼Œå°†æœ¬æœº apt è½¯ä»¶æºé…ç½®å’Œ ssl è¯ä¹¦æ‹·è´åˆ°å®¹å™¨å†…çš„ç›¸åŒä½ç½®ï¼Œç„¶åå®‰è£… screenfetch å¹¶æ¸…ç†ç¼“å­˜èŠ‚çœç©ºé—´ï¼Œæœ€åè®¾ç½®ç¯å¢ƒå˜é‡å’Œå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ‰“åŒ…é•œåƒåˆ°å½“å‰ç›®å½•ã€‚"}]},{"type":"element","tag":"code","props":{"code":"singularity build run.sif screenfetch.def\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"singularity build run.sif screenfetch.def\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"run.sif å°±æ˜¯é•œåƒæœ¬ä½“äº†ã€‚å®¹å™¨æœ‰å¤šç§å¯åŠ¨æ–¹å¼ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨ run æŒ‡ä»¤ä¼šè¿è¡Œ runscript ä¸­çš„è¯­å¥ï¼Œè€Œ exec æŒ‡ä»¤å¯ä»¥è‡ªå®šä¹‰å®¹å™¨è¿è¡Œçš„ç¨‹åºï¼Œæ¯”å¦‚ã€‚"}]},{"type":"element","tag":"code","props":{"code":"singularity run run.sif\nsingularity exec run.sif screenfetch\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"singularity run run.sif\nsingularity exec run.sif screenfetch\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸¤æ¡å‘½ä»¤è¿”å›ç›¸åŒçš„ç»“æœã€‚å¦‚æœä½ å¯¹ Dockerfile æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¹Ÿå¯ä»¥æ‰“åŒ… Docker é•œåƒï¼Œä¸Šä¼ åˆ° Docker Hubï¼Œç„¶åä½¿ç”¨ Singularity è¿è¡Œ Docker é•œåƒï¼Œè¿™æ ·çš„é•œåƒä½“ç§¯å°å¾ˆå¤šï¼Œæ¯”å¦‚ã€‚"}]},{"type":"element","tag":"code","props":{"code":"singularity exec docker://ubuntu:latest lsb_release -a\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"singularity exec docker://ubuntu:latest lsb_release -a\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"æ–™ç†"},"children":[{"type":"text","value":"æ–™ç†"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æœ‰äº†å®¹å™¨ï¼Œå°±ç®—æŠŠåšå®¢æŒ‚åˆ°è¶…ç®—ä¸Šä¹Ÿæ²¡é—®é¢˜å‘¦ï¼"}]},{"type":"element","tag":"h3","props":{"id":"å¤šèŠ‚ç‚¹éƒ¨ç½²ç›¸åŒå‚æ•°"},"children":[{"type":"text","value":"å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼ˆç›¸åŒå‚æ•°ï¼‰"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸‹é¢å°è¯•éƒ¨ç½²åˆ†å¸ƒå¼ç¨‹åºï¼ŒåŒ…å«ä¸€ä¸ªä¸»ç¨‹åºå’Œå¤šä¸ªå­ç¨‹åºï¼Œé€šä¿¡åè®®æ˜¯ RESTful APIã€‚å­ç¨‹åºåˆ†åˆ«éƒ¨ç½²åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œç›¸äº’æ²¡æœ‰ç›´æ¥é€šä¿¡ï¼Œç”±ä¸»ç¨‹åºç»Ÿä¸€è°ƒåº¦ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ–°å»º sbatch è„šæœ¬"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"job-worker.sh"}]},{"type":"text","value":"ã€‚"}]},{"type":"element","tag":"code","props":{"code":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --nodes=3\n#SBATCH --ntasks=3\n#SBATCH --cpus-per-task=64\n#SBATCH --no-kill=on\n\nmodule load singularity/3.6\n\nsingularity exec bin.sif <command>\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --nodes=3\n#SBATCH --ntasks=3\n#SBATCH --cpus-per-task=64\n#SBATCH --no-kill=on\n\nmodule load singularity/3.6\n\nsingularity exec bin.sif <command>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"sbatch é…ç½®ä¸­çš„ nodes å’Œ ntasks ä¿æŒä¸€è‡´ï¼Œcpus-per-task æ˜¯å•ä¸ªèŠ‚ç‚¹çš„æ ¸å¿ƒæ•°ï¼Œä»¥ä¿è¯æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªç¨‹åºï¼ˆåªè®¾å®š ntasks ä¹Ÿå¯ä»¥ï¼‰ï¼Œno-kill å‚æ•°å¯ä»¥è®©å•ä¸€èŠ‚ç‚¹çš„æ•…éšœä¸å½±å“å…¶ä»–èŠ‚ç‚¹ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ‰§è¡Œ"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"sbatch job-worker.sh"}]},{"type":"text","value":"å³å¯éƒ¨ç½²é›†ç¾¤ï¼Œ"},{"type":"element","tag":"del","props":{},"children":[{"type":"text","value":"ä½†ä¼¼ä¹æ²¡åŠæ³•ä¿®æ”¹ä»»åŠ¡çš„è¿è¡Œå‚æ•°ã€‚"}]},{"type":"element","tag":"a","props":{"href":"https://slurm.schedmd.com/sbatch.html","rel":["nofollow"]},"children":[{"type":"text","value":"è¿™é‡Œ"}]},{"type":"text","value":" filename pattern çš„è¯´æ˜ï¼Œé€šé…ç¬¦ %A å’Œ %a ä»£æŒ‡ä½œä¸šç¼–å·å’Œç´¢å¼•ç¼–å·ï¼Œæœ‰å…´è¶£å¯ä»¥å°è¯•ä¸‹èƒ½å¦ç”¨åœ¨å‘½ä»¤å‚æ•°ä¸­ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"å¤šèŠ‚ç‚¹éƒ¨ç½²ä¸åŒå‚æ•°"},"children":[{"type":"text","value":"å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼ˆä¸åŒå‚æ•°ï¼‰"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå°† nodes å’Œ ntasks æ”¹ä¸º 1ï¼Œè¿™æ · sbatch è„šæœ¬åªä¼šéƒ¨ç½²å•ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå¾ªç¯æ‰§è¡Œ sbatchï¼Œåœ¨æ¯æ¬¡å¾ªç¯ä¸­ä¿®æ”¹ sbatch è„šæœ¬å‚æ•°ï¼Œä»¥æ­¤å®ç°åŠ¨æ€ä¼ å‚çš„æ•ˆæœã€‚"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"sbatch è„šæœ¬"}]}]},{"type":"element","tag":"code","props":{"code":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --ntasks=1\n\nmodule load singularity/3.6\n\nip=$(ip addr | grep 'state UP' -A2 | tail -n1 | awk '{print $2}' | cut -f1 -d '/')\n\nsingularity exec bin.sif <command> -i $ip -p $1\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --ntasks=1\n\nmodule load singularity/3.6\n\nip=$(ip addr | grep 'state UP' -A2 | tail -n1 | awk '{print $2}' | cut -f1 -d '/')\n\nsingularity exec bin.sif <command> -i $ip -p $1\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"å¤–éƒ¨è„šæœ¬"}]}]},{"type":"element","tag":"code","props":{"code":"#!/bin/bash\n\nset -o pipefail\n\nfor i in {23300..23333};\ndo\n    sbatch job-worker.sh $i\n    echo \"Task $i works.\"\ndone\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#!/bin/bash\n\nset -o pipefail\n\nfor i in {23300..23333};\ndo\n    sbatch job-worker.sh $i\n    echo \"Task $i works.\"\ndone\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨è¿™ä¸ªæ —å­ä¸­æˆ‘ä»¬éƒ¨ç½²äº† 33 ä¸ªç¨‹åºï¼Œç›‘å¬çš„ç«¯å£å„ä¸ç›¸åŒï¼ˆ23300 ~ 23333ï¼‰ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"å•èŠ‚ç‚¹éƒ¨ç½²"},"children":[{"type":"text","value":"å•èŠ‚ç‚¹éƒ¨ç½²"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å¦‚æœæƒ³è¦å¤šä¸ªç¨‹åºæ”¾åœ¨ä¸€ä¸ªèŠ‚ç‚¹è¿è¡Œï¼Œä¹Ÿå°±æ˜¯å•èŠ‚ç‚¹ä¸€æ¬¡æäº¤å¤šä¸ªä¸åŒçš„ç¨‹åºã€‚ä½† Slurm å¥½åƒæ²¡æœ‰è¿™ç§æ–¹æ³•ã€‚ä¸è¿‡ sbatch æ”¯æŒ bash è„šæœ¬ï¼Œé‚£ç›´æ¥ç”¨ bash ä¹Ÿæ˜¯å¯ä»¥çš„å§ã€‚"}]},{"type":"element","tag":"code","props":{"code":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --nodes=1\n#SBATCH --ntasks=1\n#SBATCH --cpus-per-task=64\n\nmodule load singularity/3.6\n\nnohup singularity exec bin.sif <bin1> <command1> >> module1.log 2>&1 &\nsleep 30s\nnohup singularity exec bin.sif <bin2> <command2> >> module2.log 2>&1 &\nwait\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --nodes=1\n#SBATCH --ntasks=1\n#SBATCH --cpus-per-task=64\n\nmodule load singularity/3.6\n\nnohup singularity exec bin.sif <bin1> <command1> >> module1.log 2>&1 &\nsleep 30s\nnohup singularity exec bin.sif <bin2> <command2> >> module2.log 2>&1 &\nwait\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è¿™æ ·å°±åœ¨å•ä¸ªèŠ‚ç‚¹è¿è¡Œäº†ä¸¤ä¸ªä»»åŠ¡ã€‚å½“ sbatch è„šæœ¬æ‰§è¡Œå®Œæˆåï¼ŒSlurm ä¼šè®¤ä¸ºä»»åŠ¡ç»“æŸå¹¶é‡Šæ”¾èµ„æºï¼Œä½¿ç”¨ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wait"}]},{"type":"text","value":" å¯ä»¥è®© Slurm ç­‰å¾…æ‰€æœ‰åå°ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚"}]},{"type":"element","tag":"h2","props":{"id":"ç»“è®º"},"children":[{"type":"text","value":"ç»“è®º"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åŸºäºä¸Šè¿°æ–¹æ³•ï¼ˆä¸»è¦æ˜¯å®¹å™¨ï¼‰ï¼Œå°±æ˜¯è¶…ç®—ä¹Ÿèƒ½ä¸ºæ‰€æ¬²ä¸ºã€‚è‡³äºğŸ’°ä»£ä»·å˜›..."}]}]},"date":"2020-11-26T12:15:40.000Z","tags":["hpc","slurm","linux","container"],"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"æ¦‚è¿°"},"children":[{"type":"text","value":"æ¦‚è¿°"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¼ ç»Ÿè¶…ç®—ç”±å¤šä¸ªè®¡ç®—èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰è‡ªå·±çš„æ“ä½œç³»ç»Ÿï¼Œå¯ç‹¬ç«‹æˆ–ä¸å…¶ä»–èŠ‚ç‚¹ååŒå·¥ä½œã€‚è®¾è®¡éš¾ç‚¹åœ¨äºä¼ è¾“å¸¦å®½å’Œå»¶è¿Ÿï¼Œå…±äº«å†…å­˜ï¼Œå¹¶è¡Œå­˜å‚¨ï¼Œæ•£çƒ­ï¼Œè½¯ä»¶ä¼˜åŒ–ç­‰æ–¹é¢ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ–‡ä¸­ä½¿ç”¨çš„è¶…ç®—ï¼Œå…¶è®¡ç®—èŠ‚ç‚¹çœ‹èµ·æ¥æ˜¯ä¸ª Linux æœåŠ¡å™¨ï¼Œå¯ä»¥ SSH ç™»å½•ï¼ŒèŠ‚ç‚¹é—´ä½¿ç”¨ InfiniBand åè®®é€šä¿¡ï¼Œå…±äº« home ç›®å½•ã€‚è¶…ç®—å¸¸ç”¨äºå¹¶è¡Œè®¡ç®—ï¼Œå®é™…ä½¿ç”¨ä¸­ä¸€èˆ¬ä¸ä¼šäº²è‡ª SSH ä¸Šå»éƒ¨ç½²æœåŠ¡ï¼Œè€Œæ˜¯é€šè¿‡ä»»åŠ¡è°ƒåº¦å·¥å…·ï¼Œæ¯”å¦‚ Slurm (Simple Linux Utility for Resource Management)ï¼Œå¼€æºçš„è¶…ç®—èµ„æºç®¡ç†è½¯ä»¶ï¼Œåœ¨ TOP500 è¶…ç®—ä¸­å æœ‰ç‡è¶…è¿‡ 50%ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è¶…ç®—ä¸Šè·‘çš„ç¨‹åºä¸€èˆ¬éƒ½ä¼šé’ˆå¯¹ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿå®šåˆ¶ä¼˜åŒ–ï¼Œæ¯”å¦‚å°†å¤§è§„æ¨¡ä¼˜åŒ–é—®é¢˜é€šè¿‡æ•°å­¦æ–¹æ³•åˆ†è§£æˆæ•°ä¸ªå­é—®é¢˜ï¼Œæˆ–è€… FFT ä¹‹ç±»çš„é€‚åˆåˆ†è§£çš„ç®—æ³•ï¼Œé…åˆè°ƒåº¦å·¥å…·å¹¶è¡Œè®¡ç®—å‡ºç»“æœå†è¿­ä»£è§£å‡ºåŸé—®é¢˜ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"é£Ÿæ"},"children":[{"type":"text","value":"é£Ÿæ"}]},{"type":"element","tag":"h3","props":{"id":"slurm"},"children":[{"type":"text","value":"Slurm"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Slurm è°ƒåº¦å·¥å…·å¸¸è§äº Linux è¶…ç®—ï¼Œç®€å•è¯´ä¸‹éƒ¨ç½²ä»»åŠ¡æ—¶å¸¸ç”¨çš„æ–¹æ³•ã€‚"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"salloc"}]},{"type":"text","value":": å…ˆæŠ¢å èµ„æºï¼Œåéƒ¨ç½²ä»»åŠ¡ã€‚æ‰§è¡Œ salloc å‘½ä»¤è·å–èŠ‚ç‚¹èµ„æºï¼ˆå¦‚æœæ˜¯è¶…ç®—ä¸­å¿ƒéœ€è¦æ’é˜Ÿç­‰å¾…ï¼Œæ’åˆ°åå°±å¼€å§‹è®¡è´¹ï¼‰ï¼Œæ­¤æ—¶å¯ä»¥æ‰‹åŠ¨ ssh ç™»å½•è®¡ç®—èŠ‚ç‚¹ã€‚å½“ç”¨æˆ·é€€å‡ºèŠ‚ç‚¹æ—¶ä»»åŠ¡è‡ªåŠ¨ç»ˆæ­¢ï¼Œé€‚åˆè½¯ä»¶æµ‹è¯•ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"srun"}]},{"type":"text","value":": äº¤äº’å¼æäº¤ä»»åŠ¡ã€‚å‘½ä»¤æäº¤åä¼šåœ¨ç»ˆç«¯å®æ—¶è¿”å›ç¨‹åºè¾“å‡ºå†…å®¹ï¼Œç¨‹åºé€€å‡ºè‡ªåŠ¨é‡Šæ”¾èµ„æºï¼Œé€‚åˆäº¤äº’å¼å•èŠ‚ç‚¹ä»»åŠ¡ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"sbatch"}]},{"type":"text","value":": æ‰¹é‡æäº¤ä»»åŠ¡ã€‚å°†èŠ‚ç‚¹ç±»å‹ï¼Œä»»åŠ¡æ•°é‡ï¼Œèµ„æºéœ€æ±‚ç­‰å‚æ•°å’Œæ‰§è¡Œç¨‹åºçš„å‘½ä»¤å†™åœ¨ Bash è„šæœ¬ä¸­æäº¤ï¼Œåœ¨æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆåé‡Šæ”¾èµ„æºï¼ˆæ‰§è¡Œå¤±è´¥ä¹Ÿä¼šé‡Šæ”¾ï¼‰ï¼Œé€‚åˆå¹¶è¡Œæˆ–å¤šæ­¥ä»»åŠ¡ã€‚"}]}]},{"type":"element","tag":"h3","props":{"id":"modules"},"children":[{"type":"text","value":"Modules"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä½¿ç”¨ pacman / apt å®‰è£…è½¯ä»¶æ—¶ä¼šä¹Ÿä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–ï¼Œè€Œè¶…ç®—å‡ºäºå®‰å…¨å’Œç¨³å®šçš„è€ƒè™‘ï¼Œç¦æ­¢ç”¨æˆ·è·å– root æƒé™ï¼Œç”¨æˆ·ä¸èƒ½ä½¿ç”¨ apt ä¹‹ç±»çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ environment modulesã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Modules æ˜¯ä¸€ä¸ª Shell åˆå§‹åŒ–å·¥å…·ï¼Œå¯åœ¨ Shell ä¸­åŠ¨æ€åŠ è½½ä¾èµ–çš„è½¯ä»¶/åº“ï¼ˆç”±ç®¡ç†å‘˜é¢„è£…ï¼‰ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æŸ¥çœ‹å¯ç”¨çš„ gcc è½¯ä»¶ç‰ˆæœ¬ã€‚"}]},{"type":"element","tag":"code","props":{"code":"module avail >> module.log 2>&1\ncat module.log | grep gcc\n\ngcc/4.4.7-kd\ngcc/4.9.2-fenggl\ngcc/7.3.0-wzm\ngcc/8.1.0-wjl\ngcc/8.3.0-wzm\ngcc/9.1.0-fenggl\n...\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"module avail "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" module.log "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"2>&1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"cat module.log "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" grep gcc"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"gcc/4.4.7-kd"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"gcc/4.9.2-fenggl"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"gcc/7.3.0-wzm"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"gcc/8.1.0-wjl"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"gcc/8.3.0-wzm"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"gcc/9.1.0-fenggl"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"..."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å¤åˆ¶è½¯ä»¶å…¨ç§°ï¼Œè½½å…¥åˆ°å½“å‰ç¯å¢ƒã€‚"}]},{"type":"element","tag":"code","props":{"code":"module load gcc/8.1.0-wjl\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"module load gcc/8.1.0-wjl"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¹‹åå°±èƒ½ç”¨ GCC 8.1 ç¼–è¯‘ç¨‹åºäº†ã€‚ä½†å¦‚æœæ˜¯ Python Web ç¨‹åºï¼Œä¾èµ–å¤ªå¤šï¼Œæ‰¾ç®¡ç†å‘˜ä¸€ä¸ªä¸ªæ·»åŠ ä¹Ÿä¸å¤ªåˆé€‚ã€‚ä¸å¦‚æ¢ä¸ªæ€è·¯ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æƒ³åˆ°å®¹å™¨å‘¢ï¼Ÿ"}]},{"type":"element","tag":"h3","props":{"id":"singularity"},"children":[{"type":"text","value":"Singularity"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Singularity æ˜¯ä¸“ä¸ºè¶…ç®—æ‰“é€ çš„å®¹å™¨ï¼Œæ”¯æŒ InfiniBand å’Œ GPU ç­‰ PCIe è®¾å¤‡ï¼Œå¯¹æ€§èƒ½çš„æŸè€—å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æ‰“åŒ… Singularity é•œåƒï¼Œå†åˆ°è¶…ç®—ä¸Šç”¨ environment modules åŠ è½½ Singularity æ¥è¿è¡Œé•œåƒã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å›åˆ°æ­£é¢˜ï¼Œé‚£ä¹ˆå…ˆå°è¯•éƒ¨ç½²ä¸ª screenfetch è·å–èŠ‚ç‚¹çš„ç¡¬ä»¶ä¿¡æ¯ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Singularity å…¼å®¹ Docker é•œåƒï¼Œä¹Ÿæœ‰è‡ªå·±çš„é•œåƒæ ¼å¼ã€‚åˆ›å»º singularity å®šä¹‰æ–‡ä»¶"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"screenfetch.def"}]},{"type":"text","value":"ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ã€‚"}]},{"type":"element","tag":"code","props":{"code":"Bootstrap: docker\nFrom: ubuntu:18.04\n\n%help\n    App: screenfetch\n    Usage: singulaity exec <image name> <command>\n\n%files\n    /etc/apt/sources.list\n    /etc/ssl/certs /etc/ssl/certs\n\n%post\n    apt-get update && apt-get install -y screenfetch\n    rm -rf /var/lib/apt/lists/*\n\n%environment\n    export LC_ALL=C\n\n%runscript\n    exec screenfetch\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"Bootstrap: docker"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"From: ubuntu:18.04"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"%help"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    App: screenfetch"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    Usage: singulaity "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"image name"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"command"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"%files"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    /etc/apt/sources.list"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    /etc/ssl/certs /etc/ssl/certs"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"%post"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    apt-get update "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" apt-get install -y screenfetch"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    rm -rf /var/lib/apt/lists/"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"*"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"%environment"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" LC_ALL=C"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"%runscript"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" screenfetch"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bootstrap æ˜¯åŸºç¡€é•œåƒæºï¼ŒFrom æ˜¯åŸºç¡€é•œåƒï¼Œ%help æ˜¯å¸®åŠ©ä¿¡æ¯ï¼Œ%files æ˜¯éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è¿™ä¸ªæ —å­ä¸­ï¼Œæˆ‘ä»¬ä» Docker æºè·å– Ubuntu 18.04 åŸºç¡€é•œåƒï¼Œå°†æœ¬æœº apt è½¯ä»¶æºé…ç½®å’Œ ssl è¯ä¹¦æ‹·è´åˆ°å®¹å™¨å†…çš„ç›¸åŒä½ç½®ï¼Œç„¶åå®‰è£… screenfetch å¹¶æ¸…ç†ç¼“å­˜èŠ‚çœç©ºé—´ï¼Œæœ€åè®¾ç½®ç¯å¢ƒå˜é‡å’Œå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ‰“åŒ…é•œåƒåˆ°å½“å‰ç›®å½•ã€‚"}]},{"type":"element","tag":"code","props":{"code":"singularity build run.sif screenfetch.def\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"singularity build run.sif screenfetch.def"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"run.sif å°±æ˜¯é•œåƒæœ¬ä½“äº†ã€‚å®¹å™¨æœ‰å¤šç§å¯åŠ¨æ–¹å¼ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨ run æŒ‡ä»¤ä¼šè¿è¡Œ runscript ä¸­çš„è¯­å¥ï¼Œè€Œ exec æŒ‡ä»¤å¯ä»¥è‡ªå®šä¹‰å®¹å™¨è¿è¡Œçš„ç¨‹åºï¼Œæ¯”å¦‚ã€‚"}]},{"type":"element","tag":"code","props":{"code":"singularity run run.sif\nsingularity exec run.sif screenfetch\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"singularity run run.sif"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"singularity "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" run.sif screenfetch"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸¤æ¡å‘½ä»¤è¿”å›ç›¸åŒçš„ç»“æœã€‚å¦‚æœä½ å¯¹ Dockerfile æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¹Ÿå¯ä»¥æ‰“åŒ… Docker é•œåƒï¼Œä¸Šä¼ åˆ° Docker Hubï¼Œç„¶åä½¿ç”¨ Singularity è¿è¡Œ Docker é•œåƒï¼Œè¿™æ ·çš„é•œåƒä½“ç§¯å°å¾ˆå¤šï¼Œæ¯”å¦‚ã€‚"}]},{"type":"element","tag":"code","props":{"code":"singularity exec docker://ubuntu:latest lsb_release -a\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"singularity "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" docker://ubuntu:latest lsb_release -a"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"æ–™ç†"},"children":[{"type":"text","value":"æ–™ç†"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æœ‰äº†å®¹å™¨ï¼Œå°±ç®—æŠŠåšå®¢æŒ‚åˆ°è¶…ç®—ä¸Šä¹Ÿæ²¡é—®é¢˜å‘¦ï¼"}]},{"type":"element","tag":"h3","props":{"id":"å¤šèŠ‚ç‚¹éƒ¨ç½²ç›¸åŒå‚æ•°"},"children":[{"type":"text","value":"å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼ˆç›¸åŒå‚æ•°ï¼‰"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸‹é¢å°è¯•éƒ¨ç½²åˆ†å¸ƒå¼ç¨‹åºï¼ŒåŒ…å«ä¸€ä¸ªä¸»ç¨‹åºå’Œå¤šä¸ªå­ç¨‹åºï¼Œé€šä¿¡åè®®æ˜¯ RESTful APIã€‚å­ç¨‹åºåˆ†åˆ«éƒ¨ç½²åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œç›¸äº’æ²¡æœ‰ç›´æ¥é€šä¿¡ï¼Œç”±ä¸»ç¨‹åºç»Ÿä¸€è°ƒåº¦ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ–°å»º sbatch è„šæœ¬"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"job-worker.sh"}]},{"type":"text","value":"ã€‚"}]},{"type":"element","tag":"code","props":{"code":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --nodes=3\n#SBATCH --ntasks=3\n#SBATCH --cpus-per-task=64\n#SBATCH --no-kill=on\n\nmodule load singularity/3.6\n\nsingularity exec bin.sif <command>\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#!/bin/sh"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --job-name worker"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --error=job-%j.err"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --partition=amd"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --nodes=3"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --ntasks=3"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --cpus-per-task=64"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --no-kill=on"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"module load singularity/3.6"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"singularity "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" bin.sif "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"command"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"sbatch é…ç½®ä¸­çš„ nodes å’Œ ntasks ä¿æŒä¸€è‡´ï¼Œcpus-per-task æ˜¯å•ä¸ªèŠ‚ç‚¹çš„æ ¸å¿ƒæ•°ï¼Œä»¥ä¿è¯æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªç¨‹åºï¼ˆåªè®¾å®š ntasks ä¹Ÿå¯ä»¥ï¼‰ï¼Œno-kill å‚æ•°å¯ä»¥è®©å•ä¸€èŠ‚ç‚¹çš„æ•…éšœä¸å½±å“å…¶ä»–èŠ‚ç‚¹ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ‰§è¡Œ"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"sbatch job-worker.sh"}]},{"type":"text","value":"å³å¯éƒ¨ç½²é›†ç¾¤ï¼Œ"},{"type":"element","tag":"del","props":{},"children":[{"type":"text","value":"ä½†ä¼¼ä¹æ²¡åŠæ³•ä¿®æ”¹ä»»åŠ¡çš„è¿è¡Œå‚æ•°ã€‚"}]},{"type":"element","tag":"a","props":{"href":"https://slurm.schedmd.com/sbatch.html","rel":["nofollow"]},"children":[{"type":"text","value":"è¿™é‡Œ"}]},{"type":"text","value":" filename pattern çš„è¯´æ˜ï¼Œé€šé…ç¬¦ %A å’Œ %a ä»£æŒ‡ä½œä¸šç¼–å·å’Œç´¢å¼•ç¼–å·ï¼Œæœ‰å…´è¶£å¯ä»¥å°è¯•ä¸‹èƒ½å¦ç”¨åœ¨å‘½ä»¤å‚æ•°ä¸­ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"å¤šèŠ‚ç‚¹éƒ¨ç½²ä¸åŒå‚æ•°"},"children":[{"type":"text","value":"å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼ˆä¸åŒå‚æ•°ï¼‰"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå°† nodes å’Œ ntasks æ”¹ä¸º 1ï¼Œè¿™æ · sbatch è„šæœ¬åªä¼šéƒ¨ç½²å•ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå¾ªç¯æ‰§è¡Œ sbatchï¼Œåœ¨æ¯æ¬¡å¾ªç¯ä¸­ä¿®æ”¹ sbatch è„šæœ¬å‚æ•°ï¼Œä»¥æ­¤å®ç°åŠ¨æ€ä¼ å‚çš„æ•ˆæœã€‚"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"sbatch è„šæœ¬"}]}]},{"type":"element","tag":"code","props":{"code":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --ntasks=1\n\nmodule load singularity/3.6\n\nip=$(ip addr | grep 'state UP' -A2 | tail -n1 | awk '{print $2}' | cut -f1 -d '/')\n\nsingularity exec bin.sif <command> -i $ip -p $1\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#!/bin/sh"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --job-name worker"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --error=job-%j.err"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --partition=amd"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --ntasks=1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"module load singularity/3.6"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"ip="}]},{"type":"element","tag":"span","props":{"class":"ct-e7dd79"},"children":[{"type":"text","value":"$(ip addr "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-e7dd79"},"children":[{"type":"text","value":" grep 'state UP' -A2 "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-e7dd79"},"children":[{"type":"text","value":" tail -n1 "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-e7dd79"},"children":[{"type":"text","value":" awk '{print $2}' "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-e7dd79"},"children":[{"type":"text","value":" cut -f1 -d '/')"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"singularity "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" bin.sif "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"command"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" -i $ip -p $1"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"å¤–éƒ¨è„šæœ¬"}]}]},{"type":"element","tag":"code","props":{"code":"#!/bin/bash\n\nset -o pipefail\n\nfor i in {23300..23333};\ndo\n    sbatch job-worker.sh $i\n    echo \"Task $i works.\"\ndone\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#!/bin/bash"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" -o pipefail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" {23300..23333}"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"do"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    sbatch job-worker.sh $i"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e7dd79"},"children":[{"type":"text","value":"\"Task "}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"$i"}]},{"type":"element","tag":"span","props":{"class":"ct-e7dd79"},"children":[{"type":"text","value":" works.\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"done"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨è¿™ä¸ªæ —å­ä¸­æˆ‘ä»¬éƒ¨ç½²äº† 33 ä¸ªç¨‹åºï¼Œç›‘å¬çš„ç«¯å£å„ä¸ç›¸åŒï¼ˆ23300 ~ 23333ï¼‰ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"å•èŠ‚ç‚¹éƒ¨ç½²"},"children":[{"type":"text","value":"å•èŠ‚ç‚¹éƒ¨ç½²"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å¦‚æœæƒ³è¦å¤šä¸ªç¨‹åºæ”¾åœ¨ä¸€ä¸ªèŠ‚ç‚¹è¿è¡Œï¼Œä¹Ÿå°±æ˜¯å•èŠ‚ç‚¹ä¸€æ¬¡æäº¤å¤šä¸ªä¸åŒçš„ç¨‹åºã€‚ä½† Slurm å¥½åƒæ²¡æœ‰è¿™ç§æ–¹æ³•ã€‚ä¸è¿‡ sbatch æ”¯æŒ bash è„šæœ¬ï¼Œé‚£ç›´æ¥ç”¨ bash ä¹Ÿæ˜¯å¯ä»¥çš„å§ã€‚"}]},{"type":"element","tag":"code","props":{"code":"#!/bin/sh\n#SBATCH --job-name worker\n#SBATCH --error=job-%j.err\n#SBATCH --partition=amd\n#SBATCH --nodes=1\n#SBATCH --ntasks=1\n#SBATCH --cpus-per-task=64\n\nmodule load singularity/3.6\n\nnohup singularity exec bin.sif <bin1> <command1> >> module1.log 2>&1 &\nsleep 30s\nnohup singularity exec bin.sif <bin2> <command2> >> module2.log 2>&1 &\nwait\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#!/bin/sh"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --job-name worker"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --error=job-%j.err"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --partition=amd"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --nodes=1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --ntasks=1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a08478"},"children":[{"type":"text","value":"#SBATCH --cpus-per-task=64"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"module load singularity/3.6"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"nohup singularity "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" bin.sif "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"bin"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"1>"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"command"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"1>"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" module1.log "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"2>&1"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"&"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"sleep 30s"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"nohup singularity "}]},{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" bin.sif "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"bin"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"2>"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":"command"}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"2>"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" module2.log "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"2>&1"}]},{"type":"element","tag":"span","props":{"class":"ct-2130d2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6e7bd7"},"children":[{"type":"text","value":"&"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e09eed"},"children":[{"type":"text","value":"wait"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"è¿™æ ·å°±åœ¨å•ä¸ªèŠ‚ç‚¹è¿è¡Œäº†ä¸¤ä¸ªä»»åŠ¡ã€‚å½“ sbatch è„šæœ¬æ‰§è¡Œå®Œæˆåï¼ŒSlurm ä¼šè®¤ä¸ºä»»åŠ¡ç»“æŸå¹¶é‡Šæ”¾èµ„æºï¼Œä½¿ç”¨ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wait"}]},{"type":"text","value":" å¯ä»¥è®© Slurm ç­‰å¾…æ‰€æœ‰åå°ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚"}]},{"type":"element","tag":"h2","props":{"id":"ç»“è®º"},"children":[{"type":"text","value":"ç»“è®º"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åŸºäºä¸Šè¿°æ–¹æ³•ï¼ˆä¸»è¦æ˜¯å®¹å™¨ï¼‰ï¼Œå°±æ˜¯è¶…ç®—ä¹Ÿèƒ½ä¸ºæ‰€æ¬²ä¸ºã€‚è‡³äºğŸ’°ä»£ä»·å˜›..."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-e7dd79{color:#0A3069}.ct-a08478{color:#6E7781}.ct-e09eed{color:#0550AE}.ct-6e7bd7{color:#CF222E}.ct-2130d2{color:#24292F}.dark .ct-2130d2{color:#C9D1D9}.dark .ct-6e7bd7{color:#FF7B72}.dark .ct-e09eed{color:#79C0FF}.dark .ct-a08478{color:#8B949E}.dark .ct-e7dd79{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"æ¦‚è¿°","depth":2,"text":"æ¦‚è¿°"},{"id":"é£Ÿæ","depth":2,"text":"é£Ÿæ","children":[{"id":"slurm","depth":3,"text":"Slurm"},{"id":"modules","depth":3,"text":"Modules"},{"id":"singularity","depth":3,"text":"Singularity"}]},{"id":"æ–™ç†","depth":2,"text":"æ–™ç†","children":[{"id":"å¤šèŠ‚ç‚¹éƒ¨ç½²ç›¸åŒå‚æ•°","depth":3,"text":"å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼ˆç›¸åŒå‚æ•°ï¼‰"},{"id":"å¤šèŠ‚ç‚¹éƒ¨ç½²ä¸åŒå‚æ•°","depth":3,"text":"å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼ˆä¸åŒå‚æ•°ï¼‰"},{"id":"å•èŠ‚ç‚¹éƒ¨ç½²","depth":3,"text":"å•èŠ‚ç‚¹éƒ¨ç½²"}]},{"id":"ç»“è®º","depth":2,"text":"ç»“è®º"}]}},"_type":"markdown","_id":"content:blog:use-hpc-like-pc.md","_source":"content","_file":"blog/use-hpc-like-pc.md","_extension":"md"}