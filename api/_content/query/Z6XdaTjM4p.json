{"_path":"/blog/make-nvidia-explosion","_dir":"blog","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"NVIDIA 核试验（Linux）","description":"Linux 的 NVIDIA 超频工具可没有 Windows 的那么多，看了一圈好像也只有官方提供的 nvidia-settings。然而这玩意用 X11 扩展协议和显卡 DDX 驱动通信，而服务器没有图形界面，根本届不到。","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Linux 的 NVIDIA 超频工具可没有 Windows 的那么多，看了一圈好像也只有官方提供的 nvidia-settings。然而这玩意用 X11 扩展协议和显卡 DDX 驱动通信，而服务器没有图形界面，根本届不到。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"所以想用官方工具超频，估计还得装个 Xorg 和虚拟显示器。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Explosion","src":"/blog/make-nvidia-explosion/explosion.jpeg"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"环境准备"},"children":[{"type":"text","value":"环境准备"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"显卡：RTX 2080Ti / RTX 3080"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"系统：Ubuntu 18.04.5 / CentOS 7.6"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"驱动：apt install nvidia-utils-460-server"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装 Xorg。"}]},{"type":"element","tag":"code","props":{"code":"# ubuntu\napt update\napt install xorg\n\n# centos\nyum install xorg-x11-server-Xorg\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# ubuntu\napt update\napt install xorg\n\n# centos\nyum install xorg-x11-server-Xorg\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"生成 Xorg 配置。"}]},{"type":"element","tag":"code","props":{"code":"sudo nvidia-xconfig -a --allow-empty-initial-configuration --cool-bits=28\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo nvidia-xconfig -a --allow-empty-initial-configuration --cool-bits=28\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"选项 --allow-empty-initial-configuration 用来允许 Nvidia 驱动在没有连接任何显示设备的情况下工作（460.32.03 及以上版本默认为 True）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"选项 --cool-bits 是超频功能开关，其值为各配置项组成二进制数字再转十进制数字。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"1   (bit 0) - 在 nvidia-settings 的 Clock Frequencies 参数上启用旧版 (pre-Fermi) 核心的超频。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"2   (bit 1) - 设置该位时，驱动程序将在使用具有不同数量显存的 GPU 时尝试初始化 SLI。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"4   (bit 2) - 在 nvidia-settings 的 Thermal Monitor 参数上启用手动配置 GPU 风扇速度。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"8   (bit 3) - 在 nvidia-settings 的 PowerMizer 参数上启用超频。自 337.12 版本起适用于 Fermi 架构及更高版本。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"16 (bit 4) - 使用 nvidia-settings CLI 选项启用过电压。自 346.16 版起适用于 Fermi 架构及更高版本。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"举个栗子，修改 RTX 3080（Ampere 架构）的核心频率，电压和风扇转速，需要将 Coolbits 值设置为 28（二进制 11100 转十进制为 28）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"后台启动 Xorg。"}]},{"type":"element","tag":"code","props":{"code":"nohup sudo /usr/lib/xorg/Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch &\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"nohup sudo /usr/lib/xorg/Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch &\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"运行 nvidia-smi，此时能看到 Xorg 在使用 GPU。"}]},{"type":"element","tag":"h2","props":{"id":"如何食用"},"children":[{"type":"text","value":"如何食用"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本文的主角 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nvidia-settings"}]},{"type":"text","value":" 依赖 X11 协议和显卡通信。所以在运行前要加上 DISPLAY 环境变量。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"由于 X11 不是完全体，执行后还是会报错。没关系，看到修改成功的提示就行。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为防止不可控核事故，先给风扇拉满（"}]},{"type":"element","tag":"code","props":{"code":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUFanControlState=1\nDISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [fan:0]/GPUTargetFanSpeed=100\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUFanControlState=1\nDISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [fan:0]/GPUTargetFanSpeed=100\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"核心降频，显存超频。"}]},{"type":"element","tag":"code","props":{"code":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUMemoryTransferRateOffset[4]=1400\nDISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUGraphicsClockOffset[4]=-200\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUMemoryTransferRateOffset[4]=1400\nDISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUGraphicsClockOffset[4]=-200\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gpu:0"}]},{"type":"text","value":" 是显卡序号，多显卡可以修改序号分别执行。后面的 "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"4"}]},{"type":"text","value":" 适用于 20 系及 30 系显卡，如果你是 10 系卡改成 "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"3"}]},{"type":"text","value":" 就好（再不行改成 2，不会炸，大概）。超频用正值，降频用负值，请小心往上加，因为超多了真的会炸（一般重启能恢复）。显卡序号可用 nvidia-smi 查看。"}]},{"type":"element","tag":"code","props":{"code":"$ nvidia-smi -L\n\nGPU 0: GeForce RTX 3080 (UUID: GPU-6f62e1a5-2d7b-31a5-aa25-628d349e0235)\nGPU 1: GeForce RTX 3080 (UUID: GPU-06f427c3-4a75-9ad0-5c0f-06a9acaadfa5)\nGPU 2: GeForce RTX 3080 (UUID: GPU-891c2e2f-9a93-04c1-323b-95d5f41c37te)\nGPU 3: GeForce RTX 3080 (UUID: GPU-98e4d489-71ae-c6ef-b80c-93bebe1f7f5e)\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ nvidia-smi -L\n\nGPU 0: GeForce RTX 3080 (UUID: GPU-6f62e1a5-2d7b-31a5-aa25-628d349e0235)\nGPU 1: GeForce RTX 3080 (UUID: GPU-06f427c3-4a75-9ad0-5c0f-06a9acaadfa5)\nGPU 2: GeForce RTX 3080 (UUID: GPU-891c2e2f-9a93-04c1-323b-95d5f41c37te)\nGPU 3: GeForce RTX 3080 (UUID: GPU-98e4d489-71ae-c6ef-b80c-93bebe1f7f5e)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"多张显卡可以这么整。"}]},{"type":"element","tag":"code","props":{"code":"for i in `nvidia-smi -L | awk -F: '{print $1}' | awk '{print $2}'`; do\n    DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:$i]/GPUFanControlState=1 -a [fan:$i]/GPUTargetFanSpeed=100\n\n    DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:$i]/GPUMemoryTransferRateOffset[4]=2000 -a [gpu:$i]/GPUGraphicsClockOffset[4]=-600\n    echo GPU $i is ready.\ndone\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"for i in `nvidia-smi -L | awk -F: '{print $1}' | awk '{print $2}'`; do\n    DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:$i]/GPUFanControlState=1 -a [fan:$i]/GPUTargetFanSpeed=100\n\n    DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:$i]/GPUMemoryTransferRateOffset[4]=2000 -a [gpu:$i]/GPUGraphicsClockOffset[4]=-600\n    echo GPU $i is ready.\ndone\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"返回的信息如下。"}]},{"type":"element","tag":"code","props":{"code":"ERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUFanControlState' (meow:0[gpu:0]) assigned value 1.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUTargetFanSpeed' (meow:0[fan:0]) assigned value 99.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUMemoryTransferRateOffset' (meow:0[gpu:0]) assigned value 1400.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUGraphicsClockOffset' (meow:0[gpu:0]) assigned value -200.\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"ERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUFanControlState' (meow:0[gpu:0]) assigned value 1.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUTargetFanSpeed' (meow:0[fan:0]) assigned value 99.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUMemoryTransferRateOffset' (meow:0[gpu:0]) assigned value 1400.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUGraphicsClockOffset' (meow:0[gpu:0]) assigned value -200.\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"执行后实时生效，前后数据可通过 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nvidia-smi -q | grep MHz"}]},{"type":"text","value":" 对比。"}]},{"type":"element","tag":"h2","props":{"id":"清理环境"},"children":[{"type":"text","value":"清理环境"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Xorg 可以关掉。"}]},{"type":"element","tag":"code","props":{"code":"$ ps -ef | grep xorg\nroot      9816 33061  0 04:55 pts/0    00:00:00 grep --color=auto xorg\nroot     47705 33061  0 03:38 tty7     00:00:14 /usr/lib/xorg/Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch\n\n$ kill 47705\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ ps -ef | grep xorg\nroot      9816 33061  0 04:55 pts/0    00:00:00 grep --color=auto xorg\nroot     47705 33061  0 03:38 tty7     00:00:14 /usr/lib/xorg/Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch\n\n$ kill 47705\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"tips"},"children":[{"type":"text","value":"Tips"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不想在后台跑个 Xorg？可以用 xini 执行 nvidia-settings，配合 ansible 更优雅。"}]},{"type":"element","tag":"code","props":{"code":"#ubuntu\napt install xinit\n\n#centos\nyum install xorg-x11-xinit\n\nxinit /usr/bin/nvidia-settings -a [gpu:0]/GPUGraphicsClockOffset[4]=600 --  :0 -once\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#ubuntu\napt install xinit\n\n#centos\nyum install xorg-x11-xinit\n\nxinit /usr/bin/nvidia-settings -a [gpu:0]/GPUGraphicsClockOffset[4]=600 --  :0 -once\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当然也可以给服务器接上显示器，再安装一个小巧的桌面环境，比如 Xfce，该有的依赖就都有了。"}]},{"type":"element","tag":"code","props":{"code":"sudo apt update\nsudo apt install xfce4 xfce4-goodies\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo apt update\nsudo apt install xfce4 xfce4-goodies\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"此外，显示器一般都有 EDID 信息，包括显示器的分辨率、厂商名称与序号等，保存在显示器的 PROM 或 EEPROM 中。我们也可以给虚拟显示器整一个（强迫症必备"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/linuxhw/EDID/tree/master/Digital/Nvidia","rel":["nofollow"]},"children":[{"type":"text","value":"这里"}]},{"type":"text","value":"有整理好的 EDID 文件，随便找一个，比如 Nvidia Defaul，分辨率 1920x1080。"}]},{"type":"element","tag":"code","props":{"code":"$ sudo vim /etc/X11/edid.txt\n\n00 ff ff ff ff ff ff 00 3a c4 00 00 00 00 00 00\n2d 0c 01 03 80 20 12 00 ea a8 e0 99 57 4b 92 25\n1c 50 54 00 00 00 01 01 01 01 01 01 01 01 01 01\n01 01 01 01 01 01 02 3a 80 18 71 38 2d 40 30 20\n35 00 42 b5 10 01 00 18 00 00 00 fc 00 4e 76 69\n64 69 61 20 44 65 66 61 75 6c 00 00 00 fc 00 74\n20 46 6c 61 74 20 50 61 6e 65 6c 00 00 00 00 fd\n00 00 3d 1d 44 0f 00 00 20 20 20 20 20 00 00 1d\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ sudo vim /etc/X11/edid.txt\n\n00 ff ff ff ff ff ff 00 3a c4 00 00 00 00 00 00\n2d 0c 01 03 80 20 12 00 ea a8 e0 99 57 4b 92 25\n1c 50 54 00 00 00 01 01 01 01 01 01 01 01 01 01\n01 01 01 01 01 01 02 3a 80 18 71 38 2d 40 30 20\n35 00 42 b5 10 01 00 18 00 00 00 fc 00 4e 76 69\n64 69 61 20 44 65 66 61 75 6c 00 00 00 fc 00 74\n20 46 6c 61 74 20 50 61 6e 65 6c 00 00 00 00 fd\n00 00 3d 1d 44 0f 00 00 20 20 20 20 20 00 00 1d\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 nvidia-xconfig 生成 Xorg 配置时添加自定义参数。"}]},{"type":"element","tag":"code","props":{"code":"sudo nvidia-xconfig -a --allow-empty-initial-configuration \\\n--use-display-device=None --virtual=1920x1080 \\\n--use-display-device=\"DFP-0\" --connected-monitor=\"DFP-0\" \\\n--custom-edid=\"DFP-0:/etc/X11/edid.txt\" --cool-bits=28\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo nvidia-xconfig -a --allow-empty-initial-configuration \\\n--use-display-device=None --virtual=1920x1080 \\\n--use-display-device=\"DFP-0\" --connected-monitor=\"DFP-0\" \\\n--custom-edid=\"DFP-0:/etc/X11/edid.txt\" --cool-bits=28\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"此时可以安装 VNC 来使用 nvidia-settings 的图形界面，但都到这一步了为何不直接装桌面版 Ubuntu 呢 (ーー゛)"}]}]},"date":"2021-03-10T12:10:52.000Z","tags":["linux","nvidia","xorg"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Linux 的 NVIDIA 超频工具可没有 Windows 的那么多，看了一圈好像也只有官方提供的 nvidia-settings。然而这玩意用 X11 扩展协议和显卡 DDX 驱动通信，而服务器没有图形界面，根本届不到。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"所以想用官方工具超频，估计还得装个 Xorg 和虚拟显示器。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Explosion","src":"/blog/make-nvidia-explosion/explosion.jpeg"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"环境准备"},"children":[{"type":"text","value":"环境准备"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"显卡：RTX 2080Ti / RTX 3080"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"系统：Ubuntu 18.04.5 / CentOS 7.6"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"驱动：apt install nvidia-utils-460-server"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装 Xorg。"}]},{"type":"element","tag":"code","props":{"code":"# ubuntu\napt update\napt install xorg\n\n# centos\nyum install xorg-x11-server-Xorg\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-296805"},"children":[{"type":"text","value":"# ubuntu"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"apt update"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"apt install xorg"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-296805"},"children":[{"type":"text","value":"# centos"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"yum install xorg-x11-server-Xorg"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"生成 Xorg 配置。"}]},{"type":"element","tag":"code","props":{"code":"sudo nvidia-xconfig -a --allow-empty-initial-configuration --cool-bits=28\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"sudo nvidia-xconfig -a --allow-empty-initial-configuration --cool-bits=28"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"选项 --allow-empty-initial-configuration 用来允许 Nvidia 驱动在没有连接任何显示设备的情况下工作（460.32.03 及以上版本默认为 True）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"选项 --cool-bits 是超频功能开关，其值为各配置项组成二进制数字再转十进制数字。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"1   (bit 0) - 在 nvidia-settings 的 Clock Frequencies 参数上启用旧版 (pre-Fermi) 核心的超频。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"2   (bit 1) - 设置该位时，驱动程序将在使用具有不同数量显存的 GPU 时尝试初始化 SLI。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"4   (bit 2) - 在 nvidia-settings 的 Thermal Monitor 参数上启用手动配置 GPU 风扇速度。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"8   (bit 3) - 在 nvidia-settings 的 PowerMizer 参数上启用超频。自 337.12 版本起适用于 Fermi 架构及更高版本。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"16 (bit 4) - 使用 nvidia-settings CLI 选项启用过电压。自 346.16 版起适用于 Fermi 架构及更高版本。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"举个栗子，修改 RTX 3080（Ampere 架构）的核心频率，电压和风扇转速，需要将 Coolbits 值设置为 28（二进制 11100 转十进制为 28）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"后台启动 Xorg。"}]},{"type":"element","tag":"code","props":{"code":"nohup sudo /usr/lib/xorg/Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch &\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"nohup sudo /usr/lib/xorg/Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch "}]},{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":"&"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"运行 nvidia-smi，此时能看到 Xorg 在使用 GPU。"}]},{"type":"element","tag":"h2","props":{"id":"如何食用"},"children":[{"type":"text","value":"如何食用"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本文的主角 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nvidia-settings"}]},{"type":"text","value":" 依赖 X11 协议和显卡通信。所以在运行前要加上 DISPLAY 环境变量。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"由于 X11 不是完全体，执行后还是会报错。没关系，看到修改成功的提示就行。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为防止不可控核事故，先给风扇拉满（"}]},{"type":"element","tag":"code","props":{"code":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUFanControlState=1\nDISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [fan:0]/GPUTargetFanSpeed=100\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUFanControlState=1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [fan:0]/GPUTargetFanSpeed=100"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"核心降频，显存超频。"}]},{"type":"element","tag":"code","props":{"code":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUMemoryTransferRateOffset[4]=1400\nDISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUGraphicsClockOffset[4]=-200\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUMemoryTransferRateOffset[4]=1400"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:0]/GPUGraphicsClockOffset[4]=-200"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gpu:0"}]},{"type":"text","value":" 是显卡序号，多显卡可以修改序号分别执行。后面的 "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"4"}]},{"type":"text","value":" 适用于 20 系及 30 系显卡，如果你是 10 系卡改成 "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"3"}]},{"type":"text","value":" 就好（再不行改成 2，不会炸，大概）。超频用正值，降频用负值，请小心往上加，因为超多了真的会炸（一般重启能恢复）。显卡序号可用 nvidia-smi 查看。"}]},{"type":"element","tag":"code","props":{"code":"$ nvidia-smi -L\n\nGPU 0: GeForce RTX 3080 (UUID: GPU-6f62e1a5-2d7b-31a5-aa25-628d349e0235)\nGPU 1: GeForce RTX 3080 (UUID: GPU-06f427c3-4a75-9ad0-5c0f-06a9acaadfa5)\nGPU 2: GeForce RTX 3080 (UUID: GPU-891c2e2f-9a93-04c1-323b-95d5f41c37te)\nGPU 3: GeForce RTX 3080 (UUID: GPU-98e4d489-71ae-c6ef-b80c-93bebe1f7f5e)\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"$ nvidia-smi -L"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"GPU 0: GeForce RTX 3080 (UUID: GPU-6f62e1a5-2d7b-31a5-aa25-628d349e0235)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"GPU 1: GeForce RTX 3080 (UUID: GPU-06f427c3-4a75-9ad0-5c0f-06a9acaadfa5)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"GPU 2: GeForce RTX 3080 (UUID: GPU-891c2e2f-9a93-04c1-323b-95d5f41c37te)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"GPU 3: GeForce RTX 3080 (UUID: GPU-98e4d489-71ae-c6ef-b80c-93bebe1f7f5e)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"多张显卡可以这么整。"}]},{"type":"element","tag":"code","props":{"code":"for i in `nvidia-smi -L | awk -F: '{print $1}' | awk '{print $2}'`; do\n    DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:$i]/GPUFanControlState=1 -a [fan:$i]/GPUTargetFanSpeed=100\n\n    DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:$i]/GPUMemoryTransferRateOffset[4]=2000 -a [gpu:$i]/GPUGraphicsClockOffset[4]=-600\n    echo GPU $i is ready.\ndone\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":"`nvidia-smi -L "}]},{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":" awk -F: '{print $1}' "}]},{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":" awk '{print $2}'`"}]},{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":"do"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"    DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:$i]/GPUFanControlState=1 -a [fan:$i]/GPUTargetFanSpeed=100"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"    DISPLAY=:0 XAUTHORITY=/var/run/lightdm/root/:0 nvidia-settings -c :0 -a [gpu:$i]/GPUMemoryTransferRateOffset[4]=2000 -a [gpu:$i]/GPUGraphicsClockOffset[4]=-600"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-985020"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" GPU $i is ready."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":"done"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"返回的信息如下。"}]},{"type":"element","tag":"code","props":{"code":"ERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUFanControlState' (meow:0[gpu:0]) assigned value 1.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUTargetFanSpeed' (meow:0[fan:0]) assigned value 99.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUMemoryTransferRateOffset' (meow:0[gpu:0]) assigned value 1400.\n\nERROR: libXv setup error : libXv.so.1: cannot open shared object file: No such file or directory\n\n  Attribute 'GPUGraphicsClockOffset' (meow:0[gpu:0]) assigned value -200.\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"ERROR: libXv setup error "}]},{"type":"element","tag":"span","props":{"class":"ct-985020"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" libXv.so.1: cannot open shared object file: No such file or directory"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"  Attribute "}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":"'GPUFanControlState'"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" (meow:0[gpu:0]) assigned value 1."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"ERROR: libXv setup error "}]},{"type":"element","tag":"span","props":{"class":"ct-985020"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" libXv.so.1: cannot open shared object file: No such file or directory"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"  Attribute "}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":"'GPUTargetFanSpeed'"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" (meow:0[fan:0]) assigned value 99."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"ERROR: libXv setup error "}]},{"type":"element","tag":"span","props":{"class":"ct-985020"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" libXv.so.1: cannot open shared object file: No such file or directory"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"  Attribute "}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":"'GPUMemoryTransferRateOffset'"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" (meow:0[gpu:0]) assigned value 1400."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"ERROR: libXv setup error "}]},{"type":"element","tag":"span","props":{"class":"ct-985020"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" libXv.so.1: cannot open shared object file: No such file or directory"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"  Attribute "}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":"'GPUGraphicsClockOffset'"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" (meow:0[gpu:0]) assigned value -200."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"执行后实时生效，前后数据可通过 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nvidia-smi -q | grep MHz"}]},{"type":"text","value":" 对比。"}]},{"type":"element","tag":"h2","props":{"id":"清理环境"},"children":[{"type":"text","value":"清理环境"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Xorg 可以关掉。"}]},{"type":"element","tag":"code","props":{"code":"$ ps -ef | grep xorg\nroot      9816 33061  0 04:55 pts/0    00:00:00 grep --color=auto xorg\nroot     47705 33061  0 03:38 tty7     00:00:14 /usr/lib/xorg/Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch\n\n$ kill 47705\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"$ ps -ef "}]},{"type":"element","tag":"span","props":{"class":"ct-6c1c43"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" grep xorg"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"root      9816 33061  0 04:55 pts/0    00:00:00 grep --color=auto xorg"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"root     47705 33061  0 03:38 tty7     00:00:14 /usr/lib/xorg/Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"$ "}]},{"type":"element","tag":"span","props":{"class":"ct-985020"},"children":[{"type":"text","value":"kill"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" 47705"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"tips"},"children":[{"type":"text","value":"Tips"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不想在后台跑个 Xorg？可以用 xini 执行 nvidia-settings，配合 ansible 更优雅。"}]},{"type":"element","tag":"code","props":{"code":"#ubuntu\napt install xinit\n\n#centos\nyum install xorg-x11-xinit\n\nxinit /usr/bin/nvidia-settings -a [gpu:0]/GPUGraphicsClockOffset[4]=600 --  :0 -once\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-296805"},"children":[{"type":"text","value":"#ubuntu"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"apt install xinit"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-296805"},"children":[{"type":"text","value":"#centos"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"yum install xorg-x11-xinit"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"xinit /usr/bin/nvidia-settings -a [gpu:0]/GPUGraphicsClockOffset[4]=600 --  :0 -once"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当然也可以给服务器接上显示器，再安装一个小巧的桌面环境，比如 Xfce，该有的依赖就都有了。"}]},{"type":"element","tag":"code","props":{"code":"sudo apt update\nsudo apt install xfce4 xfce4-goodies\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"sudo apt update"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"sudo apt install xfce4 xfce4-goodies"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"此外，显示器一般都有 EDID 信息，包括显示器的分辨率、厂商名称与序号等，保存在显示器的 PROM 或 EEPROM 中。我们也可以给虚拟显示器整一个（强迫症必备"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/linuxhw/EDID/tree/master/Digital/Nvidia","rel":["nofollow"]},"children":[{"type":"text","value":"这里"}]},{"type":"text","value":"有整理好的 EDID 文件，随便找一个，比如 Nvidia Defaul，分辨率 1920x1080。"}]},{"type":"element","tag":"code","props":{"code":"$ sudo vim /etc/X11/edid.txt\n\n00 ff ff ff ff ff ff 00 3a c4 00 00 00 00 00 00\n2d 0c 01 03 80 20 12 00 ea a8 e0 99 57 4b 92 25\n1c 50 54 00 00 00 01 01 01 01 01 01 01 01 01 01\n01 01 01 01 01 01 02 3a 80 18 71 38 2d 40 30 20\n35 00 42 b5 10 01 00 18 00 00 00 fc 00 4e 76 69\n64 69 61 20 44 65 66 61 75 6c 00 00 00 fc 00 74\n20 46 6c 61 74 20 50 61 6e 65 6c 00 00 00 00 fd\n00 00 3d 1d 44 0f 00 00 20 20 20 20 20 00 00 1d\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"$ sudo vim /etc/X11/edid.txt"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"00 ff ff ff ff ff ff 00 3a c4 00 00 00 00 00 00"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"2d 0c 01 03 80 20 12 00 ea a8 e0 99 57 4b 92 25"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"1c 50 54 00 00 00 01 01 01 01 01 01 01 01 01 01"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"01 01 01 01 01 01 02 3a 80 18 71 38 2d 40 30 20"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"35 00 42 b5 10 01 00 18 00 00 00 "}]},{"type":"element","tag":"span","props":{"class":"ct-985020"},"children":[{"type":"text","value":"fc"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" 00 4e 76 69"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"64 69 61 20 44 65 66 61 75 6c 00 00 00 "}]},{"type":"element","tag":"span","props":{"class":"ct-985020"},"children":[{"type":"text","value":"fc"}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" 00 74"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"20 46 6c 61 74 20 50 61 6e 65 6c 00 00 00 00 fd"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"00 00 3d 1d 44 0f 00 00 20 20 20 20 20 00 00 1d"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 nvidia-xconfig 生成 Xorg 配置时添加自定义参数。"}]},{"type":"element","tag":"code","props":{"code":"sudo nvidia-xconfig -a --allow-empty-initial-configuration \\\n--use-display-device=None --virtual=1920x1080 \\\n--use-display-device=\"DFP-0\" --connected-monitor=\"DFP-0\" \\\n--custom-edid=\"DFP-0:/etc/X11/edid.txt\" --cool-bits=28\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"sudo nvidia-xconfig -a --allow-empty-initial-configuration \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"--use-display-device=None --virtual=1920x1080 \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"--use-display-device="}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":"\"DFP-0\""}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" --connected-monitor="}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":"\"DFP-0\""}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":"--custom-edid="}]},{"type":"element","tag":"span","props":{"class":"ct-9e0b6a"},"children":[{"type":"text","value":"\"DFP-0:/etc/X11/edid.txt\""}]},{"type":"element","tag":"span","props":{"class":"ct-db5bbe"},"children":[{"type":"text","value":" --cool-bits=28"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"此时可以安装 VNC 来使用 nvidia-settings 的图形界面，但都到这一步了为何不直接装桌面版 Ubuntu 呢 (ーー゛)"}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-985020{color:#0550AE}.ct-9e0b6a{color:#0A3069}.ct-6c1c43{color:#CF222E}.ct-db5bbe{color:#24292F}.ct-296805{color:#6E7781}.dark .ct-296805{color:#8B949E}.dark .ct-db5bbe{color:#C9D1D9}.dark .ct-6c1c43{color:#FF7B72}.dark .ct-9e0b6a{color:#A5D6FF}.dark .ct-985020{color:#79C0FF}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"环境准备","depth":2,"text":"环境准备"},{"id":"如何食用","depth":2,"text":"如何食用"},{"id":"清理环境","depth":2,"text":"清理环境"},{"id":"tips","depth":2,"text":"Tips"}]}},"_type":"markdown","_id":"content:blog:make-nvidia-explosion.md","_source":"content","_file":"blog/make-nvidia-explosion.md","_extension":"md"}